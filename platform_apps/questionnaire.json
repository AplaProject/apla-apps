{
    "blocks": [],
    "contracts": [
        {
            "Name": "QOperations",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract QOperations {\n    data {\n        id int \"optional\"\n        description string\n        question string\n        answer string\n        operation string\n    }\n    conditions {\n\n    }\n    action {\n        if $operation == \"C\" {\n            var q map\n            q[\"description\"] = $description\n            q[\"question\"] = $question\n            q[\"answer\"] = $answer_json\n            q[\"ecosystem\"] = $ecosystem_id\n            q[\"init\"] = $key_id\n            q[\"deleted\"] = 0\n            q[\"status\"] = 1\n            DBInsert(\"@1questionnaire\", q)\n        }\n        if $operation == \"E\" {\n            var q map\n            q[\"description\"] = $description\n            q[\"question\"] = $question\n            q[\"answer\"] = $answer_json\n            q[\"ecosystem\"] = $ecosystem_id\n            q[\"init\"] = $key_id\n            q[\"status\"] = $status\n            q[\"lastmodified\"] = $time\n            DBUpdate(\"@1questionnaire\", $id, q)\n        }\n        if $operation == \"T\" {\n            var q map\n            q[\"init\"] = $key_id\n            q[\"lastmodified\"] = $time\n            DBUpdate(\"@1questionnaire\", $id, q)\n        }\n        if $operation == \"D\" {\n            var q map\n            q[\"init\"] = $key_id\n            q[\"deleted\"] = 1\n            q[\"lastmodified\"] = $time\n            DBUpdate(\"@1questionnaire\", $id, q)\n        }\n    }\n}"
        },
        {
            "Name": "QSandbox",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract QSandbox {\n    data {\n        answer string\n        operation string\n    }\n    conditions {\n\n    }\n    action {\n        if $operation == \"C\" {            \n            var answer_json array\n            answer_json[0] = $answer\n            answer_json = JSONEncode(answer_json)\n            warning Sprintf(\"%v\", answer_json)\n        }\n    }\n}"
        }
    ],
    "data": [],
    "languages": [
        {
            "Name": "q_answer",
            "Trans": "{\"en\": \"Answer\", \"ru\": \"Ответ\"}"
        },
        {
            "Name": "q_answer_change",
            "Trans": "{\"en\": \"Change answer before expiration\", \"ru\": \"Редактировать ответ до окончания\"}"
        },
        {
            "Name": "q_answer_hide",
            "Trans": "{\"en\": \"Hide answer until expiration\", \"ru\": \"Не показывать ответы до окончания\"}"
        },
        {
            "Name": "q_description",
            "Trans": "{\"en\": \"Description\", \"ru\": \"Описание\"}"
        },
        {
            "Name": "q_initiator",
            "Trans": "{\"en\": \"Initiator\", \"ru\": \"Инициатор\"}"
        },
        {
            "Name": "q_notifications_send",
            "Trans": "{\"en\": \"Send notifications\", \"ru\": \"Отправить уведомления\"}"
        },
        {
            "Name": "q_poll",
            "Trans": "{\"en\": \"Questionnaire\", \"ru\": \"Опросы\"}"
        },
        {
            "Name": "q_question",
            "Trans": "{\"en\": \"Question\", \"ru\": \"Вопрос\"}"
        }
    ],
    "menus": [
        {
            "Name": "default_menu",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "MenuItem(Title:$@1q_poll$, Page:@1q_listing, Icon:\"fa fa-question-circle\")"
        }
    ],
    "pages": [
        {
            "Name": "q_edit",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "//TODO создание/редактирование опроса редактирование допустимо только до старта",
            "Menu": "default_menu"
        },
        {
            "Name": "q_listing",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "Include(@1pager_header)\nSetTitle($@1q_poll$)\nIf(#role_id#==1){\n    SetVar(permission,1)\n}\nAddToolButton(Title: \"Add new question\", Page: @1q_question_new, Icon: icon-plus).Popup(Header: \"test\", Width: \"50\")\nDBFind(@1questionnaire,src_q).Where({\"ecosystem\":#ecosystem_id#}).Custom(custom_name){\n        LinkPage(Class: #style_link# h5 text-bold, Page: @1q_question, PageParams: \"q_id=#id#\"){\n            Div(Class: text-primary){\n                Span(#name#).Style({padding-left: 30px;})\n            }\n        }.Custom(custom_button){\n            Button(Body: Em(Class: fa fa-times), Class: btn-xs btn-link, Page: @1ex_listing, Contract: @1ExSymbol, Params: \"operation=U,status=TR,isTradeable=1,id=#id#,name=#name#\").Style({margin-left: 30px;})\n        }\n    }.Count(q)\n\nDiv(fullscreen){\n    Div(table-responsive ml-lg mr-lg){\n        If(#q#>0){\n            Div(list-group-item){\n                Table(Source: src_q)\n            }\n        }\n    }\n}\nDiv(mt-sm ml-lg mr-sm mb-sm){\n    Include(@1pager)\n}\n",
            "Menu": "default_menu"
        },
        {
            "Name": "q_question",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "DBFind(@1questionnaire).Where({ecosystem:#ecosystem_id#, id:#q_id#}).Vars(question)\n\nDiv(content-wrapper){  \n    SetTitle(#question_question#)\n    Div(breadcrumb){\n        LinkPage(Body: $@1q_poll$, Page: @1q_listing)\n        Span(/,mh)\n        Span(Class: text-muted, Body: #question_question#)\n    }\n\n    Div(row mt-sm){\n        Div(col-lg-10 col-lg-offset-1){\n            Form(panel panel-primary){\n                Div(list-group-item text-center){\n                    P(Class: h3 text-bold m0, Body: #question_question#)\n                    If(`#question_description#`!=\"\"){\n                    }\n                }\n                Div(list-group-item text-center t5){\n                    Div(row){\n                        Div(col-md-12 text-center){\n                            #question_description#\n                        }\n                    }\n                }\n                Div(list-group-item text-center t5){\n                    Div(row){\n                        Div(col-md-6 text-right){\n                            \"Дата старта\"\n                        }\n                        Div(col-md-6 text-left){\n                            \"Дата старта\"\n                        }\n                    }\n                    Div(row){\n                        Div(col-md-6 text-right){\n                            \"Дата Конца\"\n                        }\n                        Div(col-md-6 text-left){\n                            \"Дата Конца\"\n                        }\n                    }\n                    Div(row){\n                        Div(col-md-6 text-right){\n                            \"auditoriya\"\n                        }\n                        Div(col-md-6 text-left){\n                            \"auditoriya\"\n                        }\n                    }\n                    Div(row){\n                        Div(col-md-6 text-right){\n                           \"chislo otvetov\"\n                        }\n                        Div(col-md-6 text-left){\n                            \"chislo otvetov\"\n                        }\n                    }\n                    Div(row){\n                        Div(col-md-12 text-center){\n                            \"вывести графики\"\n                        }\n                    }\n                }\n                Div(list-group-item text-center t5){\n                    Div(row){\n                        Div(col-md-12 text-center){\n                            \"Answer block\"\n                        }\n                    }\n                }\n            }\n        }\n    }\n}",
            "Menu": "default_menu"
        },
        {
            "Name": "q_question_new",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "Form(){\n    Data(bool,\"value,name\"){\n        0,$@1ex_unavaliable$\n        1,$@1ex_avaliable$\n    }\n    Div(row form-group){\n        Div(col-sm-3 mt-sm text-right){\n            Label(For: Title){\n                Span(Body: LangRes(@1title)\n            }\n            Span(Class: text-danger, Body:*)\n        }\n        Div(col-sm-9){\n            Input(Name: question, Type: text)\n        }\n    }\n    Div(row form-group){\n        Div(col-sm-3 mt-sm text-right){\n            Label(For: Description){\n                Span(Body: LangRes(@1q_description)\n            }\n            Span(Class: text-danger, Body:*)\n        }\n        Div(col-sm-9){\n            Input(Type: textarea, Name: description, Value: \"\", Placeholder: $@1message_type_here$).Style(resize: vertical; min-height: 6em;)\n        }\n    }\n    Div(row form-group){\n        Div(col-sm-3 mt-sm text-right){\n            Label(For: end_date){\n                LangRes(@1date_end)\n                Span(*,text-danger)\n            }\n        }\n        Div(col-md-9 text-left){\n            Div(row){\n                Div(col-md-6){\n                    Input(Name: end_date, Type: date)\n                }\n                Div(col-md-6){\n                    Input(Name: end_time, Type: time)\n                }\n            }\n        }\n    }\n    Div(row form-group){\n        Div(col-sm-3 mt-sm text-right){\n            Label(For: Notifications){\n                Span(Body: LangRes(@1q_notifications_send)\n            }\n            Span(Class: text-danger, Body:*)\n        }\n        Div(col-sm-9){\n            Input(Name: notifications, Type: checkbox, Value: true)\n        }\n    }\n    Div(row form-group){\n        Div(col-sm-3 mt-sm text-right){\n            Label(For: AnswerHide){\n                Span(Body: LangRes(@1q_answer_hide)\n            }\n            Span(Class: text-danger, Body:*)\n        }\n        Div(col-sm-9){\n            Input(Name: hide, Type: checkbox, Value: true)\n        }\n    }\n    Div(row form-group){\n        Div(col-sm-3 mt-sm text-right){\n            Label(For: AnswerChange){\n                Span(Body: LangRes(@1q_answer_change)\n            }\n            Span(Class: text-danger, Body:*)\n        }\n        Div(col-sm-9){\n            Input(Name: change, Type: checkbox, Value: true)\n        }\n    }\n    Div(row mt){\n        Div(col-md-12){\n            Button(Body: LangRes(@1back), Class: btn btn-default, Page: @1q_listing)\n            Button(Body: LangRes(@1create), Page: @1q_listing, Class: btn pull-right btn-primary, Contract: @1QOperations, Params: \"operation=C\")\n        }\n    }\n}",
            "Menu": "default_menu"
        }
    ],
    "parameters": [],
    "tables": [
        {
            "Name": "q_answers",
            "Permissions": "{\"insert\":\"true\",\"update\":\"true\",\"new_column\":\"true\"}"
        },
        {
            "Name": "questionnaire",
            "Permissions": "{\"insert\":\"true\",\"update\":\"true\",\"new_column\":\"true\"}"
        }
    ]
}