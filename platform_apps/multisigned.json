{
    "name": "Multisigned",
    "conditions": "ContractConditions(\"@1DeveloperCondition\")",
    "data": [
        {
            "Name": "ms_profile",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1keys).WhereId(#key_id#).Columns(\"id,multi\").Vars(k)\nIf(#k_multi#==0){\n    SetTitle($@1profile$)\n    AddToolButton(Title:$@1ms_create$, Icon:icon-wallet, Page:@1ms_multisigned).Popup(50, $@1ms_create$)\n}.Else{\n    SetTitle($@1ms_multisigned_account$)\n    AddToolButton(Title:$@1ms_edit$, Icon:icon-wallet, Page:@1ms_multisigned).Popup(50, $@1ms_edit$)\n}",
            "Type": "blocks"
        },
        {
            "Name": "ms_amount_max",
            "Trans": "{\"en\": \"Maximum number of tokens for a single transfer\", \"ru\": \"Максимальное разовое количество токенов для перевода\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_amount_max_day",
            "Trans": "{\"en\": \"The maximum daily number of tokens for a transfer\", \"ru\": \"Максимальное дневное количество токенов для перевода\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_amount_max_month",
            "Trans": "{\"en\": \"The maximum monthly number of tokens for a transfer\", \"ru\": \"Максимальное месячное количество токенов для перевода\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_assign_group",
            "Trans": "{\"en\": \"Assign group\", \"ru\": \"Назначить группы\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_assign_member",
            "Trans": "{\"en\": \"To appoint a member of the ecosystem\", \"ru\": \"Назначить члена экосистемы\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_assign_role",
            "Trans": "{\"en\": \"Assign roles\", \"ru\": \"Назначить роли\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_create",
            "Trans": "{\"en\": \"Create multisigned\", \"ru\": \"Создать мультиподпись\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_edit",
            "Trans": "{\"en\": \"Edit multisigned\", \"ru\": \"Редактировать мультиподпись\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_edit_group",
            "Trans": "{\"en\": \"Edit group\", \"ru\": \"Редактировать группу\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_edit_role",
            "Trans": "{\"en\": \"Edit roles\", \"ru\": \"Редактировать роли\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_group_single",
            "Trans": "{\"en\": \"Any member of the group\", \"ru\": \"Любой участник группы\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_group_voting",
            "Trans": "{\"en\": \"The vote within the group\", \"ru\": \"Голосование внутри группы\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_limits",
            "Trans": "{\"en\": \"Limitations\", \"ru\": \"Ограничения\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_limits_date",
            "Trans": "{\"en\": \"The limitation of the power of attorney\", \"ru\": \"Cрок доверенности\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_limits_sign",
            "Trans": "{\"en\": \"Limit transaction signature\", \"ru\": \"Ограничение подписи транзакций\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_member",
            "Trans": "{\"en\": \"Member of the ecosystem\", \"ru\": \"Член экосистемы\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_multisigned_account",
            "Trans": "{\"en\": \"Multisigned account\", \"ru\": \"Аккаунт с мультиподписью\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_no_limit",
            "Trans": "{\"en\": \"Not limited\", \"ru\": \"Не ограничено\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_not_assigned",
            "Trans": "{\"en\": \"Is not set\", \"ru\": \"Не задано\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_one_sign_transfer",
            "Trans": "{\"en\": \"Transfer with one signature\", \"ru\": \"Перевод одной подписью\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_poa_template",
            "Trans": "{\"en\": \"Template power of attorney\", \"ru\": \"Шаблон доверенности\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_role_single",
            "Trans": "{\"en\": \"Any member of the role\", \"ru\": \"Любой участник роли\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_role_voting",
            "Trans": "{\"en\": \"The voting members of the role\", \"ru\": \"Голосование участников роли\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_select_type",
            "Trans": "{\"en\": \"The transfer of funds from multicausality\", \"ru\": \"Перевод средств с мультикошелька\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_set_date",
            "Trans": "{\"en\": \"To set the time\", \"ru\": \"Установить срок\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_settings",
            "Trans": "{\"en\": \"Multisigned settings\", \"ru\": \"Настройки мультиподписи\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_voting",
            "Trans": "{\"en\": \"The voting\", \"ru\": \"Голосование\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_voting_params",
            "Trans": "{\"en\": \"The voting parameters\", \"ru\": \"Параметры голосования\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_voting_template",
            "Trans": "{\"en\": \"The template of voting\", \"ru\": \"Шаблон голосования\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_want_multisigned_this",
            "Trans": "{\"en\": \"Do you want to create multisigned for this account?\", \"ru\": \"Вы действительно хотите создать мультиподпись для этого аккаунта?\"}",
            "Type": "languages"
        },
        {
            "Name": "templates",
            "Trans": "{\"en\": \"Templates\", \"ru\": \"Шаблоны\"}",
            "Type": "languages"
        },
        {
            "Name": "ms_limits_sign",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "ms_one_sign_transfer,ms_voting",
            "Type": "app_params"
        },
        {
            "Name": "ms_types",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "ms_role_single,ms_role_voting,ms_member",
            "Type": "app_params"
        },
        {
            "Name": "ms_multisigned",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Columns(\"id\").Where({name:\"Multisigned\", ecosystem:1}).Vars(application)\nAppParam(App: #application_id#, Name:ms_types, Source:types)\nAppParam(App: #application_id#, Name:ms_limits_sign, Source:limits_sign)\nDBFind(@1keys).WhereId(#key_id#).Columns(\"multi\").Vars(k)\n\nSetVar(this_page,@1ms_multisigned).(back_page,@1profile_view)\nDBFind(@1buffer_data).Where({member_id:#key_id#, key:multisigned_units, ecosystem:#ecosystem_id#}).Columns(\"id,value->type,value->units\").Vars(buf)\nDBFind(@1roles,src_roles).Where({ecosystem:#ecosystem_id#, deleted:0}).Columns(\"id,role_name\")\n\nSetVar(TYPE_ROLE_SINGLE,1).(TYPE_ROLE_VOTING,2).(TYPE_MEMBER,3)\nSetVar(button_title,$@1ms_assign_role$)\nIf(#Type#==#TYPE_MEMBER#){\n    SetVar(button_title,$@1ms_assign_member$)\n}\n\nIf(GetVar(PoaTemplateId)==\"\"){\n    SetVar(PoaTemplateId,)\n}\nIf(#TypeCount#==\"\"){\n    SetVar(TypeCount,0)\n}\nDiv(content-wrapper){\n    If(#Type#!=\"\"){\n        SetTitle($@1ms_create$)\n        Div(breadcrumb){\n            LinkPage(Body: $@1profile$, Page: #back_page#)\n            Span(/,mh)\n            Span($@1ms_create$,text-muted)\n        }\n\n        Div(row){\n            Div(col-sm-8 col-sm-offset-2 col-lg-6 col-lg-offset-3){\n                Form(panel panel-primary){\n                    Div(panel-heading){\n                        $@1ms_settings$\n                    }\n                    Div(panel-body){\n                        Label($@1ms_limits$)\n                        Div(list-group-item){\n                            Label($@1poa$)\n                            Div(mb input-group){\n                                If(#PoaTemplateId#==\"\"){\n                                    Div(text-center text-muted mt){\n                                        $@1ms_not_assigned$\n                                    }\n                                }.Else{\n                                    DBFind(\"@1poa_templates\").WhereId(#PoaTemplateId#).Vars(poa)\n                                    Div(){\n                                        Span(\"$@1id$:\",mr).(#PoaTemplateId#,text-muted)\n                                    }\n                                    Div(){\n                                        Span(\"$@1contract$:\",mr).(#poa_contract#,text-muted)\n                                    }\n                                    Div(){\n                                        Span(\"$@1params$:\",mr).(#poa_params#,text-muted)\n                                    }\n                                }\n                                Div(input-group-btn){\n                                    Button(Class: btn bg-gray-lighter fa fa-caret-down buttons, Page: @1ms_select_poa, PageParams:\"back_page=#this_page#,back_header=$@1ms_poa_template$,Type=#Type#,TypeCount=#TypeCount#\").Popup(50, $@1ms_poa_template$)\n                                }\n                            }\n                            If(#PoaTemplateId#!=\"\"){\n                                Div(mb){\n                                    Label($@1ms_limits_date$)\n                                }\n                                Div(row mb){\n                                    Div(col-md-6){\n                                        Input(Name: LimitDate, Type: date)\n                                    }\n                                    Div(col-md-6){\n                                        Input(Name: LimitTime, Type: time, Value: \"00:00\")\n                                    }\n                                }\n                                Div(mb){\n                                    Label($@1ms_amount_max$) (amount_max)\n                                    Input(Name:AmountMax, Type: number)\n                                }\n                                Div(mb){\n                                    Label($@1ms_amount_max_day$) (amount_max_day)\n                                    Input(Name:AmountMaxDay, Type: number)\n                                }\n                                Div(mb){\n                                    Label($@1ms_amount_max_month$) (amount_max_month)\n                                    Input(Name:AmountMaxMonth, Type: number)\n                                }\n                            }\n                        }\n                        If(Or(#Type#==1,#Type#==3)){\n                            SetVar(Sign,1)\n                        }.Else{\n                            SetVar(Sign,2)\n                            Div(list-group-item){\n                                Div(){\n                                    Div(text-muted){\n                                        $@1ms_voting_params$\n                                    }\n                                    Div(row mb-sm){\n                                        Div(col-sm-6){\n                                            Label(For:Duration){\n                                                $@1vote_count_type$\n                                            }\n                                        }\n                                        Div(col-sm-6){\n                                            If(#TypeCount#==0){\n                                                SetVar(parts,\"%\")\n                                                SetVar(volume_desc,\"$@1voting_volume_desc$\")\n                                                SetVar(quorum_desc,\"$@1voting_quorum_desc$\")\n\n                                                Button(Body: $@1percent_votes$, Page: #this_page#, PageParams: \"TypeCount=0,Type=#Type#,PoaTemplateId=#PoaTemplateId#\", Class: btn btn-default disabled mr-lg)\n                                                Button(Body: $@1number_votes$, Page: #this_page#, PageParams: \"TypeCount=1,Type=#Type#,PoaTemplateId=#PoaTemplateId#\", Class: btn btn-default)\n\n                                            }.ElseIf(#TypeCount#==1){\n                                                SetVar(parts,\"$@1participants$\")\n                                                SetVar(volume_desc,\"$@1voting_volume_number_desc$\")\n                                                SetVar(hide_quorum,\"hidden\")\n                                                Button(Body: $@1percent_votes$, Page: #this_page#, PageParams: \"TypeCount=0,Type=#Type#,PoaTemplateId=#PoaTemplateId#\", Class: btn btn-default mr-lg)\n                                                Button(Body: $@1number_votes$, Page: #this_page#, PageParams: \"TypeCount=1,Type=#Type#,PoaTemplateId=#PoaTemplateId#\", Class: btn btn-default disabled)\n                                            }\n                                        }\n                                    }\n                                    Div(row mb-sm){\n                                        Div(col-sm-6){\n                                            Label(For:Duration){\n                                                $@1duration$ ($@1days$)\n                                            }\n                                        }\n                                        Div(col-sm-6){\n                                            Input(Name:Duration, Type:number, Value: 3)\n                                        }\n                                    }\n\n                                    Div(row mb-sm #hide_quorum#){\n                                        Div(col-sm-6){\n                                            Label(For:Quorum){\n                                                $@1voting_quorum$ (#parts#)\n                                            }\n                                            Div(m0 h6 text-muted){\n                                                #quorum_desc#\n                                            }\n                                        }\n                                        Div(col-sm-6){\n                                            Input(Name:Quorum, Type:number, Value: 51)\n                                        }\n                                    }\n                                    Div(row mb-sm){\n                                        Div(col-sm-6){\n                                            Label(For:Volume){\n                                                $@1voting_volume$ (#parts#)\n                                            }\n                                            Div(m0 h6 text-muted){\n                                                #volume_desc#\n                                            }\n                                        }\n                                        Div(col-sm-6){\n                                            Input(Name:Volume, Type:number, Value: 75)\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                        Div(list-group-item){\n                            Div(h4 mb){\n                                AppParam(App: #application_id#, Name:ms_types, Index:#Type#)\n                            }\n                            Div(mb){\n                                If(#buf_value_type#==#Type#){\n                                    ArrayToSource(buf_units, #buf_value_units#)\n                                    ForList(buf_units){\n                                        If(#Type#!=#TYPE_MEMBER#){\n                                            ForList(src_roles){\n                                                If(#id#==#value#){\n                                                    Span(#role_name#, mr)\n                                                }\n                                            }\n                                        }.Else{\n                                            #value#\n                                        }\n                                    }\n                                    Div(text-center){\n                                        Button(Body: #button_title#, Page: @1ms_select_units, Class: btn btn-default, PageParams: \"Type=#Type#,PoaTemplateId=#PoaTemplateId#,TypeCount=#TypeCount#\").Popup(50, $@1ms_edit_group$)\n                                    }\n                                }.Else{\n                                    Div(text-center text-muted){\n                                        $@1ms_not_assigned$\n                                    }\n                                    Div(text-center){\n                                        Button(Body: #button_title#, Page: @1ms_select_units, Class: btn btn-default, PageParams: \"Type=#Type#,PoaTemplateId=#PoaTemplateId#,TypeCount=#TypeCount#\").Popup(50, $@1ms_assign_group$)\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    Div(panel-footer text-left){\n                        Button(Body: $@1back$, Class: btn btn-default, Page: #this_page#).Popup(50, $@1ms_select_type$)\n                        If(#PoaTemplateId#>0){\n                            Button(Body: $@1send$, Class: btn btn-primary pull-right, Page: #back_page#, Contract: MSWallet, Params: \"BufferId=#buf_id#,PoaTemplateId=#PoaTemplateId#,Sign=#Sign#,TypeCount=#TypeCount#\").Alert(Text: $@1ms_want_multisigned_this$, ConfirmButton: $yes$, CancelButton: $no$, Icon: question)\n                        }\n                    }\n                }\n            }\n        }\n    }.Else{\n        Form(){\n            Div(form-group){\n                Label($@1ms_select_type$)\n            }\n            Div(form-group){\n                Select(Name: Type, Source: types, NameColumn: name, ValueColumn: id)\n            }\n            Div(){\n                Button(Body: $@1back$, Class: btn btn-default, Page: #back_page#)\n                Button(Body: $@1next$, Class: btn btn-primary pull-right, Page: #this_page#, PageParams: \"Type=Val(Type)\")\n            }\n        }\n    }\n}.Style(\n    .buttons {\n        border: 1px solid #dde6e9;\n        padding: 6px 16px;\n    }\n)",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ms_select_poa",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "DBFind(@1applications).Columns(\"id\").Where({name:\"Multisigned\", ecosystem:1}).Vars(application)\n\nSetVar(this_page,@1ms_select_poa).(back_page,@1ms_multisigned).(this_table, @1poa_templates).(current_header, $@1ms_select_poa$).(pager_limit, 10)\nInclude(@1pager_header)\n\nIf(#search#!=\"\"){\n    SetVar(where, {ecosystem:#ecosystem_id#, contract:{\"$like\":#search#}, deleted:0})\n}.Else{\n    SetVar(where, {ecosystem:#ecosystem_id#, deleted:0}).(search,)\n}\n\nDiv(){\n    Form(input-group){\n        Div(input-group-addon){\n            $@1template$\n        }\n        Input(Name: search, Value: #search#, Placeholder: $@1text_to_search$)\n        Div(input-group-btn){\n            If(GetVar(search)!=\"\"){\n                Button(Class: btn bg-gray-lighter fa fa-close mtl buttons, Page: #this_page#, PageParams: \"back_page=#back_page#,back_header=#back_header#,Id=#Id#,Type=#Type#,TypeCount=#TypeCount#,TemplateId=#TemplateId#\").Popup(Header: #current_header#, Width: \"50\")\n            }\n            Button(Class: btn bg-gray-lighter mtl buttons, Page: #this_page#, PageParams: \"back_page=#back_page#,back_header=#back_header#,Type=#Type#,TypeCount=#TypeCount#,search=Val(search),Id=#Id#,TemplateId=#TemplateId#\", Body: Em(Class: fa fa-search) $@1search$).Popup(Header: #current_header#, Width: \"50\")\n        }\n    }\n}.Style(\n    .buttons {\n        border: 1px solid #dde6e9;\n    }\n)\n\nDBFind(#this_table#, src).Where(#where#).Order({\"id\": 1}).Limit(#pager_limit#).Offset(#pager_offset#).Count(count).Custom(_actions){\n    Button(Class: btn btn-default fa fa-check pull-right, Page: #back_page#, PageParams: \"Type=#Type#,TypeCount=#TypeCount#,Id=#Id#,PoaTemplateId=#id#,TemplateId=#TemplateId#\")\n}.Custom(_params){\n    Span(Class: text-muted h6){\n        JsonToSource(pv, #params#)\n        ForList(Source: pv, Index:s_ind){\n            If(#s_ind#>1){\n                Span(\",\").Style(margin-right: 5px;)\n            }\n            \"#key#\"\n        }\n    }\n}\nDiv(fullscreen){\n    Div(table-responsive){\n        Div(){\n            If(#count# > 0){\n                Table(src, \"id=id,$@1contract$=contract,$@1params$=_params,=_actions\")\n            }.Else{\n                Div(Class: text-center h4 text-muted, Body: \"$@1templates$ $@1not_founded$\")\n            }\n        }.Style(\n            tbody > tr:nth-of-type(odd) {\n                background-color: #f8f9fc;\n            }\n        )\n    }\n}\nDiv(){\n    Include(@1pager_for_popup)\n    Button(Body: $@1back$, Class: btn btn-default pull-right, Page: #back_page#, PageParams: \"Type=#Type#,TypeCount=#TypeCount#\")\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ms_select_units",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "DBFind(@1applications).Columns(\"id\").Where({name:\"Multisigned\", ecosystem:1}).Vars(application)\nAppParam(App: #application_id#, Name:ms_types, Source:types)\nDBFind(@1keys).WhereId(#key_id#).Columns(\"multi\").Vars(k)\n\nSetVar(TYPE_ROLE_SINGLE,1).(TYPE_ROLE_VOTING,2).(TYPE_MEMBER,3)\n\nSetVar(this_page,@1ms_select_units).(back_page,@1ms_multisigned)\nDBFind(@1buffer_data).Where({member_id:#key_id#, key:multisigned_units, ecosystem:#ecosystem_id#}).Columns(\"id,value->type,value->units\").Vars(buf)\n\nIf(#PoaTemplateId#==\"\"){\n    SetVar(PoaTemplateId,)\n}\n\nDiv(content-wrapper){\n    Form(){\n        ArrayToSource(buf_units, [])\n        If(#buf_value_type#==#Type#){\n            ArrayToSource(buf_units, #buf_value_units#)\n        }\n        DBFind(@1roles,units).Where({ecosystem:#ecosystem_id#, deleted:0}).Columns(\"id,role_name\").Count(units_count)\n        Div(row){\n            If(#Type#!=#TYPE_MEMBER#){\n                If(#units_count#>0){\n                    ForList(units){\n                        SetVar(checked,false)\n                        ForList(buf_units){\n                            If(#id#==#value#){\n                                SetVar(checked,true)\n                            }\n                        }\n                        Div(col-sm-6 text-nowrap){\n                            Label(Class: form-inline){\n                                Input(Name: Vals, Type: checkbox, Value: #checked#)\n                                Input(Name: Units, Type: hidden, Value: #id#)\n                                If(#role_name#!=\"\"){\n                                    #role_name#\n                                }\n                            }\n                        }\n                    }\n                }.Else{\n                    Div(h4 text-center text-muted){\n                        $@1roles$ $@1not_founded$\n                    }\n                }\n            }.Else{\n                Div(col-sm-12){\n                    Input(Name: Vals, Type: hidden, Value: true)\n                    Input(Name: Units, Type:hidden, Value: #MemberId#)\n                    Div(input-group mb){\n                        If(#MemberId#!=\"\"){\n                            SetVar(AddressMemberId, Address(#MemberId#))\n                            Input(Name: m_name, Disabled: 1, Value: #AddressMemberId#)\n                        }.Else{\n                            Input(Name: m_name, Disabled: 1, Value: \"xxxx-xxxx-xxxx-xxxx-xxxx\")\n                        }\n                        Div(input-group-btn){\n                            Button(Class: btn bg-gray-lighter fa fa-caret-down mtl buttons, Page: @1ms_select_wallet, PageParams:\"back_page=#this_page#,back_header=$@1send$,EcosystemId=#ecosystem_id#,Type=#Type#,TypeCount=#TypeCount#\").Popup(Header: $@1member$, Width: \"50\")\n                        }\n                    }\n                }\n            }\n        }\n        Div(row){\n            Div(col-sm-12 text-right){\n                Button(Body: $@1back$, Class: btn btn-default, Page: #back_page#, PageParams: \"Type=#Type#,PoaTemplateId=#PoaTemplateId#\")\n                If(#units_count#>0){\n                    Button(Body: $@1send$, Class: btn btn-primary, Contract: MSUnits, Params:\"Action=set,Type=#Type#,Vals=Val(Vals),Units=Val(Units)\", Page: #back_page#, PageParams: \"Type=#Type#,PoaTemplateId=#PoaTemplateId#,TypeCount=#TypeCount#\")\n                }\n            }\n        }\n    }\n}.Style(\n    .buttons {\n        border: 1px solid #dde6e9;\n    }\n)",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "ms_select_wallet",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "SetVar(this_page, @1ms_select_wallet).(this_table, @1keys).(current_header, $@1member$).(pager_limit, 10)\nInclude(@1pager_header)\n\nIf(#Id#==\"\"){\n    SetVar(Id,)\n}\n\nIf(#search#!=\"\"){\n    SetVar(where, {ecosystem: #EcosystemId#, id:{\"$neq\":#guest_key#}, deleted:0, id:AddressToId(#search#)})\n}.Else{\n    SetVar(where, {ecosystem: #EcosystemId#, id:{\"$neq\":#guest_key#}, deleted:0}).(search,)\n}\nIf(#PoaTemplateId#==\"\"){\n    SetVar(PoaTemplateId,)\n}\nDiv(){\n    Form(input-group){\n        Div(input-group-addon){\n            $@1wallet$\n        }\n        Input(Name: search, Value: #search#, Placeholder: $@1text_to_search$)\n        Div(input-group-btn){\n            If(#search#!=\"\"){\n                Button(Class: btn bg-gray-lighter fa fa-close mtl buttons, Page: #this_page#, PageParams: \"back_page=#back_page#,back_header=#back_header#,EcosystemId=#EcosystemId#,PoaTemplateId=#PoaTemplateId#,Type=#Type#\").Popup(Header: #current_header#, Width: \"50\")\n            }\n            Button(Class: btn bg-gray-lighter mtl buttons, Page: #this_page#, PageParams: \"back_page=#back_page#,back_header=#back_header#,EcosystemId=#EcosystemId#,search=Val(search),PoaTemplateId=#PoaTemplateId#,Type=#Type#\", Body: Em(Class: fa fa-search) $@1search$).Popup(Header: #current_header#, Width: \"50\")\n        }\n    }\n}.Style(\n    .buttons {\n        border: 1px solid #dde6e9;\n    }\n)\n\nDBFind(#this_table#, src).Where(#where#).Order({\"id\": 1}).Limit(#pager_limit#).Offset(#pager_offset#).Custom(custom_id){\n    Span(Class: h6 text-muted, Body: #id#)\n    SetVar(m_id, 0)\n    DBFind(@1members).Where({ecosystem:#ecosystem_id#, id:#id#}).Vars(m)\n    If(Or(#m_id#>0,#m_id#<0)){\n        SetVar(image_id, #m_image_id#)\n        SetVar(member_name, #m_member_name#)\n    }.Else{\n        SetVar(image_id, 0)\n        SetVar(member_name, Address(#id#))\n    }\n}.Custom(custom_member_id){\n    Button(Class: btn-xs btn-link pull-right, Page: #back_page#, PageParams: \"MemberId=#id#,EcosystemId=#EcosystemId#,PoaTemplateId=#PoaTemplateId#,Type=#Type#\"){\n        Span(Class: h5 text-bold, Body: Address(#id#))\n    }.Popup(Header: #back_header#, Width: 50)\n\n}.Custom(custom_ecosystem){\n    Span(Class: text-muted h5, Body: $@1ecosystem$ #EcosystemId#)\n}.Custom(custom_username){\n    If(#image_id#>0){\n        Image(Src: Binary().ById(#image_id#), Class: img-circle).Style(height: 30px;width: 30px; border: 1px solid #5A5D63; margin-right: 10px;)\n        Span(Class: h5, Body: #member_name#)\n    }.Else{\n        Div(){\n            Span(Em(Class: fa icon-user fa-2x)).Style(margin-right:10px;)\n            Span(Class: h5, Body: #member_name#)\n        }.Style(display:flex; align-items:center;)\n    }\n}.Count(count)\n\nDiv(fullscreen){\n    Div(table-responsive){\n        Div(){\n            If(#count# > 0){\n                Table(src, \"=custom_username,=custom_ecosystem,=custom_member_id\")\n            }.Else{\n                Div(Class: text-center h4 text-muted, Body: \"$@1members$ $@1not_founded$\")\n            }\n        }.Style(\n            tbody > tr:nth-of-type(odd) {\n                background-color: #f8f9fc;\n            }\n        )\n    }\n}\nDiv(){\n    Include(@1pager_for_popup)\n    Button(Body: LangRes(@1back), Class: btn btn-default pull-right, Page: #back_page#, PageParams: \"EcosystemId=#EcosystemId#,PoaTemplateId=#PoaTemplateId#,Type=#Type#\").Popup(Header: #back_header#, Width: \"50\")\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "MSUnits",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract MSUnits {\n    data {\n        Action string\n        Units array\n        Vals array\n        Type int\n    }\n    conditions {\n        var units array i lenVals int\n        lenVals = Len($Vals)\n        while i < lenVals{\n            if $Vals[i] == \"true\"{\n                units = Append(units, $Units[i])\n            }\n            i = i + 1\n        }\n        $units = units\n    }\n\n\n    action {\n        var id int m buf map\n        buf[\"key\"] = \"multisigned_units\"\n        buf[\"member_id\"] = $key_id\n        buf[\"ecosystem\"] = $ecosystem_id\n        id = Int(DBFind(\"@1buffer_data\").Where(buf).One(\"id\"))\n        if id == 0 {\n            buf[\"value\"] = `{}`\n            id = DBInsert(\"@1buffer_data\", buf)\n        }\n        Println(\"units:\", $units)\n        if $Action == \"set\" {\n            m[\"value->type\"] = $Type\n            m[\"value->units\"] = JSONEncode($units)\n            DBUpdate(\"@1buffer_data\", id, m)\n        }\n    }\n}\n",
            "Type": "contracts"
        },
        {
            "Name": "MSWallet",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract MSWallet {\n    data {\n        BufferId int\n        LimitDate string\n        LimitTime string\n        AmountMax money\n        AmountMaxDay money\n        AmountMaxMonth money\n        Sign int\n        TypeCount int\n        Duration int \"optional\"\n        Quorum int \"optional\"\n        Volume int \"optional\"\n        PoaTemplateId int\n    }\n\n    func dateAddTime(d, t string) string {\n        var dt string\n        if Contains(d, \"T00:00:00Z\") {\n            d = Replace(d, \"T00:00:00Z\", \"\")\n        }\n        if Size(t) == 5 {\n            dt = Sprintf(\"%v %v:00\", d, t)\n        }\n        return dt\n    }\n\n    conditions {\n        $TYPE_ROLE_SINGLE = 1\n        $TYPE_ROLE_VOTING = 2\n        $TYPE_MEMBER = 3\n\n        $ONE_SIGN = 1\n\n        $buf = DBFind(\"@1buffer_data\").Where({id:$BufferId, ecosystem:$ecosystem_id}).Columns(\"value->type,value->units\").Row()\n        if !$buf {\n            warning \"Not set subjects\"\n        }\n        if Int($buf[\"value.type\"]) == 0 {\n            warning \"Not found type\"\n        }\n        $units = JSONDecode($buf[\"value.units\"])\n\n        $limit = UnixDateTime(dateAddTime($LimitDate, $LimitTime))\n        if $limit == 0 {\n            warning \"Invalid Date or Time\"\n        }\n\n        $params = [\"amount_max\", \"amount_max_day\", \"amount_max_month\", \"amount_day\", \"amount_month\", \"date_day\", \"date_month\"]\n        $values = [$AmountMax, $AmountMaxDay, $AmountMaxMonth, 0, 0, 0, 0]\n        if $Sign == $ONE_SIGN{\n            $multi = -1\n        }else{\n            // перевод голосованием\n            if $Duration == 0 || $Quorum == 0|| $Volume == 0 {\n                warning \"Invalid parameters of voting\"\n            }\n            $params = Append($params, \"voting_duration\")\n            $params = Append($params, \"voting_quorum\")\n            $params = Append($params, \"voting_volume\")\n            $params = Append($params, \"voting_type_count\")\n            $values = Append($values, $Duration)\n            $values = Append($values, $Quorum)\n            $values = Append($values, $Volume)\n            $values = Append($values, $TypeCount)\n\n            $multi = 1\n        }\n        if Int($buf[\"value.type\"]) != $TYPE_MEMBER {\n            $params = Append($params, \"role_id\")\n        }\n    }\n\n    action {\n        var table string\n        table = Sprintf(\"@%vkeys\", $ecosystem_id)\n        DBUpdate(table, $key_id, {multi:$multi})\n\n        // лимиты ролей пишу в таблицу доверенностей\n        var m map i lenUnits int\n        lenUnits = Len($units)\n        m[\"DateExpiration\"] = $LimitDate\n        m[\"TimeExpiration\"] = $LimitTime\n        m[\"TemplateId\"] = $PoaTemplateId\n        m[\"ParamArr\"] = $params\n        m[\"Recipient\"] = IdToAddress($key_id)\n        m[\"ValueArr\"] = $values\n\n        while i < lenUnits{\n            if Int($buf[\"value.type\"]) == $TYPE_MEMBER {\n                m[\"Recipient\"] = IdToAddress(AddressToId($units[i]))\n            }else{\n                m[\"ValueArr\"] = Append($values, $units[i])\n            }\n            CallContract(\"@1PoaAdd\", m)\n            i = i + 1\n        }\n    }\n}\n",
            "Type": "contracts"
        }
    ]
}