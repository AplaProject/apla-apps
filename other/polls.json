{
    "name": "Polls",
    "conditions": "ContractConditions(\"@1DeveloperCondition\")",
    "data": [
        {
            "Name": "default_menu",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "MenuItem(Title:$@1polls$, Page:@1poll, Icon:\"icon-chart\")",
            "Type": "menu"
        },
        {
            "Name": "poll",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(this_page, @1poll).(this_table, @1votings)\nSetVar(allPools,0)\nInclude(@1pager_header)\nSetTitle($@1polls$)\n\nIf(EcosysParam(Ecosystem:1, Name: role_admin) == #role_id#){\n    AddToolButton(Title: $@1polls_templates$, Page: @1poll_template, Icon: fa icon-pin)\n    AddToolButton(Title: $@1create_poll$, Page: @1poll_create, Icon: icon-plus).Popup(40, $@1create_poll$)\n}\n\nIf(GetVar(search)){\n    SetVar(Where,{ecosystem:#ecosystem_id#, \"title\":{\"$like\":#Search#}})\n}.ElseIf(#allPools#==#type#){\n    SetVar(where, {ecosystem:#ecosystem_id#, deleted:0, voting->type:3}).(search,)\n}.ElseIf(#type#==3){\n    SetVar(where, {ecosystem:#ecosystem_id#, deleted:0, status:3, voting->type:3}).(search,)\n}.ElseIf(#type#==4){\n    SetVar(where, {ecosystem:#ecosystem_id#, creator->member_id:#key_id#, deleted:0, voting->type:3}).(search,)\n}.ElseIf(#type#==5){\n    SetVar(where, {ecosystem:#ecosystem_id#, voting->type_participants:4, deleted:0, voting->type:3}).(search,)\n}.Else{\n    SetVar(where,{ecosystem:#ecosystem_id#, \"id\":{\"$gt\":0}, voting->type:3}).(Search,)\n}\n\nDiv(mr-lg text-right){\n    Button(Body: Em(Class: fa fa-filter pr-sm) $@1filters$, Class: btn bg-gray-lighter mr-sm, Page: poll_filters).Popup(35, $@1poll_filters_list$)\n}\n\nDiv(list-group-item ml-lg mr-lg pt-lg){\n    SetVar(search_name, $@1polls$)\n    Include(@1search)\n}\n\nSetVar(WAITING,1).(VALID,2).(STARTED,3).(FINISHED,4).(INVALID,5)\nDBFind(@1applications).Where({ecosystem:1, name:\"Basic\"}).Columns(\"name,id\").Vars(application)\n        \n\nDBFind(#this_table#, src).Where(#where#).Order({\"id\": -1}).Limit(#pager_limit#).Offset(#pager_offset#).Columns(\"id,voting->name,voting->type,voting->type_decision,voting->type_participants,flags->success,flags->decision,flags->full_data,progress->percent_success,progress->number_participants,creator->member_id,creator->member_name,date_started,date_ended,deleted,status,voting->count_type_voters,voting->volume,progress->number_voters\").Count(count_votings).Custom(_id){\n    Span(Class: h5, Body: #id#)\n}.Custom(_name){\n    LinkPage(Page: @1poll_view, PageParams: \"vID=#id#\"){\n        Span(Class: h5 text-bold m0, Body: #voting.name#)\n    }\n}.Custom(_participants){\n    SetVar(participants, AppParam(Ecosystem:1, App:#application_id#, Name: type_voting_participants, Index: #voting.type_participants#))\n    Div(h6 m0){\n        If(Or(#status#==#STARTED#,#status#==#FINISHED#,#voting.type#==2)){\n            #participants#\n        }.Else{\n            Button(Page: @1poll_invite, PageParams: \"vID=#id#,back_page=#this_page#\", Class: btn btn-link p0 text-bold, Body: #participants#).Popup(45, $@1participants_add$)\n        }\n    }\n}.Custom(_date){\n    SetVar(started_class, text-bold h5 m0).(finished_class,text-bold h5 m0)\n    If(Or(#status#==#STARTED#,#status#==#FINISHED#)){\n        SetVar(started_class, text-muted h5 m0)\n    }\n    If(#status#==#FINISHED#){\n        SetVar(finished_class, text-muted h5 m0)\n    }\n    Div(Class: text-left){\n        P(Class: #started_class#, Body: DateTime(DateTime: #date_started#, Format: \"DD.MM.YYYY HH:MI\"))\n        P(Class: #finished_class#, Body: DateTime(DateTime: #date_ended#, Format: \"DD.MM.YYYY HH:MI\"))\n    }\n}.Custom(_status){\n    SetVar(status_class, AppParam(Ecosystem:1, App:#application_id#, Name:voting_statuses_classes, Index:#status#))\n    Div(#status_class#){\n        If(#status#==#STARTED#){\n            Button(Class: btn btn-link pl0, Body: $@1vote_now$, Page: @1poll_vote, PageParams: \"vID=#id#\").Popup(30, $@1vote_now$)\n        }.Else{\n            AppParam(Ecosystem:1, App:#application_id#, Name:voting_statuses, Index:#status#)\n        }\n    }\n}.Custom(_result){\n    If(#flags.decision#==0){\n        Span(Body: $@1not_voted$, Class: text-info)\n    }.ElseIf(#flags.decision#==-1){\n        Span(Body: $@1no$, Class: text-danger)\n    }.ElseIf(#flags.decision#==1){\n        Span(Body: $@1yes$, Class: text-success)\n    }\n}.Custom(_actions){\n    If(And(#creator.member_id#==#key_id#,#status#==#INVALID#)){\n        Button(Class: fa fa-trash btn btn-default, Contract: @1VotingDelete, Params: \"votingID=#id#\", Page: #this_page#).Alert(Text: \"$@1want_delete_voting$\", ConfirmButton: $@1yes$, CancelButton: $@1no$, Icon: question)\n    }\n}.Count(count)\n\nDiv(fullscreen){\n    Div(table-responsive ml-lg mr-lg){\n        Div(list-group-item){\n            If(#count# > 0){\n                Table(src, \"Polls=_name,$@1result$=_result,$@1type$=_type,$@1subject_voting$=_subject,$@1participants$=_participants,$@1date_start$ / $@1date_end$=_date,$@1creator$=_creator,$@1progress$=_progress,$@1decision$=_decision,$@1status$=_status,=_actions,btn=_btn\")\n            }.Else{\n                Div(Class: text-center h4 text-muted, Body: \"$@1votings$ $@1not_founded$\")\n            }\n        }.Style(\n            margin-top:-15px;\n            tbody > tr:nth-of-type(odd) {\n                background-color: #f8f9fc;\n            }\n        )\n    }\n}           \nDiv(mt-sm ml-lg mr-sm mb-sm){\n    Include(@1pager)\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "poll_create",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Where({ecosystem:1, name:\"Basic\"}).Columns(\"name,id\").Vars(application)\n\nSetVar(template_id, 0)\nSetVar(title,$@1create_poll$).(typevoting,0).(volume,50).(quorum,51).(subj,).(voters,).(candidates,).(vacancies,1).(contract_init,).(contract_accept,).(accept_params,).(contract_reject,).(reject_params,)\n\nIf(#TemplateId#>0){\n    DBFind(@1voting_templates).WhereId(#TemplateId#).Vars(template)\n    DBFind(@1votings_subject, src_voting_subject).Where({voting_id:#vID#}).Columns(\"id,subject->text\").Vars(prefix)\n    SetVar(title, #template_title#)\n    SetVar(typevoting, #template_type_voting#)\n    SetVar(volume, #template_volume#)\n    SetVar(subj, #template_subject#)\n    SetVar(quorum, #template_quorum#)\n    SetVar(voters, #template_voters#)\n    SetVar(candidates, #template_candidates#)\n    SetVar(vacancies, #template_vacancies#)\n    SetVar(contract_init, #template_init_contract#)\n    SetVar(contract_accept, #template_contract_accept#)\n    SetVar(accept_params, #template_accept_params#)\n    SetVar(contract_reject, #template_contract_reject#)\n    SetVar(reject_params, #template_reject_params#)\n    If(GetVar(CountTypeVoters)==\"\"){\n        SetVar(CountTypeVoters, #template_count_type_voters#)\n    }\n}\n\nIf(#TypeDecision#>0){\n    SetVar(typedec,#TypeDecision#)\n}.Else{\n    SetVar(typedec,0)\n}\nIf(#TypeParticipants#>0){\n    SetVar(typepart,#TypeParticipants#)\n}.Else{\n    SetVar(typepart,0)\n}\n\nSetVar(col_right,\"col-sm-8 mb-sm text-left\")\nSetVar(col_right_nob,\"col-sm-8 text-left\")\nSetVar(col_left,\"col-sm-4 mt-sm text-right\")\n\nSetVar(this_page, @1poll_create)\nIf(GetVar(CountTypeVoters)==\"\"){\n    SetVar(CountTypeVoters,0)\n}\n\nForm(){ \n    Div(row){\n        Div(#col_left#){\n            Label(For: #name#){\n                LangRes(@1participants)\n                Span(*,text-danger)\n            }\n        }\n        Div(#col_right#){\n            Data(poll_type_participants,\"id,name\"){\n                1, $@1everybody$\n                4, $@1roles_list2$\n            }\n            Select(Name: TypeParticipants, Source: poll_type_participants, NameColumn: name, ValueColumn: id)\n        }\n    }\n    Div(row){\n        Div(#col_left#){\n            Label(For: Title){\n                Span(Body: $@1title$)\n                Span(*,text-danger)\n            }\n        }\n        Div(#col_right#){\n            Input(Name: Title, Placeholder: $@1enter_poll_template_name$)\n        }\n    }\n    Div(row){\n        Div(col-md-12 text-center mt){\n            Span(Body: $@1poll_start$, Class: text-danger)\n        }\n    }\n    Div(row){\n        Div(#col_right#){\n            Input(Name: TypeVoting, Value: 3, Class: hidden)\n        }\n    }\n    Div(row){\n        Div(#col_right#){\n            Input(Name: Volume, Type: number, Value: 100, Class: hidden)\n        }\n    }\n    Div(row){\n        Div(#col_right#){\n            Input(Name: Quorum, Type: number, Value: 5, Class: hidden)\n        }\n    }\n    Div(row){\n        Div(#col_right#){\n            If(GetVar(CountTypeVoters)==0){\n                Button(Body: $@1percent_votes$, Page: #this_page#, PageParams: \"CountTypeVoters=0,TemplateId=#TemplateId#,TypeParticipants=Val(TypeParticipants)\", Class: hidden btn btn-primary disabled mr-lg)\n            }\n        }\n    }\n    Div(row){\n        Div(#col_right#){\n            If(GetVar(CountTypeVoters)==0){\n                Data(numbers_type_decisions,\"value,name\"){\n                    3,$@1document$\n                }\n                RadioGroup(Name: TypeDecision, Value: 3, Source: numbers_type_decisions, ValueColumn: value, NameColumn: name, Class: hidden)\n            }\n        }\n    }\n    Div(row mt){\n        Div(col-md-12){\n            If(#TemplateId#>0){\n                Button(Body: LangRes(@1back), Class: btn btn-default, Page: @1poll, PageParams: \"TemplateId=#TemplateId#,type=0\")\n            }.Else{\n                Button(Body: LangRes(@1back), Class: btn btn-default, Page: @1poll, PageParams: \"TemplateId=#TemplateId#,type=0\")\n            }\n            Button(Body: LangRes(@1create), Class: btn btn-primary pull-right, Page: @1poll, Contract: @1VotingTemplateCreate, PageParams: \"type=0\", Params: \"Poll=1\")\n        }\n    }\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "poll_create_start",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Where({ecosystem:1, name:\"Basic\"}).Columns(\"name,id\").Vars(application)\nSetTitle($@1start_poll$)\n\nSetVar(col_left,\"col-md-4 text-right\")\nSetVar(col_left_for_input,\"col-md-4 mt-sm text-right\")\nSetVar(col_right,\"col-md-8 text-left\")\nSetVar(col_right_for_input,\"col-md-8 mb-sm text-left\")\n\nIf(#TemplateId#>0){\n    DBFind(@1voting_templates).WhereId(#TemplateId#).Vars(template)\n\n    SetVar(v_role,).(c_role,)\n    If(#template_voters#>0){\n        DBFind(@1roles).Where({ecosystem:#ecosystem_id#, id:#template_voters#}).Columns(\"role_name\").Vars(vid)\n        SetVar(v_role, \"#vid_role_name#\")\n    }\n    If(#template_candidates#>0){\n        DBFind(@1roles).Where({ecosystem:#ecosystem_id#, id:#template_candidates#}).Columns(\"role_name\").Vars(cid)\n        SetVar(c_role, \"#cid_role_name#\")\n    }\n}\nDiv(content-wrapper){\n    Div(breadcrumb){\n        LinkPage(Body: $@1polls$, Page: @1poll)\n        Span(/, mh)\n        LinkPage(Body: $@1polls_templates$, Page: @1poll_template)\n        Span(/,mh)\n        Span($@1start_poll$, text-muted)\n    }\n\n    If(#TemplateId#>0){\n        Div(row){\n            Div(col-md-8 col-md-offset-2 col-lg-8 col-lg-offset-2){\n                Form(panel panel-primary){\n                    Div(panel-heading){$@1enter_data_for_poll_template$}\n                    Div(list-group-item){\n                        If(#template_type_decision#==3){\n                            Div(row){\n                                Div(#col_left_for_input#){\n                                    Label(For: TextDocument){\n                                        Span(Body: $@1enter_your_questions$)\n                                    }\n                                }\n                                Div(#col_right_for_input#){\n                                    Input(Name: TextDocument, Type: textarea)\n                                }\n                            }\n                            Div(row){\n                                Div(#col_left_for_input#){\n                                    Label(For: Duration){\n                                        LangRes(@1duration)\n                                    }\n                                }\n                                Div(#col_right_for_input#){\n                                    Input(Name: Duration, Type: number, Value: 3)\n                                }\n                            }\n                        }\n                    }\n                    Div(list-group-item){\n                        Button(Body: LangRes(@1back), Class: btn btn-default, Page: @1poll)\n                        Div(pull-right){\n                            Button(Body: $@1start_poll$, Class: btn btn-primary, Page: @1poll, Contract: @1VotingTemplateRun, Params: \"TemplateId=#TemplateId#,type=0\")\n                        }\n                    }\n                }\n            }\n        }\n    }.Else{\n        Div(col-md-12 alert alert-danger text-center){\n            LangRes(@1attention)\n        }\n    }\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "poll_decision",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "If(#vID# > 0){\n    If(GetVar(back_page)){}.Else{\n        SetVar(back_page,@1poll)\n    }\n\n    DBFind(@1votings, src_voting).WhereId(#vID#).Columns(\"id,voting->name,optional->contract_accept,optional->contract_reject,optional->contract_accept_params,optional->contract_reject_params\").Vars(instance)\n    DBFind(@1votings_subject, src_voting_subject).Where({voting_id:#vID#}).Columns(\"id,subject->text\").Vars(prefix)\n\n    If(#prefix_id#>0){\n    }.Else{\n        SetVar(Name: prefix_subject_text, Value: \"\")\n    }\n\n    Form(){\n        Div(form-group){\n            Div(row){\n                Div(col-md-12 mt-sm){\n                    Label(){\n                        Span(Body: LangRes(@1text_document))\n                        Span(Class: text-danger, Body:*)\n                    }\n                    Input(Name: text_document, Type: textarea, Value: #prefix_subject_text#)\n                }\n            }\n        }\n        Div(row mt){\n            Div(col-md-12){\n                Button(Body: LangRes(@1back), Class: btn btn-default, Page: @1poll_view, PageParams: \"vID=#vID#\")\n                Input(Name: votingID, Type: hidden, Value: #vID#)\n                Div(pull-right){\n                    Button(Body: LangRes(@1save), Class: btn btn-primary, Page: @1poll_view, PageParams: \"vID=#vID#\", Contract: @1VotingSubjectDocument)\n                }\n            }\n        }\n    }\n}.Else{\n    Div(md-12 alert alert-danger text-center){\n        Span(Body: LangRes(@1attention))\n    }\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "poll_filters",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "Div(Class: p bb){\n    Button(Body: Em(Class: fa fa-list pr-sm) $@1all_polls$, Class: btn bg-gray btn-block ml-sm, Page: @1poll, PageParams: \"type=0\")\n}\nDiv(Class: p bb){\n    Button(Body: Em(Class: fa fa-tasks pr-sm) $@1a_polls$, Class: btn bg-gray btn-block ml-sm, Page: @1poll, PageParams: \"type=3\")\n}\nDiv(Class: p bb){\n    Button(Body: Em(Class: fa fa-star pr-sm) $@1my_polls$, Class: btn bg-gray btn-block ml-sm, Page: @1poll, PageParams: \"type=4\")\n}\nDiv(Class: p bb){\n    Button(Body: Em(Class: fa fa-users pr-sm) $@1role_polls$, Class: btn bg-gray btn-block ml-sm, Page: @1poll, PageParams: \"type=5\")\n}\nDiv(Class: p pull-left){\n    Button(Body: $@1close$, Class: btn bg-gray ml-sm, Page: @1poll, PageParams: \"type=0\")\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "poll_invite",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "If(#vID# > 0){\n    Form(){\n        If(GetVar(back_page)){}.Else{\n            SetVar(back_page,@1voting_view)\n        }\n        DBFind(@1votings).WhereId(#vID#).Columns(\"id,voting->name,voting->type_participants,progress->number_participants\").Vars(instance)\n        SetVar(participants,#guest_key#)\n        DBFind(@1votings_participants, src_participants).Where({voting_id:#vID#}).Columns(\"id,member->member_id,member->member_name,member->role_id,member->member->member_id,member->member->member_name\").Count(participants_count).Custom(_id){\n            SetVar(participants,\"#participants#,#member.member_id#\")\n            Address(#member.member_id#)\n        }.Custom(_name){\n            LinkPage(Class: text-primary h5 text-bold, Page: @1profile_view, PageParams: \"v_key_id=#member.member_id#\", Body: #member.member_name#)\n        }.Custom(_sent){\n            Role added to vote\n        }.Custom(_member_roles){\n            DBFind(@1roles).Columns(\"id,role_name,image_id\").WhereId(#member.role_id#).Vars(rl)\n            LinkPage(Class: text-primary h5 text-bold, Page: @1roles_view, PageParams: \"v_role_id=#rl_id#\"){\n                If(#rl_image_id#>0){\n                    Image(Src: Binary().ById(#rl_image_id#), Class: mr-sm).Style(width: 30px; border: 1px solid #5A5D63;)\n                    #rl_role_name#\n                }.Else{\n                    Div(){\n                        Span(Class: fa icon-settings fa-2x mr-sm).(#rl_role_name#)\n                    }.Style(display:flex; align-items:center;)\n                }\n            }\n        }\n        If(#participants_count#>0){\n            Div(list-group-item){\n                If(#instance_voting_type_participants# == 5){\n                    Table(src_participants, \"$@1role$=_member_roles,=_sent\")\n                }.ElseIf(#instance_voting_type_participants# == 4){\n                    Table(src_participants, \"$@1role$=_member_roles,=_sent,$@1member$=_name,=_id,\")\n                }.Else{\n                    Table(src_participants, \"$@1member$=_name,=_id\")\n                }\n            }\n        }\n        Div(row mt){\n            Div(col-md-12){\n                If(#instance_voting_type_participants# == 1){\n                }\n                If(#instance_voting_type_participants# == 2){\n                    Label(){\n                        LangRes(@1select_member)\n                        Span(*, text-danger)\n                    }\n                    DBFind(@1keys,src_keys).Where({ecosystem:#ecosystem_id#, id:{\"$nin\":[#participants#]}}).Columns(\"id\").Count(keys_count).Custom(_name){\n                        SetVar(m_member_name,)\n                        DBFind(@1members).Where({ecosystem:#ecosystem_id#, id:#id#}).Columns(\"id,member_name\").Vars(m)\n                        Address(#id#)\n                        If(Or(#m_id#>0,#m_id#<0)){\n                            \" (#m_member_name#)\"\n                        }\n                    }\n                    If(#keys_count#>0){\n                        Select(Name: var_id, Source: src_keys, NameColumn: _name, ValueColumn: id)\n                    }.Else{\n                        Input(Name: voting_all_members, Disabled: 1, Value: \"$voting_all_keys_added$\")\n                    }\n                }\n                If(#instance_voting_type_participants# == 3){\n                    Label(){\n                        LangRes(@1select_role)\n                        Span(*, text-danger)\n                    }\n                    DBFind(@1roles, src_roles).Where({ecosystem:#ecosystem_id#, deleted:0}).Columns(\"id,role_name\")\n                    Select(Name: var_id, Source: src_roles, NameColumn: role_name, ValueColumn: id)\n                }\n                If(Or(#instance_voting_type_participants# == 4,#instance_voting_type_participants# == 5)){\n                    Div(row){\n                        Div(col-md-12){\n                            Label(){\n                                Span(Body: LangRes(@1select_role))\n                                Span(Class: text-danger, Body:*)\n                            }\n                            DBFind(@1roles, src_roles).Where({ecosystem:#ecosystem_id#, deleted:0}).Columns(\"id,role_name\")\n                            Select(Name: var_id, Source: src_roles, NameColumn: role_name, ValueColumn: id)\n                        }\n                    }\n                }\n            }\n        }\n        Div(row mt){\n            Div(col-md-12){\n                If(#instance_progress_number_participants# == 0){\n                    Button(Body: LangRes(@1back), Class: btn btn-default, Page: #back_page#, PageParams: \"vID=#vID#\")\n                }.Else{\n                    Button(Body: LangRes(@1back), Class: btn btn-default, Page: #back_page#, Contract: @1VotingStatusUpdate, PageParams: \"vID=#vID#\")\n                }\n                Input(Name: votingID, Type: hidden, Value: #vID#)\n                If(#instance_voting_type_participants# == 2){\n                    If(#keys_count#>0){\n                        Button(Body: LangRes(@1add_member), Class: btn btn-primary pull-right, Page: @1poll_invite, PageParams: \"vID=#vID#,back_page=#back_page#\", Contract: @1VotingInvite).Popup(50, $@1participants_add$)\n                    }\n                }.ElseIf(#instance_voting_type_participants# > 2){\n                    Button(Body: LangRes(@1add_role), Class: btn btn-primary pull-right, Page: @1poll_invite, PageParams: \"vID=#vID#,back_page=#back_page#\", Contract: @1VotingInvite).Popup(50, $@1participants_add$)\n                }\n            }\n        }\n    }\n}.Else{\n    Div(alert alert-danger text-center){\n        Span(Body: LangRes(@1attention))\n    }\n    Div(form-group text-left){\n        Button(Body: LangRes(@1back), Class: btn btn-default, Page: @1poll, Contract: @1VotingStatusUpdate)\n    }\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "poll_template",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(this_page, @1poll_template).(this_table, @1voting_templates)\nInclude(@1pager_header)\n\nSetTitle($@1polls_templates$)\nSpan(Class: h5 m0 mb ml-lg){\n    LinkPage(Class: ml-sm, Body: $@1polls$, Page: @1poll, PageParams: \"type=0\" )\n    Span(Class: text-muted mh, Body: /)\n    Span(Class: text-muted, Body: $@1polls_templates$)\n}.Style(\n    display: inline-block;\n)\n\nIf(GetVar(search)){\n    SetVar(where,{ecosystem:#ecosystem_id#, \"title\":{\"$like\":#search#}})\n}.Else{\n    SetVar(where,{ecosystem:#ecosystem_id#, \"id\":{\"$gt\":0}, type_voting:3}).(Search,)\n}\n\nDiv(list-group-item ml-lg mr-lg pt-lg){\n    SetVar(search_name, LangRes(@1template))\n    Include(@1search)\n}\n\nDBFind(@1applications).Where({ecosystem:1, name:\"Basic\"}).Columns(\"name,id\").Vars(application)\nDBFind(#this_table#).Where({ecosystem:#ecosystem_id#}).Count(all_templates_count)\nDBFind(#this_table#, src).Where(#where#).Order({\"id\": 1}).Limit(#pager_limit#).Offset(#pager_offset#).Custom(_participants){\n    AppParam(Ecosystem:1, App:#application_id#, Name:type_voting_participants, Index: #type_participants#)\n}.Custom(_actions){\n    Div(text-right){\n        Button(Class: btn btn-default fa fa-eye, Page: @1poll_create_start, PageParams: \"TemplateId=#id#\")\n    }\n}.Count(count)\n\nDiv(fullscreen){\n    Div(table-responsive ml-lg mr-lg){\n        Div(list-group-item){\n            If(#count# > 0){\n                Table(src, \"$@1template$=title,$@1participants$=_participants,$@1decision$=_decision,=_actions\")\n            }.ElseIf(#all_templates_count# == 0){\n                Div(Class: text-center h4 text-muted, Body: \"$@1voting_templates_not_found$\")\n            }\n        }.Style(\n            margin-top:-15px;\n            tbody > tr:nth-of-type(odd) {\n                background-color: #f8f9fc;\n            }\n        )\n    }\n}\nDiv(mt-sm ml-lg mr-sm mb-sm){\n    Include(@1pager)\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "poll_view",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Columns(\"name,id\").Where({ecosystem:1, name:\"Basic\"}).Vars(application)\nIf(#notific_id#>0){\n    DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, id:#notific_id#}).Columns(\"page_params->voting_id\").Vars(notific)\n    SetVar(vID,#notific_page_params_voting_id#)\n}\n\nSetVar(WAITING,1).(VALID,2).(STARTED,3).(FINISHED,4).(INVALID,5)\nSetVar(date_format,\"DD.MM.YYYY HH:MI\")\nSetVar(this_page,\"@1poll_view\")\nSetVar(col_right,\"col-md-6 text-left h3\")\nSetVar(col_left,\"col-md-6 text-right h3\")\n\nDiv(content-wrapper){\n    If(#vID# > 0){\n        DBFind(@1votings, Source: charts).WhereId(#vID#).Columns(\"id,voting->name,voting->volume,voting->quorum,voting->type_participants,voting->type,voting->count_type_voters,voting->type_decision,voting->description,optional->role_id,optional->role_vacancies,optional->number_candidates,optional->contract_accept,optional->contract_reject,progress->number_participants,progress->number_voters,progress->percent_success,progress->percent_voters,flags->success,flags->full_data,flags->decision,flags->notifics,date_started,date_ended,status\").Vars(instance)\n        SetVar(type_decision,#instance_voting_type_decision#)\n        SetVar(type_participants,#instance_voting_type_participants#)\n\n        SetVar(isVotingAllowed,0)\n        SetVar(isStartProcessing,0)\n        If(Or(#type_participants#==1,#type_participants#==2,#type_participants#==3,#type_participants#==4)){\n            DBFind(@1votings_participants).Where({voting_id:#vID#,\"member->member_id\":#key_id#, decision:0, ecosystem: #ecosystem_id#}).Columns(\"id\").Vars(flag_participant)\n            If(And(#instance_status#==#STARTED#,#flag_participant_id#>0)){\n                DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, \"recipient->member_id\":#key_id#, page_name:#this_page#, \"page_params->voting_id\": #vID#, closed:0}).Columns(\"id,notification->type,date_start_processing\").Vars(notificcc)\n                If(#notificcc_id#>0){\n                    SetVar(isVotingAllowed,1)\n                    SetVar(notific_id,#notificcc_id#)\n                    If(And(#notificcc_notification_type#==2,#notificcc_date_start_processing#==\"\")){\n                        SetVar(isStartProcessing,1)\n                    }\n                }\n            }\n        }\n        If(#type_participants#==5){\n            DBFind(@1votings_participants).Where({voting_id:#vID#,\"member->role_id\":#role_id#, decision:0, ecosystem: #ecosystem_id#}).Columns(\"id\").Vars(flag_participant)\n            If(And(#instance_status#==#STARTED#,#flag_participant_id#>0)){\n                DBFind(@1notifications).Where({{\"$or\":[{\"date_start_processing\": \"$isnull\"}, {\"processing_info->member_id\": #key_id#}]}, \"ecosystem\":#ecosystem_id#, \"recipient->role_id\":#role_id#, \"page_name\":#this_page#, \"page_params->voting_id\": #vID#, \"closed\":0}).Columns(\"id,notification->type,date_start_processing\").Vars(notificcc)\n                If(#notificcc_id#>0){\n                    SetVar(isVotingAllowed,1)\n                    SetVar(notific_id,#notificcc_id#)\n                    If(And(#notificcc_notification_type#==2,#notificcc_date_start_processing#==\"\")){\n                        SetVar(isStartProcessing,1)\n                    }\n                }\n            }\n        }\n        SetTitle(#instance_voting_name#)\n        Div(breadcrumb){\n            LinkPage(Body: $@1polls$, Page: @1poll, PageParams: \"type=0\")\n            Span(/,mh)\n            Span(Class: text-muted, Body: ##instance_id#)\n        }\n\n        Div(row mt-sm){\n            Div(col-lg-6 col-lg-offset-3){\n                Form(panel panel-primary){\n                    Input(Type: hidden, Name: votingID, Value: #vID#)\n\n                    Div(list-group-item text-center){\n                        P(Class: h3 text-bold m0, Body: #instance_voting_name#)\n                    }\n                    Div(list-group-item text-center){\n                        If(#type_decision#==3){\n                            DBFind(@1votings_subject, src_voting_subject).Where({voting_id:#vID#}).Columns(\"id,subject->text,subject->hash\").Vars(subject)\n                            Div(row){\n                                Div(#col_left#){\n                                    Label(For: TypeParticipants){\n                                        Span(Body: $@1question$:)\n                                    }\n                                }\n                                Div(#col_right#){\n                                    #subject_subject_text#\n                                }\n                            }\n                            Div(row mt-sm t5){\n                                Div(col-md-12){\n                                    If(And(Or(#instance_status#==#INVALID#,#instance_status#==#WAITING#),#instance_voting_type#==3)){\n                                        Button(Class: btn btn-link, Page: @1poll_decision, PageParams: \"vID=#vID#\"){\n                                            Strong(LangRes(@1subject_voting_edit))\n                                        }.Popup(50, $@1subject_voting$)\n                                    }\n                                }\n                            }\n                            Div(row mt-sm){\n                                Div(col-sm-6 col-sm-offset-2 col-lg-8 col-lg-offset-2){\n                                    If(#isStartProcessing#==1){\n                                        Button(Body: LangRes(@1process), Class: btn btn-info text-capitalize, Contract: @1NotificationsProcess, Params: \"notific_id=#notific_id#\", Page: #this_page#, PageParams: \"notific_id=#notific_id#\")\n                                    }.Else{\n                                        If(#isVotingAllowed#==1){\n                                            Button(Body: $@1no$, Class: btn btn-danger pull-left, Contract: @1VotingDecisionReject, PageParams: \"vID=#vID#\", Page: #this_page#, Params: \"RoleId=#role_id#\")\n                                            Button(Body: $@1yes$, Class: btn btn-success pull-right, Contract: @1VotingDecisionAccept, PageParams: \"vID=#vID#\", Page: #this_page#, Params: \"RoleId=#role_id#\")\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    Div(list-group-item text-center){\n                        Div(row t4){\n                            Div(col-md-5 col-md-offset-1){\n                                LangRes(@1voted)\n                            }\n                            Div(col-md-5){\n                                LangRes(@1progress)\n                            }\n                        }\n                        If(graph_work==\"good\"){\n                            Div(row text-muted t6 text-center){\n                                Div(col-md-5 col-md-offset-1){\n                                    LangRes(@1voting_graph_voted)\n                                }\n                                Div(col-md-5){\n                                    LangRes(@1voting_graph_progress)\n                                }\n                            }\n                        }\n                        Div(row text-center t3){\n                            If(#instance_voting_count_type_voters# == 1){\n                                Div(col-md-5 col-md-offset-1){\n                                    #instance_progress_number_voters# LangRes(@1voters) / #instance_voting_volume# LangRes(@1voters)\n                                }\n                                Div(col-md-5){\n                                    #instance_progress_percent_success#% LangRes(@1success) / 100% LangRes(@1total)\n                                }\n                            }.Else{\n                                Div(col-md-5 col-md-offset-1){\n                                    #instance_progress_number_voters# LangRes(@1voters) / #instance_progress_percent_voters#% LangRes(@1voters)\n                                }\n                                Div(col-md-5){\n                                    #instance_progress_percent_success#% LangRes(@1success) / 100% LangRes(@1total)\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }.Else{\n        Div(md-12 alert alert-danger text-center){\n            Span(Body: LangRes(@1attention))\n        }\n    }\n}.Style(\n    .t3 {font-size:24px;}\n    .t4 {font-size:18px;}\n    .t5 {font-size:14px;}\n    .t6 {font-size:12px;}\n    .break {word-break: break-all;}\n)\n",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "poll_vote",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Columns(\"name,id\").Where({ecosystem:1, name:\"Basic\"}).Vars(application)\nIf(#notific_id#>0){\n    DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, id:#notific_id#}).Columns(\"page_params->voting_id\").Vars(notific)\n    SetVar(vID,#notific_page_params_voting_id#)\n}\n\nSetVar(WAITING,1).(VALID,2).(STARTED,3).(FINISHED,4).(INVALID,5)\nSetVar(date_format,\"DD.MM.YYYY HH:MI\")\nSetVar(this_page,\"@1poll_view\")\nSetVar(col_right,\"col-md-6 text-left h3\")\nSetVar(col_left,\"col-md-6 text-right h3\")\n\n    If(#vID# > 0){\n        DBFind(@1votings, Source: charts).WhereId(#vID#).Columns(\"id,voting->name,voting->volume,voting->quorum,voting->type_participants,voting->type,voting->count_type_voters,voting->type_decision,voting->description,optional->role_id,optional->role_vacancies,optional->number_candidates,optional->contract_accept,optional->contract_reject,progress->number_participants,progress->number_voters,progress->percent_success,progress->percent_voters,flags->success,flags->full_data,flags->decision,flags->notifics,date_started,date_ended,status\").Vars(instance)\n        SetVar(type_decision,#instance_voting_type_decision#)\n        SetVar(type_participants,#instance_voting_type_participants#)\n\n        SetVar(isVotingAllowed,0)\n        SetVar(isStartProcessing,0)\n        If(Or(#type_participants#==1,#type_participants#==2,#type_participants#==3,#type_participants#==4)){\n            DBFind(@1votings_participants).Where({voting_id:#vID#,\"member->member_id\":#key_id#, decision:0, ecosystem: #ecosystem_id#}).Columns(\"id\").Vars(flag_participant)\n            If(And(#instance_status#==#STARTED#,#flag_participant_id#>0)){\n                DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, \"recipient->member_id\":#key_id#, page_name:#this_page#, \"page_params->voting_id\": #vID#, closed:0}).Columns(\"id,notification->type,date_start_processing\").Vars(notificcc)\n                If(#notificcc_id#>0){\n                    SetVar(isVotingAllowed,1)\n                    SetVar(notific_id,#notificcc_id#)\n                    If(And(#notificcc_notification_type#==2,#notificcc_date_start_processing#==\"\")){\n                        SetVar(isStartProcessing,1)\n                    }\n                }\n            }\n        }\n        If(#type_participants#==5){\n            DBFind(@1votings_participants).Where({voting_id:#vID#,\"member->role_id\":#role_id#, decision:0, ecosystem: #ecosystem_id#}).Columns(\"id\").Vars(flag_participant)\n            If(And(#instance_status#==#STARTED#,#flag_participant_id#>0)){\n                DBFind(@1notifications).Where({{\"$or\":[{\"date_start_processing\": \"$isnull\"}, {\"processing_info->member_id\": #key_id#}]}, \"ecosystem\":#ecosystem_id#, \"recipient->role_id\":#role_id#, \"page_name\":#this_page#, \"page_params->voting_id\": #vID#, \"closed\":0}).Columns(\"id,notification->type,date_start_processing\").Vars(notificcc)\n                If(#notificcc_id#>0){\n                    SetVar(isVotingAllowed,1)\n                    SetVar(notific_id,#notificcc_id#)\n                    If(And(#notificcc_notification_type#==2,#notificcc_date_start_processing#==\"\")){\n                        SetVar(isStartProcessing,1)\n                    }\n                }\n            }\n        }\n\n    Div(Class: col-md-12 pl){\n        Form(row mt-sm){\n            Input(Type: hidden, Name: votingID, Value: #vID#)\n            Div(text-center){\n                P(Class: h3 text-bold m0, Body: #instance_voting_name#)\n            }\n            Div(pl){\n                If(#type_decision#==3){\n                    DBFind(@1votings_subject, src_voting_subject).Where({voting_id:#vID#}).Columns(\"id,subject->text,subject->hash\").Vars(subject)\n                    Div(row){\n                        Div(col-md-6 text-right h4 text-bold){\n                            Label(For: TypeParticipants){\n                                Span(Body: $@1question$:)\n                            }\n                        }\n                        Div(col-md-6 text-left h4 text-muted){\n                            #subject_subject_text#\n                        }\n                    }\n                    Div(row mt-sm pt-lg text-center){\n                        Div(col-sm-6 col-sm-offset-2 col-lg-8 col-lg-offset-2){\n                            If(#isStartProcessing#==1){\n                                Button(Body: LangRes(@1process), Class: btn btn-info text-capitalize, Contract: @1NotificationsProcess, Params: \"notific_id=#notific_id#\", Page: #this_page#, PageParams: \"notific_id=#notific_id#\")\n                            }.Else{\n                                If(#isVotingAllowed#==1){\n                                    Div(row){\n                                        Div(Class: col-md-6 text-right){\n                                            Button(Body:$@1no$, Class: btn btn-danger, Contract: @1VotingDecisionReject, PageParams: \"vID=#vID#,type=0\", Page: @1poll, Params: \"RoleId=#role_id#\")\n                                        }\n                                        Div(Class: col-md-6 text-left){\n                                            Button(Body:$@1yes$, Class: btn btn-success, Contract: @1VotingDecisionAccept, PageParams: \"vID=#vID#,type=0\", Page: @1poll, Params: \"RoleId=#role_id#\")\n                                        }\n                                    }  \n                                }\n                            }\n                        }\n                    }\n                    Div(Class: pt-xl){\n                        Button(Body: $@1close$, Class: btn btn-default pull-left, Page: @1poll, PageParams: \"type=0\")\n                    }\n                } \n            }\n        }\n    }\n}.Else{\n    Div(md-12 alert alert-danger text-center){\n        Span(Body: LangRes(@1attention))\n    }\n}",
            "Menu": "default_menu",
            "Type": "pages"
        }
    ]
}