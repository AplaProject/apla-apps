{
    "name": "Polls",
    "conditions": "ContractConditions(\"@1DeveloperCondition\")",
    "data": [
        {
            "Name": "default_menu",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "MenuItem(Title:$@1polls$, Page:@1poll, Icon:\"icon-chart\")",
            "Type": "menu"
        },
        {
            "Name": "poll",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(this_page, @1poll).(this_table, @1votings)\r\nSetVar(allPools,0)\r\nInclude(@1pager_header)\r\nSetTitle($@1polls$)\r\n\r\nIf(EcosysParam(Ecosystem:1, Name: role_admin) == #role_id#){\r\n    AddToolButton(Title: $@1polls_templates$, Page: @1poll_template, Icon: fa icon-pin)\r\n    AddToolButton(Title: $@1create_poll$, Page: @1poll_create, Icon: icon-plus).Popup(40, $@1create_poll$)\r\n}\r\n\r\nIf(GetVar(search)){\r\n    SetVar(Where,{ecosystem:#ecosystem_id#, \"title\":{\"$like\":#Search#}})\r\n}.ElseIf(#allPools#==#type#){\r\n    SetVar(where, {ecosystem:#ecosystem_id#, deleted:0, voting->type:3}).(search,)\r\n}.ElseIf(#type#==3){\r\n    SetVar(where, {ecosystem:#ecosystem_id#, deleted:0, status:3, voting->type:3}).(search,)\r\n}.ElseIf(#type#==4){\r\n    SetVar(where, {ecosystem:#ecosystem_id#, creator->member_id:#key_id#, deleted:0, voting->type:3}).(search,)\r\n}.ElseIf(#type#==5){\r\n    SetVar(where, {ecosystem:#ecosystem_id#, voting->type_participants:4, deleted:0, voting->type:3}).(search,)\r\n}.Else{\r\n    SetVar(where,{ecosystem:#ecosystem_id#, \"id\":{\"$gt\":0}, voting->type:3}).(Search,)\r\n}\r\n\r\nDiv(mr-lg text-right){\r\n    Button(Body: Em(Class: fa fa-filter pr-sm) $@1filters$, Class: btn bg-gray-lighter mr-sm, Page: poll_filters).Popup(35, $@1poll_filters_list$)\r\n}\r\n\r\nDiv(list-group-item ml-lg mr-lg pt-lg){\r\n    SetVar(search_name, $@1polls$)\r\n    Include(@1search)\r\n}\r\n\r\nSetVar(WAITING,1).(VALID,2).(STARTED,3).(FINISHED,4).(INVALID,5)\r\nDBFind(@1applications).Where({ecosystem:1, name:\"Basic\"}).Columns(\"name,id\").Vars(application)\r\n        \r\n\r\nDBFind(#this_table#, src).Where(#where#).Order({\"id\": -1}).Limit(#pager_limit#).Offset(#pager_offset#).Columns(\"id,voting->name,voting->type,voting->type_decision,voting->type_participants,flags->success,flags->decision,flags->full_data,progress->percent_success,progress->number_participants,creator->member_id,creator->member_name,date_started,date_ended,deleted,status,voting->count_type_voters,voting->volume,progress->number_voters\").Count(count_votings).Custom(_id){\r\n    Span(Class: h5, Body: #id#)\r\n}.Custom(_name){\r\n    LinkPage(Page: @1poll_view, PageParams: \"vID=#id#\"){\r\n        Span(Class: h5 text-bold m0, Body: #voting.name#)\r\n    }\r\n}.Custom(_participants){\r\n    SetVar(participants, AppParam(Ecosystem:1, App:#application_id#, Name: type_voting_participants, Index: #voting.type_participants#))\r\n    Div(h6 m0){\r\n        If(Or(#status#==#STARTED#,#status#==#FINISHED#,#voting.type#==2)){\r\n            #participants#\r\n        }.Else{\r\n            Button(Page: @1poll_invite, PageParams: \"vID=#id#,back_page=#this_page#\", Class: btn btn-link p0 text-bold, Body: #participants#).Popup(45, $@1participants_add$)\r\n        }\r\n    }\r\n}.Custom(_date){\r\n    SetVar(started_class, text-bold h5 m0).(finished_class,text-bold h5 m0)\r\n    If(Or(#status#==#STARTED#,#status#==#FINISHED#)){\r\n        SetVar(started_class, text-muted h5 m0)\r\n    }\r\n    If(#status#==#FINISHED#){\r\n        SetVar(finished_class, text-muted h5 m0)\r\n    }\r\n    Div(Class: text-left){\r\n        P(Class: #started_class#, Body: DateTime(DateTime: #date_started#, Format: \"DD.MM.YYYY HH:MI\"))\r\n        P(Class: #finished_class#, Body: DateTime(DateTime: #date_ended#, Format: \"DD.MM.YYYY HH:MI\"))\r\n    }\r\n}.Custom(_status){\r\n    SetVar(status_class, AppParam(Ecosystem:1, App:#application_id#, Name:voting_statuses_classes, Index:#status#))\r\n    Div(#status_class#){\r\n        If(#status#==#STARTED#){\r\n            Button(Class: btn btn-link pl0, Body: $@1vote_now$, Page: @1poll_vote, PageParams: \"vID=#id#\").Popup(30, $@1vote_now$)\r\n        }.Else{\r\n            AppParam(Ecosystem:1, App:#application_id#, Name:voting_statuses, Index:#status#)\r\n        }\r\n    }\r\n}.Custom(_result){\r\n    If(#flags.decision#==0){\r\n        Span(Body: $@1not_voted$, Class: text-info)\r\n    }.ElseIf(#flags.decision#==-1){\r\n        Span(Body: $@1no$, Class: text-danger)\r\n    }.ElseIf(#flags.decision#==1){\r\n        Span(Body: $@1yes$, Class: text-success)\r\n    }\r\n}.Custom(_actions){\r\n    If(And(#creator.member_id#==#key_id#,#status#==#INVALID#)){\r\n        Button(Class: fa fa-trash btn btn-default, Contract: @1VotingDelete, Params: \"votingID=#id#\", Page: #this_page#).Alert(Text: \"$@1want_delete_voting$\", ConfirmButton: $@1yes$, CancelButton: $@1no$, Icon: question)\r\n    }\r\n}.Count(count)\r\n\r\nDiv(fullscreen){\r\n    Div(table-responsive ml-lg mr-lg){\r\n        Div(list-group-item){\r\n            If(#count# > 0){\r\n                Table(src, \"Polls=_name,$@1result$=_result,$@1type$=_type,$@1subject_voting$=_subject,$@1participants$=_participants,$@1date_start$ / $@1date_end$=_date,$@1creator$=_creator,$@1progress$=_progress,$@1decision$=_decision,$@1status$=_status,=_actions,btn=_btn\")\r\n            }.Else{\r\n                Div(Class: text-center h4 text-muted, Body: \"$@1votings$ $@1not_founded$\")\r\n            }\r\n        }.Style(\r\n            margin-top:-15px;\r\n            tbody > tr:nth-of-type(odd) {\r\n                background-color: #f8f9fc;\r\n            }\r\n        )\r\n    }\r\n}           \r\nDiv(mt-sm ml-lg mr-sm mb-sm){\r\n    Include(@1pager)\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "poll_create",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Where({ecosystem:1, name:\"Basic\"}).Columns(\"name,id\").Vars(application)\r\n\r\nSetVar(template_id, 0)\r\nSetVar(title,$@1create_poll$).(typevoting,0).(volume,50).(quorum,51).(subj,).(voters,).(candidates,).(vacancies,1).(contract_init,).(contract_accept,).(accept_params,).(contract_reject,).(reject_params,)\r\n\r\nIf(#TemplateId#>0){\r\n    DBFind(@1voting_templates).WhereId(#TemplateId#).Vars(template)\r\n    DBFind(@1votings_subject, src_voting_subject).Where({voting_id:#vID#}).Columns(\"id,subject->text\").Vars(prefix)\r\n    SetVar(title, #template_title#)\r\n    SetVar(typevoting, #template_type_voting#)\r\n    SetVar(volume, #template_volume#)\r\n    SetVar(subj, #template_subject#)\r\n    SetVar(quorum, #template_quorum#)\r\n    SetVar(voters, #template_voters#)\r\n    SetVar(candidates, #template_candidates#)\r\n    SetVar(vacancies, #template_vacancies#)\r\n    SetVar(contract_init, #template_init_contract#)\r\n    SetVar(contract_accept, #template_contract_accept#)\r\n    SetVar(accept_params, #template_accept_params#)\r\n    SetVar(contract_reject, #template_contract_reject#)\r\n    SetVar(reject_params, #template_reject_params#)\r\n    If(GetVar(CountTypeVoters)==\"\"){\r\n        SetVar(CountTypeVoters, #template_count_type_voters#)\r\n    }\r\n}\r\n\r\nIf(#TypeDecision#>0){\r\n    SetVar(typedec,#TypeDecision#)\r\n}.Else{\r\n    SetVar(typedec,0)\r\n}\r\nIf(#TypeParticipants#>0){\r\n    SetVar(typepart,#TypeParticipants#)\r\n}.Else{\r\n    SetVar(typepart,0)\r\n}\r\n\r\nSetVar(col_right,\"col-sm-8 mb-sm text-left\")\r\nSetVar(col_right_nob,\"col-sm-8 text-left\")\r\nSetVar(col_left,\"col-sm-4 mt-sm text-right\")\r\n\r\nSetVar(this_page, @1poll_create)\r\nIf(GetVar(CountTypeVoters)==\"\"){\r\n    SetVar(CountTypeVoters,0)\r\n}\r\n\r\nForm(){ \r\n    Div(row){\r\n        Div(#col_left#){\r\n            Label(For: #name#){\r\n                LangRes(@1participants)\r\n                Span(*,text-danger)\r\n            }\r\n        }\r\n        Div(#col_right#){\r\n            Data(poll_type_participants,\"id,name\"){\r\n                1, $@1everybody$\r\n                4, $@1roles_list2$\r\n            }\r\n            Select(Name: TypeParticipants, Source: poll_type_participants, NameColumn: name, ValueColumn: id)\r\n        }\r\n    }\r\n    Div(row){\r\n        Div(#col_left#){\r\n            Label(For: Title){\r\n                Span(Body: $@1title$)\r\n                Span(*,text-danger)\r\n            }\r\n        }\r\n        Div(#col_right#){\r\n            Input(Name: Title, Placeholder: $@1enter_poll_template_name$)\r\n        }\r\n    }\r\n    Div(row){\r\n        Div(col-md-12 text-center mt){\r\n            Span(Body: $@1poll_start$, Class: text-danger)\r\n        }\r\n    }\r\n    Div(row){\r\n        Div(#col_right#){\r\n            Input(Name: TypeVoting, Value: 3, Class: hidden)\r\n        }\r\n    }\r\n    Div(row){\r\n        Div(#col_right#){\r\n            Input(Name: Volume, Type: number, Value: 100, Class: hidden)\r\n        }\r\n    }\r\n    Div(row){\r\n        Div(#col_right#){\r\n            Input(Name: Quorum, Type: number, Value: 5, Class: hidden)\r\n        }\r\n    }\r\n    Div(row){\r\n        Div(#col_right#){\r\n            If(GetVar(CountTypeVoters)==0){\r\n                Button(Body: $@1percent_votes$, Page: #this_page#, PageParams: \"CountTypeVoters=0,TemplateId=#TemplateId#,TypeParticipants=Val(TypeParticipants)\", Class: hidden btn btn-primary disabled mr-lg)\r\n            }\r\n        }\r\n    }\r\n    Div(row){\r\n        Div(#col_right#){\r\n            If(GetVar(CountTypeVoters)==0){\r\n                Data(numbers_type_decisions,\"value,name\"){\r\n                    3,$@1document$\r\n                }\r\n                RadioGroup(Name: TypeDecision, Value: 3, Source: numbers_type_decisions, ValueColumn: value, NameColumn: name, Class: hidden)\r\n            }\r\n        }\r\n    }\r\n    Div(row mt){\r\n        Div(col-md-12){\r\n            If(#TemplateId#>0){\r\n                Button(Body: LangRes(@1back), Class: btn btn-default, Page: @1poll, PageParams: \"TemplateId=#TemplateId#,type=0\")\r\n            }.Else{\r\n                Button(Body: LangRes(@1back), Class: btn btn-default, Page: @1poll, PageParams: \"TemplateId=#TemplateId#,type=0\")\r\n            }\r\n            Button(Body: LangRes(@1create), Class: btn btn-primary pull-right, Page: @1poll, Contract: @1VotingTemplateCreate, PageParams: \"type=0\", Params: \"Poll=1\")\r\n        }\r\n    }\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "poll_create_start",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Where({ecosystem:1, name:\"Basic\"}).Columns(\"name,id\").Vars(application)\r\nSetTitle($@1start_poll$)\r\n\r\nSetVar(col_left,\"col-md-4 text-right\")\r\nSetVar(col_left_for_input,\"col-md-4 mt-sm text-right\")\r\nSetVar(col_right,\"col-md-8 text-left\")\r\nSetVar(col_right_for_input,\"col-md-8 mb-sm text-left\")\r\n\r\nIf(#TemplateId#>0){\r\n    DBFind(@1voting_templates).WhereId(#TemplateId#).Vars(template)\r\n\r\n    SetVar(v_role,).(c_role,)\r\n    If(#template_voters#>0){\r\n        DBFind(@1roles).Where({ecosystem:#ecosystem_id#, id:#template_voters#}).Columns(\"role_name\").Vars(vid)\r\n        SetVar(v_role, \"#vid_role_name#\")\r\n    }\r\n    If(#template_candidates#>0){\r\n        DBFind(@1roles).Where({ecosystem:#ecosystem_id#, id:#template_candidates#}).Columns(\"role_name\").Vars(cid)\r\n        SetVar(c_role, \"#cid_role_name#\")\r\n    }\r\n}\r\nDiv(content-wrapper){\r\n    Div(breadcrumb){\r\n        LinkPage(Body: $@1polls$, Page: @1poll)\r\n        Span(/, mh)\r\n        LinkPage(Body: $@1polls_templates$, Page: @1poll_template)\r\n        Span(/,mh)\r\n        Span($@1start_poll$, text-muted)\r\n    }\r\n\r\n    If(#TemplateId#>0){\r\n        Div(row){\r\n            Div(col-md-8 col-md-offset-2 col-lg-8 col-lg-offset-2){\r\n                Form(panel panel-primary){\r\n                    Div(panel-heading){$@1enter_data_for_poll_template$}\r\n                    Div(list-group-item){\r\n                        If(#template_type_decision#==3){\r\n                            Div(row){\r\n                                Div(#col_left_for_input#){\r\n                                    Label(For: TextDocument){\r\n                                        Span(Body: $@1enter_your_questions$)\r\n                                    }\r\n                                }\r\n                                Div(#col_right_for_input#){\r\n                                    Input(Name: TextDocument, Type: textarea)\r\n                                }\r\n                            }\r\n                            Div(row){\r\n                                Div(#col_left_for_input#){\r\n                                    Label(For: Duration){\r\n                                        LangRes(@1duration)\r\n                                    }\r\n                                }\r\n                                Div(#col_right_for_input#){\r\n                                    Input(Name: Duration, Type: number, Value: 3)\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    Div(list-group-item){\r\n                        Button(Body: LangRes(@1back), Class: btn btn-default, Page: @1poll)\r\n                        Div(pull-right){\r\n                            Button(Body: $@1start_poll$, Class: btn btn-primary, Page: @1poll, Contract: @1VotingTemplateRun, Params: \"TemplateId=#TemplateId#,type=0\")\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }.Else{\r\n        Div(col-md-12 alert alert-danger text-center){\r\n            LangRes(@1attention)\r\n        }\r\n    }\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "poll_decision",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "If(#vID# > 0){\r\n    If(GetVar(back_page)){}.Else{\r\n        SetVar(back_page,@1poll)\r\n    }\r\n\r\n    DBFind(@1votings, src_voting).WhereId(#vID#).Columns(\"id,voting->name,optional->contract_accept,optional->contract_reject,optional->contract_accept_params,optional->contract_reject_params\").Vars(instance)\r\n    DBFind(@1votings_subject, src_voting_subject).Where({voting_id:#vID#}).Columns(\"id,subject->text\").Vars(prefix)\r\n\r\n    If(#prefix_id#>0){\r\n    }.Else{\r\n        SetVar(Name: prefix_subject_text, Value: \"\")\r\n    }\r\n\r\n    Form(){\r\n        Div(form-group){\r\n            Div(row){\r\n                Div(col-md-12 mt-sm){\r\n                    Label(){\r\n                        Span(Body: LangRes(@1text_document))\r\n                        Span(Class: text-danger, Body:*)\r\n                    }\r\n                    Input(Name: text_document, Type: textarea, Value: #prefix_subject_text#)\r\n                }\r\n            }\r\n        }\r\n        Div(row mt){\r\n            Div(col-md-12){\r\n                Button(Body: LangRes(@1back), Class: btn btn-default, Page: @1poll_view, PageParams: \"vID=#vID#\")\r\n                Input(Name: votingID, Type: hidden, Value: #vID#)\r\n                Div(pull-right){\r\n                    Button(Body: LangRes(@1save), Class: btn btn-primary, Page: @1poll_view, PageParams: \"vID=#vID#\", Contract: @1VotingSubjectDocument)\r\n                }\r\n            }\r\n        }\r\n    }\r\n}.Else{\r\n    Div(md-12 alert alert-danger text-center){\r\n        Span(Body: LangRes(@1attention))\r\n    }\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "poll_filters",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "Div(Class: p bb){\r\n    Button(Body: Em(Class: fa fa-list pr-sm) $@1all_polls$, Class: btn bg-gray btn-block ml-sm, Page: @1poll, PageParams: \"type=0\")\r\n}\r\nDiv(Class: p bb){\r\n    Button(Body: Em(Class: fa fa-tasks pr-sm) $@1a_polls$, Class: btn bg-gray btn-block ml-sm, Page: @1poll, PageParams: \"type=3\")\r\n}\r\nDiv(Class: p bb){\r\n    Button(Body: Em(Class: fa fa-star pr-sm) $@1my_polls$, Class: btn bg-gray btn-block ml-sm, Page: @1poll, PageParams: \"type=4\")\r\n}\r\nDiv(Class: p bb){\r\n    Button(Body: Em(Class: fa fa-users pr-sm) $@1role_polls$, Class: btn bg-gray btn-block ml-sm, Page: @1poll, PageParams: \"type=5\")\r\n}\r\nDiv(Class: p pull-left){\r\n    Button(Body: $@1close$, Class: btn bg-gray ml-sm, Page: @1poll, PageParams: \"type=0\")\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "poll_invite",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "If(#vID# > 0){\r\n    Form(){\r\n        If(GetVar(back_page)){}.Else{\r\n            SetVar(back_page,@1voting_view)\r\n        }\r\n        DBFind(@1votings).WhereId(#vID#).Columns(\"id,voting->name,voting->type_participants,progress->number_participants\").Vars(instance)\r\n        SetVar(participants,#guest_key#)\r\n        DBFind(@1votings_participants, src_participants).Where({voting_id:#vID#}).Columns(\"id,member->member_id,member->member_name,member->role_id,member->member->member_id,member->member->member_name\").Count(participants_count).Custom(_id){\r\n            SetVar(participants,\"#participants#,#member.member_id#\")\r\n            Address(#member.member_id#)\r\n        }.Custom(_name){\r\n            LinkPage(Class: text-primary h5 text-bold, Page: @1profile_view, PageParams: \"v_key_id=#member.member_id#\", Body: #member.member_name#)\r\n        }.Custom(_sent){\r\n            Role added to vote\r\n        }.Custom(_member_roles){\r\n            DBFind(@1roles).Columns(\"id,role_name,image_id\").WhereId(#member.role_id#).Vars(rl)\r\n            LinkPage(Class: text-primary h5 text-bold, Page: @1roles_view, PageParams: \"v_role_id=#rl_id#\"){\r\n                If(#rl_image_id#>0){\r\n                    Image(Src: Binary().ById(#rl_image_id#), Class: mr-sm).Style(width: 30px; border: 1px solid #5A5D63;)\r\n                    #rl_role_name#\r\n                }.Else{\r\n                    Div(){\r\n                        Span(Class: fa icon-settings fa-2x mr-sm).(#rl_role_name#)\r\n                    }.Style(display:flex; align-items:center;)\r\n                }\r\n            }\r\n        }\r\n        If(#participants_count#>0){\r\n            Div(list-group-item){\r\n                If(#instance_voting_type_participants# == 5){\r\n                    Table(src_participants, \"$@1role$=_member_roles,=_sent\")\r\n                }.ElseIf(#instance_voting_type_participants# == 4){\r\n                    Table(src_participants, \"$@1role$=_member_roles,=_sent,$@1member$=_name,=_id,\")\r\n                }.Else{\r\n                    Table(src_participants, \"$@1member$=_name,=_id\")\r\n                }\r\n            }\r\n        }\r\n        Div(row mt){\r\n            Div(col-md-12){\r\n                If(#instance_voting_type_participants# == 1){\r\n                }\r\n                If(#instance_voting_type_participants# == 2){\r\n                    Label(){\r\n                        LangRes(@1select_member)\r\n                        Span(*, text-danger)\r\n                    }\r\n                    DBFind(@1keys,src_keys).Where({ecosystem:#ecosystem_id#, id:{\"$nin\":[#participants#]}}).Columns(\"id\").Count(keys_count).Custom(_name){\r\n                        SetVar(m_member_name,)\r\n                        DBFind(@1members).Where({ecosystem:#ecosystem_id#, id:#id#}).Columns(\"id,member_name\").Vars(m)\r\n                        Address(#id#)\r\n                        If(Or(#m_id#>0,#m_id#<0)){\r\n                            \" (#m_member_name#)\"\r\n                        }\r\n                    }\r\n                    If(#keys_count#>0){\r\n                        Select(Name: var_id, Source: src_keys, NameColumn: _name, ValueColumn: id)\r\n                    }.Else{\r\n                        Input(Name: voting_all_members, Disabled: 1, Value: \"$voting_all_keys_added$\")\r\n                    }\r\n                }\r\n                If(#instance_voting_type_participants# == 3){\r\n                    Label(){\r\n                        LangRes(@1select_role)\r\n                        Span(*, text-danger)\r\n                    }\r\n                    DBFind(@1roles, src_roles).Where({ecosystem:#ecosystem_id#, deleted:0}).Columns(\"id,role_name\")\r\n                    Select(Name: var_id, Source: src_roles, NameColumn: role_name, ValueColumn: id)\r\n                }\r\n                If(Or(#instance_voting_type_participants# == 4,#instance_voting_type_participants# == 5)){\r\n                    Div(row){\r\n                        Div(col-md-12){\r\n                            Label(){\r\n                                Span(Body: LangRes(@1select_role))\r\n                                Span(Class: text-danger, Body:*)\r\n                            }\r\n                            DBFind(@1roles, src_roles).Where({ecosystem:#ecosystem_id#, deleted:0}).Columns(\"id,role_name\")\r\n                            Select(Name: var_id, Source: src_roles, NameColumn: role_name, ValueColumn: id)\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        Div(row mt){\r\n            Div(col-md-12){\r\n                If(#instance_progress_number_participants# == 0){\r\n                    Button(Body: LangRes(@1back), Class: btn btn-default, Page: #back_page#, PageParams: \"vID=#vID#\")\r\n                }.Else{\r\n                    Button(Body: LangRes(@1back), Class: btn btn-default, Page: #back_page#, Contract: @1VotingStatusUpdate, PageParams: \"vID=#vID#\")\r\n                }\r\n                Input(Name: votingID, Type: hidden, Value: #vID#)\r\n                If(#instance_voting_type_participants# == 2){\r\n                    If(#keys_count#>0){\r\n                        Button(Body: LangRes(@1add_member), Class: btn btn-primary pull-right, Page: @1poll_invite, PageParams: \"vID=#vID#,back_page=#back_page#\", Contract: @1VotingInvite).Popup(50, $@1participants_add$)\r\n                    }\r\n                }.ElseIf(#instance_voting_type_participants# > 2){\r\n                    Button(Body: LangRes(@1add_role), Class: btn btn-primary pull-right, Page: @1poll_invite, PageParams: \"vID=#vID#,back_page=#back_page#\", Contract: @1VotingInvite).Popup(50, $@1participants_add$)\r\n                }\r\n            }\r\n        }\r\n    }\r\n}.Else{\r\n    Div(alert alert-danger text-center){\r\n        Span(Body: LangRes(@1attention))\r\n    }\r\n    Div(form-group text-left){\r\n        Button(Body: LangRes(@1back), Class: btn btn-default, Page: @1poll, Contract: @1VotingStatusUpdate)\r\n    }\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "poll_template",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(this_page, @1poll_template).(this_table, @1voting_templates)\r\nInclude(@1pager_header)\r\n\r\nSetTitle($@1polls_templates$)\r\nSpan(Class: h5 m0 mb ml-lg){\r\n    LinkPage(Class: ml-sm, Body: $@1polls$, Page: @1poll, PageParams: \"type=0\" )\r\n    Span(Class: text-muted mh, Body: /)\r\n    Span(Class: text-muted, Body: $@1polls_templates$)\r\n}.Style(\r\n    display: inline-block;\r\n)\r\n\r\nIf(GetVar(search)){\r\n    SetVar(where,{ecosystem:#ecosystem_id#, \"title\":{\"$like\":#search#}})\r\n}.Else{\r\n    SetVar(where,{ecosystem:#ecosystem_id#, \"id\":{\"$gt\":0}, type_voting:3}).(Search,)\r\n}\r\n\r\nDiv(list-group-item ml-lg mr-lg pt-lg){\r\n    SetVar(search_name, LangRes(@1template))\r\n    Include(@1search)\r\n}\r\n\r\nDBFind(@1applications).Where({ecosystem:1, name:\"Basic\"}).Columns(\"name,id\").Vars(application)\r\nDBFind(#this_table#).Where({ecosystem:#ecosystem_id#}).Count(all_templates_count)\r\nDBFind(#this_table#, src).Where(#where#).Order({\"id\": 1}).Limit(#pager_limit#).Offset(#pager_offset#).Custom(_participants){\r\n    AppParam(Ecosystem:1, App:#application_id#, Name:type_voting_participants, Index: #type_participants#)\r\n}.Custom(_actions){\r\n    Div(text-right){\r\n        Button(Class: btn btn-default fa fa-eye, Page: @1poll_create_start, PageParams: \"TemplateId=#id#\")\r\n    }\r\n}.Count(count)\r\n\r\nDiv(fullscreen){\r\n    Div(table-responsive ml-lg mr-lg){\r\n        Div(list-group-item){\r\n            If(#count# > 0){\r\n                Table(src, \"$@1template$=title,$@1participants$=_participants,$@1decision$=_decision,=_actions\")\r\n            }.ElseIf(#all_templates_count# == 0){\r\n                Div(Class: text-center h4 text-muted, Body: \"$@1voting_templates_not_found$\")\r\n            }\r\n        }.Style(\r\n            margin-top:-15px;\r\n            tbody > tr:nth-of-type(odd) {\r\n                background-color: #f8f9fc;\r\n            }\r\n        )\r\n    }\r\n}\r\nDiv(mt-sm ml-lg mr-sm mb-sm){\r\n    Include(@1pager)\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "poll_view",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Columns(\"name,id\").Where({ecosystem:1, name:\"Basic\"}).Vars(application)\r\nIf(#notific_id#>0){\r\n    DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, id:#notific_id#}).Columns(\"page_params->voting_id\").Vars(notific)\r\n    SetVar(vID,#notific_page_params_voting_id#)\r\n}\r\n\r\nSetVar(WAITING,1).(VALID,2).(STARTED,3).(FINISHED,4).(INVALID,5)\r\nSetVar(date_format,\"DD.MM.YYYY HH:MI\")\r\nSetVar(this_page,\"@1poll_view\")\r\nSetVar(col_right,\"col-md-6 text-left h3\")\r\nSetVar(col_left,\"col-md-6 text-right h3\")\r\n\r\nDiv(content-wrapper){\r\n    If(#vID# > 0){\r\n        DBFind(@1votings, Source: charts).WhereId(#vID#).Columns(\"id,voting->name,voting->volume,voting->quorum,voting->type_participants,voting->type,voting->count_type_voters,voting->type_decision,voting->description,optional->role_id,optional->role_vacancies,optional->number_candidates,optional->contract_accept,optional->contract_reject,progress->number_participants,progress->number_voters,progress->percent_success,progress->percent_voters,flags->success,flags->full_data,flags->decision,flags->notifics,date_started,date_ended,status\").Vars(instance)\r\n        SetVar(type_decision,#instance_voting_type_decision#)\r\n        SetVar(type_participants,#instance_voting_type_participants#)\r\n\r\n        SetVar(isVotingAllowed,0)\r\n        SetVar(isStartProcessing,0)\r\n        If(Or(#type_participants#==1,#type_participants#==2,#type_participants#==3,#type_participants#==4)){\r\n            DBFind(@1votings_participants).Where({voting_id:#vID#,\"member->member_id\":#key_id#, decision:0, ecosystem: #ecosystem_id#}).Columns(\"id\").Vars(flag_participant)\r\n            If(And(#instance_status#==#STARTED#,#flag_participant_id#>0)){\r\n                DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, \"recipient->member_id\":#key_id#, page_name:#this_page#, \"page_params->voting_id\": #vID#, closed:0}).Columns(\"id,notification->type,date_start_processing\").Vars(notificcc)\r\n                If(#notificcc_id#>0){\r\n                    SetVar(isVotingAllowed,1)\r\n                    SetVar(notific_id,#notificcc_id#)\r\n                    If(And(#notificcc_notification_type#==2,#notificcc_date_start_processing#==\"\")){\r\n                        SetVar(isStartProcessing,1)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        If(#type_participants#==5){\r\n            DBFind(@1votings_participants).Where({voting_id:#vID#,\"member->role_id\":#role_id#, decision:0, ecosystem: #ecosystem_id#}).Columns(\"id\").Vars(flag_participant)\r\n            If(And(#instance_status#==#STARTED#,#flag_participant_id#>0)){\r\n                DBFind(@1notifications).Where({{\"$or\":[{\"date_start_processing\": \"$isnull\"}, {\"processing_info->member_id\": #key_id#}]}, \"ecosystem\":#ecosystem_id#, \"recipient->role_id\":#role_id#, \"page_name\":#this_page#, \"page_params->voting_id\": #vID#, \"closed\":0}).Columns(\"id,notification->type,date_start_processing\").Vars(notificcc)\r\n                If(#notificcc_id#>0){\r\n                    SetVar(isVotingAllowed,1)\r\n                    SetVar(notific_id,#notificcc_id#)\r\n                    If(And(#notificcc_notification_type#==2,#notificcc_date_start_processing#==\"\")){\r\n                        SetVar(isStartProcessing,1)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        SetTitle(#instance_voting_name#)\r\n        Div(breadcrumb){\r\n            LinkPage(Body: $@1polls$, Page: @1poll, PageParams: \"type=0\")\r\n            Span(/,mh)\r\n            Span(Class: text-muted, Body: ##instance_id#)\r\n        }\r\n\r\n        Div(row mt-sm){\r\n            Div(col-lg-6 col-lg-offset-3){\r\n                Form(panel panel-primary){\r\n                    Input(Type: hidden, Name: votingID, Value: #vID#)\r\n\r\n                    Div(list-group-item text-center){\r\n                        P(Class: h3 text-bold m0, Body: #instance_voting_name#)\r\n                    }\r\n                    Div(list-group-item text-center){\r\n                        If(#type_decision#==3){\r\n                            DBFind(@1votings_subject, src_voting_subject).Where({voting_id:#vID#}).Columns(\"id,subject->text,subject->hash\").Vars(subject)\r\n                            Div(row){\r\n                                Div(#col_left#){\r\n                                    Label(For: TypeParticipants){\r\n                                        Span(Body: $@1question$:)\r\n                                    }\r\n                                }\r\n                                Div(#col_right#){\r\n                                    #subject_subject_text#\r\n                                }\r\n                            }\r\n                            Div(row mt-sm t5){\r\n                                Div(col-md-12){\r\n                                    If(And(Or(#instance_status#==#INVALID#,#instance_status#==#WAITING#),#instance_voting_type#==3)){\r\n                                        Button(Class: btn btn-link, Page: @1poll_decision, PageParams: \"vID=#vID#\"){\r\n                                            Strong(LangRes(@1subject_voting_edit))\r\n                                        }.Popup(50, $@1subject_voting$)\r\n                                    }\r\n                                }\r\n                            }\r\n                            Div(row mt-sm){\r\n                                Div(col-sm-6 col-sm-offset-2 col-lg-8 col-lg-offset-2){\r\n                                    If(#isStartProcessing#==1){\r\n                                        Button(Body: LangRes(@1process), Class: btn btn-info text-capitalize, Contract: @1NotificationsProcess, Params: \"notific_id=#notific_id#\", Page: #this_page#, PageParams: \"notific_id=#notific_id#\")\r\n                                    }.Else{\r\n                                        If(#isVotingAllowed#==1){\r\n                                            Button(Body: $@1no$, Class: btn btn-danger pull-left, Contract: @1VotingDecisionReject, PageParams: \"vID=#vID#\", Page: #this_page#, Params: \"RoleId=#role_id#\")\r\n                                            Button(Body: $@1yes$, Class: btn btn-success pull-right, Contract: @1VotingDecisionAccept, PageParams: \"vID=#vID#\", Page: #this_page#, Params: \"RoleId=#role_id#\")\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    Div(list-group-item text-center){\r\n                        Div(row t4){\r\n                            Div(col-md-5 col-md-offset-1){\r\n                                LangRes(@1voted)\r\n                            }\r\n                            Div(col-md-5){\r\n                                LangRes(@1progress)\r\n                            }\r\n                        }\r\n                        If(graph_work==\"good\"){\r\n                            Div(row text-muted t6 text-center){\r\n                                Div(col-md-5 col-md-offset-1){\r\n                                    LangRes(@1voting_graph_voted)\r\n                                }\r\n                                Div(col-md-5){\r\n                                    LangRes(@1voting_graph_progress)\r\n                                }\r\n                            }\r\n                        }\r\n                        Div(row text-center t3){\r\n                            If(#instance_voting_count_type_voters# == 1){\r\n                                Div(col-md-5 col-md-offset-1){\r\n                                    #instance_progress_number_voters# LangRes(@1voters) / #instance_voting_volume# LangRes(@1voters)\r\n                                }\r\n                                Div(col-md-5){\r\n                                    #instance_progress_percent_success#% LangRes(@1success) / 100% LangRes(@1total)\r\n                                }\r\n                            }.Else{\r\n                                Div(col-md-5 col-md-offset-1){\r\n                                    #instance_progress_number_voters# LangRes(@1voters) / #instance_progress_percent_voters#% LangRes(@1voters)\r\n                                }\r\n                                Div(col-md-5){\r\n                                    #instance_progress_percent_success#% LangRes(@1success) / 100% LangRes(@1total)\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }.Else{\r\n        Div(md-12 alert alert-danger text-center){\r\n            Span(Body: LangRes(@1attention))\r\n        }\r\n    }\r\n}.Style(\r\n    .t3 {font-size:24px;}\r\n    .t4 {font-size:18px;}\r\n    .t5 {font-size:14px;}\r\n    .t6 {font-size:12px;}\r\n    .break {word-break: break-all;}\r\n)\r\n",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "poll_vote",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Columns(\"name,id\").Where({ecosystem:1, name:\"Basic\"}).Vars(application)\r\nIf(#notific_id#>0){\r\n    DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, id:#notific_id#}).Columns(\"page_params->voting_id\").Vars(notific)\r\n    SetVar(vID,#notific_page_params_voting_id#)\r\n}\r\n\r\nSetVar(WAITING,1).(VALID,2).(STARTED,3).(FINISHED,4).(INVALID,5)\r\nSetVar(date_format,\"DD.MM.YYYY HH:MI\")\r\nSetVar(this_page,\"@1poll_view\")\r\nSetVar(col_right,\"col-md-6 text-left h3\")\r\nSetVar(col_left,\"col-md-6 text-right h3\")\r\n\r\n    If(#vID# > 0){\r\n        DBFind(@1votings, Source: charts).WhereId(#vID#).Columns(\"id,voting->name,voting->volume,voting->quorum,voting->type_participants,voting->type,voting->count_type_voters,voting->type_decision,voting->description,optional->role_id,optional->role_vacancies,optional->number_candidates,optional->contract_accept,optional->contract_reject,progress->number_participants,progress->number_voters,progress->percent_success,progress->percent_voters,flags->success,flags->full_data,flags->decision,flags->notifics,date_started,date_ended,status\").Vars(instance)\r\n        SetVar(type_decision,#instance_voting_type_decision#)\r\n        SetVar(type_participants,#instance_voting_type_participants#)\r\n\r\n        SetVar(isVotingAllowed,0)\r\n        SetVar(isStartProcessing,0)\r\n        If(Or(#type_participants#==1,#type_participants#==2,#type_participants#==3,#type_participants#==4)){\r\n            DBFind(@1votings_participants).Where({voting_id:#vID#,\"member->member_id\":#key_id#, decision:0, ecosystem: #ecosystem_id#}).Columns(\"id\").Vars(flag_participant)\r\n            If(And(#instance_status#==#STARTED#,#flag_participant_id#>0)){\r\n                DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, \"recipient->member_id\":#key_id#, page_name:#this_page#, \"page_params->voting_id\": #vID#, closed:0}).Columns(\"id,notification->type,date_start_processing\").Vars(notificcc)\r\n                If(#notificcc_id#>0){\r\n                    SetVar(isVotingAllowed,1)\r\n                    SetVar(notific_id,#notificcc_id#)\r\n                    If(And(#notificcc_notification_type#==2,#notificcc_date_start_processing#==\"\")){\r\n                        SetVar(isStartProcessing,1)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        If(#type_participants#==5){\r\n            DBFind(@1votings_participants).Where({voting_id:#vID#,\"member->role_id\":#role_id#, decision:0, ecosystem: #ecosystem_id#}).Columns(\"id\").Vars(flag_participant)\r\n            If(And(#instance_status#==#STARTED#,#flag_participant_id#>0)){\r\n                DBFind(@1notifications).Where({{\"$or\":[{\"date_start_processing\": \"$isnull\"}, {\"processing_info->member_id\": #key_id#}]}, \"ecosystem\":#ecosystem_id#, \"recipient->role_id\":#role_id#, \"page_name\":#this_page#, \"page_params->voting_id\": #vID#, \"closed\":0}).Columns(\"id,notification->type,date_start_processing\").Vars(notificcc)\r\n                If(#notificcc_id#>0){\r\n                    SetVar(isVotingAllowed,1)\r\n                    SetVar(notific_id,#notificcc_id#)\r\n                    If(And(#notificcc_notification_type#==2,#notificcc_date_start_processing#==\"\")){\r\n                        SetVar(isStartProcessing,1)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n    Div(Class: col-md-12 pl){\r\n        Form(row mt-sm){\r\n            Input(Type: hidden, Name: votingID, Value: #vID#)\r\n            Div(text-center){\r\n                P(Class: h3 text-bold m0, Body: #instance_voting_name#)\r\n            }\r\n            Div(pl){\r\n                If(#type_decision#==3){\r\n                    DBFind(@1votings_subject, src_voting_subject).Where({voting_id:#vID#}).Columns(\"id,subject->text,subject->hash\").Vars(subject)\r\n                    Div(row){\r\n                        Div(col-md-6 text-right h4 text-bold){\r\n                            Label(For: TypeParticipants){\r\n                                Span(Body: $@1question$:)\r\n                            }\r\n                        }\r\n                        Div(col-md-6 text-left h4 text-muted){\r\n                            #subject_subject_text#\r\n                        }\r\n                    }\r\n                    Div(row mt-sm pt-lg text-center){\r\n                        Div(col-sm-6 col-sm-offset-2 col-lg-8 col-lg-offset-2){\r\n                            If(#isStartProcessing#==1){\r\n                                Button(Body: LangRes(@1process), Class: btn btn-info text-capitalize, Contract: @1NotificationsProcess, Params: \"notific_id=#notific_id#\", Page: #this_page#, PageParams: \"notific_id=#notific_id#\")\r\n                            }.Else{\r\n                                If(#isVotingAllowed#==1){\r\n                                    Div(row){\r\n                                        Div(Class: col-md-6 text-right){\r\n                                            Button(Body:$@1no$, Class: btn btn-danger, Contract: @1VotingDecisionReject, PageParams: \"vID=#vID#,type=0\", Page: @1poll, Params: \"RoleId=#role_id#\")\r\n                                        }\r\n                                        Div(Class: col-md-6 text-left){\r\n                                            Button(Body:$@1yes$, Class: btn btn-success, Contract: @1VotingDecisionAccept, PageParams: \"vID=#vID#,type=0\", Page: @1poll, Params: \"RoleId=#role_id#\")\r\n                                        }\r\n                                    }  \r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    Div(Class: pt-xl){\r\n                        Button(Body: $@1close$, Class: btn btn-default pull-left, Page: @1poll, PageParams: \"type=0\")\r\n                    }\r\n                } \r\n            }\r\n        }\r\n    }\r\n}.Else{\r\n    Div(md-12 alert alert-danger text-center){\r\n        Span(Body: LangRes(@1attention))\r\n    }\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        }
    ]
}