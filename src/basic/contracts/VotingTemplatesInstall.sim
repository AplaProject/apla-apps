contract VotingTemplatesInstall {
    data {
        fill_ids string "optional"
    }

    func applyTemplate(m map, param string) {
        var templateId paramId int
        templateId = DBInsert("@1voting_templates", m)
        if $fill_ids == "yes" {
            paramId = Int(DBFind("@1app_params").Where({name:param, ecosystem: $ecosystem_id}).One("id"))
            @1EditAppParam("Id,Value", paramId, templateId)
        }
    }

    func getRoleId(name string) int {
        var rid int
        rid = Int(EcosysParam(name))
        if rid == 0{
            warning Sprintf(LangRes("@1role_not_set_eco_parameter", "en"), name)
        }
        return rid
    }

    func installSystem() {
        var template map
        // common
        template["quorum"] = 51
        template["volume"] = 70
        template["accept_params"] = ""
        template["reject_params"] = ""
        template["type"] = "law"
        template["voters"] = $consensusRoleId
        template["type_participants"] = 3 // by Role
        template["type_voting"] = 2
        template["ecosystem"] = $ecosystem_id

        // validator
        template["title"] = "Voting for Validator"
        template["init_contract"] = "VotingValidatorInit"
        template["contract_accept"] = "VotingValidatorAccept"
        template["contract_reject"] = ""
        template["vacancies"] = 1
        template["candidates"] = $validatorRoleId
        template["type_decision"] = 2
        template["subject"] = "Validator"
        applyTemplate(template, "voting_validators_template_id")

        // sysparam
        template["title"] = "Voting for System param value"
        template["init_contract"] = ""
        template["contract_accept"] = ""
        template["contract_reject"] = ""
        template["vacancies"] = 0
        template["candidates"] = 0
        template["type_decision"] = 4
        template["subject"] = "System param"
        applyTemplate(template, "voting_sysparams_template_id")

        // valued ecosystem
        template["title"] = "Voting for Valued Ecosystem"
        template["init_contract"] = ""
        template["contract_accept"] = ""
        template["contract_reject"] = ""
        template["vacancies"] = 0
        template["candidates"] = 0
        template["type_decision"] = 4
        template["subject"] = "Valued ecosystem"
        applyTemplate(template, "voting_ves_template_id")

        // tokenrefund
        template["title"] = "Token Refund"
        template["init_contract"] = ""
        template["contract_accept"] = "TokensRefundAccept"
        template["contract_reject"] = "TokensRefundReject"
        template["vacancies"] = 0
        template["candidates"] = 0
        template["type_decision"] = 5
        template["subject"] = "Token refund"
        applyTemplate(template, "voting_tokenrefund_template_id")
    }
    func installCustom() {
        var template map
        // A decision by a simple majority of votes
        // Принятие решения простым большинством голосов
        template["title"] = "A decision by a simple majority of votes"
        template["subject"] = "Simple decision"
        template["quorum"] = 51
        template["volume"] = 100
        template["accept_params"] = ""
        template["reject_params"] = ""
        template["type"] = "custom"
        template["voters"] = 0 //
        template["type_participants"] = 1 // all
        template["type_voting"] = 1
        template["ecosystem"] = $ecosystem_id
        template["init_contract"] = ""
        template["contract_accept"] = ""
        template["contract_reject"] = ""
        template["vacancies"] = 1
        template["candidates"] = 0
        template["type_decision"] = 3
        DBInsert("@1voting_templates", template)

        var template map
        // The vote for assigning the role of one candidate
        // Голосование за присвоение роли одному кандидату
        template["title"] = "The vote for assigning the role of one candidate"
        template["subject"] = "Role assign"
        template["quorum"] = 51
        template["volume"] = 100
        template["accept_params"] = ""
        template["reject_params"] = ""
        template["type"] = "custom"
        template["voters"] = 0 //
        template["type_participants"] = 1 // all
        template["type_voting"] = 1
        template["ecosystem"] = $ecosystem_id
        template["init_contract"] = ""
        template["contract_accept"] = "@1RolesAssign"
        template["contract_reject"] = ""
        template["vacancies"] = 1
        template["candidates"] = 0
        template["type_decision"] = 2
        DBInsert("@1voting_templates", template)
    }

    conditions {
        $consensusRoleId = getRoleId("role_apla_consensus_asbl")
        $validatorRoleId = getRoleId("role_validator")
    }

    action {
        installSystem()
        installCustom()
    }
}