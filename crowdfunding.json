{
    "name": "Crowdfunding",
    "conditions": "ContractConditions(\"@1DeveloperCondition\")",
    "data": [
        {
            "Name": "role_settings",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(role_admin,0).(role_developer,0)\nSetVar(role_admin, EcosysParam(Name:role_sale_admin))\nSetVar(role_developer, EcosysParam(Name:role_developer))\n\nDBFind(@1roles,roles).Where({ecosystem:#ecosystem_id#, deleted:0}).Columns(\"role_name,id\").Limit(100).Count(roles_count)\nIf(#row#==\"\"){\n    SetVar(row,\"row mt-sm\")\n}\nIf(#col_left#==\"\"){\n    SetVar(col_left,\"col-sm-4 text-right mt-sm\")\n}\nIf(#col_right#==\"\"){\n    SetVar(col_right,\"col-sm-8 text-left\")\n}\n\nForm(panel panel-primary){\n    Input(Name:RolesParam, Type:hidden, Value: #roles_param#)\n    Input(Name:AppId, Type:hidden, Value: #application_id#)\n\n    Div(panel-body){\n        Div(#row#){\n            Div(col-sm-12 text-center text-muted){\n                $@1role_settings_description$\n            }\n        }\n        If(#roles_count#>0){\n            ForList(app_roles){\n                Div(#row#){\n                    Div(#col_left#){\n                        #name#\n                        Input(Name:AppIds, Type:hidden, Value:#id#)\n                    }\n                    Div(#col_right#){\n                        Select(Name:Ids, Source:roles, NameColumn: role_name, ValueColumn: id)\n                    }\n                }\n            }\n        }.Else{\n            Div(text-center h4 text-muted){\n                $@1roles$ $@1not_founded$\n            }\n        }\n    }\n    Div(panel-footer text-center){\n        If(#roles_count#>0){\n            Button(Body: $@1apply_settings$, Class: btn btn-primary, Page: #this_page#, Contract: @1AppRolesSettings)\n        }\n    }\n}",
            "Type": "blocks"
        },
        {
            "Name": "admin_menu",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "MenuItem(Title:$@1cf_settings$, Page:@1cf_settings, Icon:\"icon-credit-card\")",
            "Type": "menu"
        },
        {
            "Name": "default_menu",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "MenuItem(Title:$@1cf_startups$, Page:@1cf_startups, Icon:\"icon-credit-card\")\nMenuItem(Title:$@1cf_investments$, Page:@1cf_investments, Icon:\"icon-credit-card\")",
            "Type": "menu"
        },
        {
            "Name": "cf_add_company",
            "Trans": "{\"en\": \"Add company\", \"ru\": \"Добавить кампанию\"}",
            "Type": "languages"
        },
        {
            "Name": "cf_catalog_admin",
            "Trans": "{\"en\": \"Catalog admin\", \"ru\": \"Администратор каталога\"}",
            "Type": "languages"
        },
        {
            "Name": "cf_company",
            "Trans": "{\"en\": \"Campaign\", \"ru\": \"Кампания\"}",
            "Type": "languages"
        },
        {
            "Name": "cf_company_wallet",
            "Trans": "{\"en\": \"The wallet for the investment\", \"ru\": \"Кошелек для инвестиций\"}",
            "Type": "languages"
        },
        {
            "Name": "cf_created",
            "Trans": "{\"en\": \"Created\", \"ru\": \"Создано\"}",
            "Type": "languages"
        },
        {
            "Name": "cf_escrow_name",
            "Trans": "{\"en\": \"The escrow name\", \"ru\": \"Эскроу имя\"}",
            "Type": "languages"
        },
        {
            "Name": "cf_escrow_wallet",
            "Trans": "{\"en\": \"The escrow wallet\", \"ru\": \"Эскроу кошелек\"}",
            "Type": "languages"
        },
        {
            "Name": "cf_estimated_amount",
            "Trans": "{\"en\": \"The estimated amount of investments\", \"ru\": \"Ожидаемый размер инвестиций\"}",
            "Type": "languages"
        },
        {
            "Name": "cf_finish_company",
            "Trans": "{\"en\": \"Finish Campaign\", \"ru\": \"Завершить кампанию\"}",
            "Type": "languages"
        },
        {
            "Name": "cf_finished",
            "Trans": "{\"en\": \"Finished\", \"ru\": \"Закончено\"}",
            "Type": "languages"
        },
        {
            "Name": "cf_invest",
            "Trans": "{\"en\": \"To invest\", \"ru\": \"Инвестировать\"}",
            "Type": "languages"
        },
        {
            "Name": "cf_investments",
            "Trans": "{\"en\": \"Investment\", \"ru\": \"Инвестиции\"}",
            "Type": "languages"
        },
        {
            "Name": "cf_minimal_investment",
            "Trans": "{\"en\": \"The minimum amount of investment\", \"ru\": \"Минимальный размер инвестиции\"}",
            "Type": "languages"
        },
        {
            "Name": "cf_published",
            "Trans": "{\"en\": \"Published\", \"ru\": \"Опубликовано\"}",
            "Type": "languages"
        },
        {
            "Name": "cf_rejected",
            "Trans": "{\"en\": \"Rejected\", \"ru\": \"Отклонено\"}",
            "Type": "languages"
        },
        {
            "Name": "cf_settings",
            "Trans": "{\"en\": \"Crowdfunding app settings\", \"ru\": \"Настройки приложения Crowdfunding\"}",
            "Type": "languages"
        },
        {
            "Name": "cf_started",
            "Trans": "{\"en\": \"Active\", \"ru\": \"Активно\"}",
            "Type": "languages"
        },
        {
            "Name": "cf_startup",
            "Trans": "{\"en\": \"Startup\", \"ru\": \"Стартап\"}",
            "Type": "languages"
        },
        {
            "Name": "cf_startup_form",
            "Trans": "{\"en\": \"Campaign parameters\", \"ru\": \"Параметры кампании\"}",
            "Type": "languages"
        },
        {
            "Name": "cf_startups",
            "Trans": "{\"en\": \"Startups\", \"ru\": \"Стартапы\"}",
            "Type": "languages"
        },
        {
            "Name": "reset",
            "Trans": "{\"en\": \"Reset\", \"ru\": \"Сброс\"}",
            "Type": "languages"
        },
        {
            "Name": "role_settings_description",
            "Trans": "{\"en\": \"Compliance application roles roles of ecosystem\", \"ru\": \"Соответствие ролей приложения ролям экосистемы\"}",
            "Type": "languages"
        },
        {
            "Name": "web_address",
            "Trans": "{\"en\": \"The link to the site\", \"ru\": \"Ссылка на сайт\"}",
            "Type": "languages"
        },
        {
            "Name": "cf_investments",
            "Columns": "[\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFInvestment\\\")\",\n        \"name\": \"startup_id\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFInvestment\\\")\",\n        \"name\": \"investment_wallet\",\n        \"type\": \"varchar\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFInvestment\\\")\",\n        \"name\": \"amount\",\n        \"type\": \"money\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFInvestment\\\")\",\n        \"name\": \"created_at\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFInvestment\\\")\",\n        \"name\": \"refund_at\",\n        \"type\": \"number\"\n    }\n]",
            "Permissions": "{\"insert\":\"true\",\"update\":\"true\",\"new_column\":\"true\"}",
            "Type": "tables"
        },
        {
            "Name": "cf_startups",
            "Columns": "[\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFStartup\\\")\",\n        \"name\": \"ecosystem\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFStartup\\\")\",\n        \"name\": \"name\",\n        \"type\": \"varchar\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFStartup\\\")\",\n        \"name\": \"description\",\n        \"type\": \"text\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFStartup\\\")\",\n        \"name\": \"wallet\",\n        \"type\": \"varchar\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFStartup\\\")\",\n        \"name\": \"escrow_wallet\",\n        \"type\": \"varchar\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFStartup\\\")\",\n        \"name\": \"escrow_name\",\n        \"type\": \"varchar\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFStartup\\\")\",\n        \"name\": \"web_address\",\n        \"type\": \"varchar\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFStartup\\\")\",\n        \"name\": \"registered_at\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFStartup\\\")\",\n        \"name\": \"published_at\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFStartup\\\")\",\n        \"name\": \"started_at\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFStartup\\\")\",\n        \"name\": \"finished_at\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFStartup\\\")\",\n        \"name\": \"estimated_amount\",\n        \"type\": \"money\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFStartup\\\")\",\n        \"name\": \"minimal_investment\",\n        \"type\": \"money\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFStartup\\\")\",\n        \"name\": \"current_investment\",\n        \"type\": \"money\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFStartup\\\")\",\n        \"name\": \"token_info\",\n        \"type\": \"json\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFStartup\\\")\",\n        \"name\": \"failed_at\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFStartup\\\")\",\n        \"name\": \"deleted_at\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFStartup\\\")\",\n        \"name\": \"stopped_at\",\n        \"type\": \"number\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFStartup\\\")\",\n        \"name\": \"date_started\",\n        \"type\": \"varchar\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFStartup\\\")\",\n        \"name\": \"date_finished\",\n        \"type\": \"varchar\"\n    },\n    {\n        \"conditions\": \"ContractAccess(\\\"@1CFStartup\\\")\",\n        \"name\": \"status\",\n        \"type\": \"number\"\n    }\n]",
            "Permissions": "{\"insert\":\"true\",\"update\":\"true\",\"new_column\":\"true\"}",
            "Type": "tables"
        },
        {
            "Name": "cf_catalog_admin",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "0",
            "Type": "app_params"
        },
        {
            "Name": "cf_roles",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "cf_catalog_admin",
            "Type": "app_params"
        },
        {
            "Name": "cf_status",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "cf_created,cf_published,cf_started,cf_finished,cf_failed,cf_stopped,cf_rejected",
            "Type": "app_params"
        },
        {
            "Name": "cf_admin_notification",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "SetVar(back_page,@1cf_startups).(this_page,@1cf_admin_notification)\nTODO: Админ экосистемы стартапа подтверждает заявку, создает кошелек\nSetVar(this_page,@1cf_invest_notification)\nIf(#back_page#==\"\"){\n    SetVar(back_page, @1cf_investments)\n}\nTODO: Инвестор получает оповещение и на странице оповещения переводит токены APLA на кошелек стартапа\nIf(#notific_id#>0){\n    SetVar(errand_id,#notific_id#)\n    DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, id:#notific_id#}).Columns(\"id,page_params->startup_id,page_params->amount,page_params->investment_wallet\").Vars(notific)\n}.Else{\n    SetVar(norific_id,0)\n}\n\n\n\nDBFind(@1keys).Where({\"ecosystem\": #ecosystem_id#, \"id\": #key_id#}).Vars(tokens)\nDBFind(@1ecosystems).Where({\"id\": #ecosystem_id#}).Vars(eco)\nIf(#ecosystem_id# == 1){\n    SetVar(token_title, \"APLA\")\n}.Else{\n    SetVar(token_title, #eco_token_title#)\n}\n\nIf(Or(#ecosystem_id# == 1, GetVar(eco_token_title) != \"\")){\n    Form(){\n        Div(row){\n            Div(col-sm-3 mt-sm text-right){\n                Label($@1sender$)\n            }\n            Div(col-sm-9){\n                SetVar(m_a, Address(#key_id#) (Money(#tokens_amount#) #token_title#))\n                Input(Name: Sender, Disabled: 1, Value: #m_a#)\n                Div(Class: m0 h6 text-muted, Body: $@1send_tokens_my_balance$)\n            }\n        }\n        Div(row mt){\n            Div(col-sm-3 mt-sm text-right){\n                Label($@1recipient$)\n            }\n            Div(col-sm-9){\n                SetVar(Recipient, Address(#notific_page_params_investment_wallet#))\n                Input(Name: Recipient, Disabled: 1, Value: #Recipient#)\n            }\n        }\n        Div(row mt-sm){\n            Div(col-sm-3 mt-sm text-right){\n                Label(){\n                    Span(Body: $@1amount$ (#token_title#))\n                }\n            }\n            Div(col-sm-9){\n                Input(Name: Amount, Disabled: 1, Type: number, Value: #notific_page_params_amount#)\n            }\n        }\n        Div(text-right mt){\n            Button(Body: $@1back$, Class: btn btn-default, Page: #back_page#)\n            Button(Body: $@1reject$, Class: btn btn-danger, Page: #back_page#, Contract: @1CFInvestmentAdmin, Params: \"NotificId=#notific_id#,Action=reject\").\n            Button(Body: $@1confirm$, Class: btn btn-primary, Page: #back_page#, Contract: @1CFInvestmentAdmin, Params: \"NotificId=#notific_id#,Action=accept\").\n        }\n    }\n}.Else{\n    Form(){\n        Div(row){\n            Div(col-sm-12){\n                Span(Body: $@1ecosystem_no_tokens$)\n            }\n        }\n        Button(Body: $@1back$, Class: btn btn-default pull-right mt, Page: #back_page#)\n    }\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "cf_company",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(this_page, @1cf_company).(back_page,@1cf_startups)\nSetVar(startup_id,0)\n\nSetTitle($@1cf_company$)\nSetVar(isAdmin,0).(isWalletOwner,0).(isStartupAdmin,0)\nSetVar(catalogAdmin, AppParam(App:#application_id#, Name:cf_catalog_admin, Ecosystem:1))\nIf(#role_id#>0){\n    If(#catalogAdmin#==#role_id#){\n        SetVar(isAdmin,1)\n    }\n}\nIf(#Id#!=\"\"){\n    DBFind(@1cf_startups).WhereId(#Id#).Vars(startup)\n    If(#startup_wallet#==Address(#key_id#)){\n        SetVar(isWalletOwner,1)\n    }\n    SetVar(startupAdminRole_id,0)\n    DBFind(@1parameters).Where({name:\"role_admin\", ecosystem:#startup_ecosystem#}).Columns(\"id,value\").Vars(startupAdminRole)\n    If(#startupAdminRole_id#>0){\n        DBFind(@1roles_participants).Where({\"role->id\":#startupAdminRole_value#, \"member->member_id\": #key_id#, ecosystem:#ecosystem#}).Vars(startupAdmin)\n        If(#startupAdmin_id#>0){\n            SetVar(isStartupAdmin,1)\n        }\n    }\n}\nDiv(breadcrumb-sm){\n    LinkPage(Body: $@1cf_startups$, Page: @1cf_startups)\n    Span(/, mh)\n    Span($@1cf_company$, text-muted)\n}\nDiv(row){\n    Div(col-sm-12 col-lg-6 col-lg-offset-3){\n        Div(panel panel-default){\n            If(#startup_id#>0){\n                Div(panel-body){\n                    Div(row mb-sm){\n                        Div(col-sm-6 text-right){\n                            Label(For: Ecosystem){\n                                $@1ecosystem$\n                            }\n                        }\n                        Div(col-sm-6){\n                            #startup_ecosystem#\n                        }\n                    }\n\n                    Div(row mb-sm){\n                        Div(col-sm-6 text-right){\n                            Label(For: Description){\n                                $@1description$\n                            }\n                        }\n                        Div(col-sm-6){\n                            #startup_description#\n                        }\n                    }\n                    Div(row mb-sm){\n                        Div(col-sm-6 text-right){\n                            Label(For: Wallet){\n                                $@1cf_company_wallet$\n                            }\n                        }\n                        Div(col-sm-6){\n                            #startup_wallet#\n                        }\n                    }\n                    Div(row mb-sm){\n                        Div(col-sm-6 text-right){\n                            Label(For: WalletEscrow){\n                                $@1cf_escrow_wallet$\n                            }\n                        }\n                        Div(col-sm-6){\n                            #startup_escrow_wallet#\n                        }\n                    }\n                    Div(row mb-sm){\n                        Div(col-sm-6 text-right){\n                            Label(For: WebAddress){\n                                $@1web_address$\n                            }\n                        }\n                        Div(col-sm-6){\n                            #startup_web_address#\n                        }\n                    }\n                    Div(row mb-sm){\n                        Div(col-sm-6 text-right){\n                            Label(For: StartDate){\n                                $@1date_start$\n                            }\n                        }\n                        Div(col-sm-6){\n                            DateTime(#startup_started_at#, Format: YYYY-MM-DD)\n                        }\n                    }\n                    Div(row mb-sm){\n                        Div(col-sm-6 text-right){\n                            Label(For: EndDate){\n                                $@1date_end$\n                            }\n                        }\n                        Div(col-sm-6){\n                            DateTime(#startup_finished_at#, Format: YYYY-MM-DD)\n                        }\n                    }\n\n                    Div(row mb-sm){\n                        Div(col-sm-6 text-right){\n                            Label(For: Estimated){\n                                $@1cf_estimated_amount$\n                            }\n                        }\n                        Div(col-sm-6){\n                            Money(#startup_estimated_amount#)\n                        }\n                    }\n                    Div(row mb-sm){\n                        Div(col-sm-6 text-right){\n                            Label(For: Minimal){\n                                $@1cf_minimal_investment$\n                            }\n                        }\n                        Div(col-sm-6){\n                            Money(#startup_minimal_investment#)\n                        }\n                    }\n                    Div(){\n                        LinkPage(Body: $@1cf_investments$, Page: @1cf_investments, PageParams: \"Id=#Id#\")\n                    }\n                }\n            }\n\n            Form(panel-footer text-right){\n                Button(Body: $@1back$, Class: btn btn-default, Page: #back_page#)\n                If(#startup_id#>0){\n                    If(#isAdmin#==0){\n                        If(Or(#isWalletOwner#==1,#isStartupAdmin#==1)){\n                            Button(Body: $@1cf_finish_company$, Class: btn btn-primary, Page: #back_page#, Contract:@1CFAdmin, Params: \"Id=#Id#,Action=finish\")\n                        }.Else{\n                            SetVar(wallet_id,0)\n                            DBFind(@1keys).Where({id:#key_id#, ecosystem:#startup_ecosystem#}).Vars(wallet)\n                            Div(input-group){\n                                Div(input-group-addon){\n                                    $@1cf_invest$\n                                }\n                                Input(Name: Amount, Type:number, Value: #startup_minimal_investment#)\n                                Div(input-group-btn){\n                                    If(#wallet_id#==0){\n                                        Button(Body: $@1cf_investment_offer$, Class: btn btn-primary, Page: #back_page#, Contract:@1CFInvestmentOffer, Params: \"Id=#Id#,Amount=Val(Amount)\")\n                                    }.Else{\n                                        Button(Body: $@1send$, Class: btn btn-default, Page: #back_page#, Contract:@1CFInvestment, Params: \"Id=#Id#,Amount=Val(Amount)\")\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}.Style(\n    .buttons {\n        border: 1px solid #dde6e9;\n        padding: 6px 16px;\n    }\n)",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "cf_invest_notification",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "SetVar(this_page,@1cf_invest_notification)\nIf(#back_page#==\"\"){\n    SetVar(back_page, @1cf_investments)\n}\nIf(#notific_id#>0){\n    SetVar(errand_id,#notific_id#)\n    DBFind(@1notifications).Where({ecosystem:#ecosystem_id#, id:#notific_id#}).Columns(\"id,page_params->startup_id,page_params->amount,page_params->investment_wallet\").Vars(notific)\n}.Else{\n    SetVar(norific_id,0)\n}\n\n\n\nDBFind(@1keys).Where({\"ecosystem\": #ecosystem_id#, \"id\": #key_id#}).Vars(tokens)\nDBFind(@1ecosystems).Where({\"id\": #ecosystem_id#}).Vars(eco)\nIf(#ecosystem_id# == 1){\n    SetVar(token_title, \"APLA\")\n}.Else{\n    SetVar(token_title, #eco_token_title#)\n}\n\nIf(Or(#ecosystem_id# == 1, GetVar(eco_token_title) != \"\")){\n    Form(){\n        Div(row){\n            Div(col-sm-3 mt-sm text-right){\n                Label($@1sender$)\n            }\n            Div(col-sm-9){\n                SetVar(m_a, Address(#key_id#) (Money(#tokens_amount#) #token_title#))\n                Input(Name: Sender, Disabled: 1, Value: #m_a#)\n                Div(Class: m0 h6 text-muted, Body: $@1send_tokens_my_balance$)\n            }\n        }\n        Div(row mt){\n            Div(col-sm-3 mt-sm text-right){\n                Label($@1recipient$)\n            }\n            Div(col-sm-9){\n                SetVar(Recipient, Address(#notific_page_params_investment_wallet#))\n                Input(Name: Recipient, Disabled: 1, Value: #Recipient#)\n            }\n        }\n        Div(row mt-sm){\n            Div(col-sm-3 mt-sm text-right){\n                Label(){\n                    Span(Body: $@1amount$ (#token_title#))\n                }\n            }\n            Div(col-sm-9){\n                Input(Name: Amount, Type: number, Value: #notific_page_params_amount#)\n            }\n        }\n        Button(Body: LangRes(@1send), Class: btn btn-primary pull-right mt, Page: #back_page#, Contract: @1CFInvestment, Params: \"Id=#notific_page_params_startup_id#\").Alert(Text: \"$@1want_send_tokens$\", ConfirmButton: $@1yes$, CancelButton: $@1no$, Icon: question)\n        Button(Body: LangRes(@1back), Class: btn btn-default pull-right mt, Page: #back_page#)\n    }\n}.Else{\n    Form(){\n        Div(row){\n            Div(col-sm-12){\n                Span(Body: $@1ecosystem_no_tokens$)\n            }\n        }\n        Button(Body: LangRes(@1back), Class: btn btn-default pull-right mt, Page: #back_page#)\n    }\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "cf_investment_form",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(back_page,@1cf_startups).(startup_id,0)\n\nIf(#Id#>0){\n    DBFind(@1startups).WhereId(#Id#).Vars(startup)\n}\nForm(){\n    If(#startup_id#>0){\n        Div(mb-sm text-muted){\n            $@1investment_amount$\n        }\n        Div(mb-sm){\n            Input(Name: Amount, Value: #startup_minimal_investment#)\n            TODO: валидация минимальной суммы\n        }\n    }.Else{\n        Div(text-center h4 text-muted){\n            $@1cf_startup$ $@1not_founded$\n        }\n    }\n    Div(){\n        If(#startup_id#>0){\n            Button(Body: $@1send$, Class: btn btn-primary pull-right mt, Page: #back_page#, Contract: @1CFInvestment, Params: \"Id=#Id#\")\n        }\n        Button(Body: $@1back$, Class: btn btn-default pull-right mt, Page: #back_page#)\n    }\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "cf_investments",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(this_page, @1cf_investments).(this_table, @1cf_investments)\nInclude(@1pager_header)\n\nIf(Id!=\"\"){\n    SetVar(where, {startup_id:#Id#})\n}.Else{\n    SetVar(where,)\n}\nSetVar(isAdmin,0)\nSetVar(catalogAdmin, AppParam(App:#application_id#, Name:cf_catalog_admin, Ecosystem:1))\nIf(#role_id#>0){\n    If(#catalogAdmin#==#role_id#){\n        SetVar(isAdmin,1)\n    }\n}\n\nSetTitle($@1cf_investments$)\n\n\nDBFind(#this_table#, src).Where(#where#).Order({\"id\": -1}).Limit(#pager_limit#).Offset(#pager_offset#).Count(count).Custom(_created){\n    DateTime(#created_at#, Format: YYYY-MM-DD HH:MI:SS)\n}.Custom(_wallet){\n    SetVar(kid, AddressToId(#investment_wallet#))\n    LinkPage(Class: h5 text-primary, Page: @1profile_view, PageParams: \"v_key_id=#kid#\"){\n        Div(){\n            Span(Class: fa icon-user fa-2x mr).(#investment_wallet#)\n        }.Style(display:flex; align-items:center;)\n    }\n}.Custom(_amount){\n    Money(#amount#)\n}\n\nDiv(fullscreen){\n    Div(table-responsive ml-lg mr-lg){\n        Div(list-group-item){\n            If(#count# > 0){\n                Table(src, \"$@1cf_startup$=startup_id,$@1wallet$=_wallet,$@1amount$=_amount,$@1date_created$=_created\")\n            }.Else{\n                Div(text-center h4 text-muted){\n                    $@1cf_investments$ $@1not_founded$\n                }\n            }\n        }.Style(\n            tbody > tr:nth-of-type(odd) {\n                background-color: #f8f9fc;\n            }\n        )\n    }\n}\nDiv(mt-sm ml-lg mr-sm mb-sm){\n    Include(@1pager)\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "cf_settings",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(this_page, @1cf_settings)\nDBFind(@1applications).Columns(\"name,id\").Where({ecosystem:1, name:\"Crowdfunding\"}).Vars(application)\nSetVar(roles_param, cf_roles)\nAppParam(Ecosystem:#ecosystem_id#, App:#application_id#, Name: #roles_param#, Source:app_roles)\nSetTitle($@1cf_settings$)\nDiv(content-wrapper){\n    Div(row mt-sm){\n        Div(col-lg-8 col-lg-offset-2){\n            Include(@1role_settings)\n        }\n    }\n}",
            "Menu": "admin_menu",
            "Type": "pages"
        },
        {
            "Name": "cf_startup_filter",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(this_page, @1cf_startup_filter)\nIf(#back_page#==\"\"){\n    SetVar(back_page, @1cf_startups)\n}\n\nForm(){\n    Div(row mb-sm){\n        Div(col-md-3 mt-sm text-right){\n            Label(For:StartDate){\n                $@1date_start$\n            }\n        }\n        Div(col-md-9){\n            Input(Name: StartDate, Type:date, Value:#StartDate#)\n        }\n    }\n    Div(row mb-sm){\n        Div(col-md-3 mt-sm text-right){\n            Label(For:EndDate){\n                $@1date_end$\n            }\n        }\n        Div(col-md-9){\n            Input(Name: EndDate, Type:date, Value:#EndDate#)\n        }\n    }\n    Div(row mb-sm){\n        Div(col-md-3 mt-sm text-right){\n            Label(For:Minimal){\n                $@1cf_minimal_investment$\n            }\n        }\n        Div(col-md-9){\n            Input(Name: Minimal, Type:number, Value:#Minimal#)\n        }\n    }\n    Div(row mb-sm){\n        Div(col-md-3 mt-sm text-right){\n            Label(For:Estimated){\n                $@1cf_estimated_amount$\n            }\n        }\n        Div(col-md-9){\n            Input(Name: Estimated, Type:number, Value:#Estimated#)\n        }\n    }\n\n    Div(mt pull-right){\n        Button(Class: btn btn-default, Page: #back_page#, Body:$@1reset$)\n        Button(Class: btn btn-primary, Page: #back_page#, PageParams: \"StartDate=Val(StartDate),EndDate=Val(EndDate),Minimal=Val(Minimal),Estimated=Val(Estimated)\", Body: $@1filter$)\n    }\n}\n",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "cf_startup_form",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "SetVar(this_page, @1cf_startup_form).(back_page,@1cf_startups)\n\nIf(#EcosystemId#!=\"\"){\n    DBFind(@1ecosystems, ecosystems).Columns(\"id,name\").Where({id:#EcosystemId#}).Columns(\"id,name,info->description\").Vars(eco)\n\n}.Else{\n    SetVar(EcosystemId,).(eco_info_description,).(eco_name,)\n}\nSetTitle($@1cf_startup_form$)\nDiv(breadcrumb){\n    LinkPage(Body: $@1cf_startups$, Page: @1cf_startups)\n    Span(/, mh)\n    Span($@1cf_startup_form$, text-muted)\n}\nDiv(row){\n    Div(col-sm-12 col-lg-6 col-lg-offset-3){\n        Form(panel panel-default){\n            Div(panel-body){\n                Div(row mb){\n                    Div(col-sm-3 text-right){\n                        Label(For: Ecosystem){\n                            $@1ecosystem$\n                        }\n                        Span(*, text-danger)\n                    }\n                    Div(col-sm-9){\n                        Input(Name: Ecosystem, Type: hidden, Value: #EcosystemId#)\n                        If(GetVar(EcosystemId)!=\"\"){\n                            Input(Name: Name, Value: #eco_name#, Disabled: true)\n                        }.Else{\n                            Div(input-group){\n                                Input(Name: Name, Value: $@1ecosystem_select$, Disabled: true)\n                                Div(input-group-btn){\n                                    Button(Class: btn bg-gray-lighter fa fa-caret-down buttons, Page: @1select_ecosystem, PageParams:\"back_page=@1cf_startup_form,EcosystemId=#Ecosystem#,Type=ALL_LIST\").Popup(50, $@1ecosystem$)\n                                }\n                            }\n                        }\n                    }\n                }\n\n                Div(row mb){\n                    Div(col-sm-3 text-right){\n                        Label(For: Description){\n                            $@1description$\n                        }\n                    }\n                    Div(col-sm-9){\n                        Input(Name: Description, Type: textarea, Value:#eco_info_description#)\n                    }\n                }\n                Div(row mb){\n                    Div(col-sm-3 text-right){\n                        Label(For: Wallet){\n                            $@1cf_company_wallet$\n                        }\n                    }\n                    Div(col-sm-9){\n                        SetVar(wallet, Address(#key_id#))\n                        Input(Name: Wallet, Value: #wallet#)\n                    }\n                }\n                Div(row mb){\n                    Div(col-sm-3 text-right){\n                        Label(For: WalletEscrow){\n                            $@1cf_escrow_wallet$\n                        }\n                    }\n                    Div(col-sm-9){\n                        Div(input-group){\n                            Div(text-muted mt){\n                                If(GetVar(MemberId)!=\"\"){\n                                    SetVar(AddressMemberId, Address(#MemberId#))\n                                    Div(list-group-item){\n                                        #AddressMemberId#\n                                    }.Style(height: 35px; top: -5px;)\n                                }.Else{\n                                    Div(list-group-item){\n                                        xxxx-xxxx-xxxx-xxxx-xxxx\n                                    }.Style(height: 35px; top: -5px;)\n                                }\n                            }\n                            Div(input-group-btn){\n                                Button(Class: btn bg-gray-lighter fa fa-caret-down buttons, Page: @1select_wallet, PageParams:\"back_page=#this_page#,EcosystemId=#ecosystem_id#,Id=#Id#\").Popup(Header: $@1member$, Width: \"50\")\n                            }\n                        }\n                    }\n                }\n                Div(row mb){\n                    Div(col-sm-3 text-right){\n                        Label(For: WebAddress){\n                            $@1web_address$\n                        }\n                    }\n                    Div(col-sm-9){\n                        Input(Name: WebAddress)\n                    }\n                }\n                Div(row mb){\n                    Div(col-sm-3 text-right){\n                        Label(For: StartDate){\n                            $@1date_start$\n                        }\n                    }\n                    Div(col-sm-9){\n                        Div(row){\n                            Div(col-sm-6){\n                                Input(Name: StartDate, Type:date)\n                            }\n                            Div(col-sm-6){\n                                Input(Name: StartTime, Type:time, Value: \"00:00\")\n                            }\n                        }\n                    }\n                }\n                Div(row mb){\n                    Div(col-sm-3 text-right){\n                        Label(For: EndDate){\n                            $@1date_end$\n                        }\n                    }\n                    Div(col-sm-9){\n                        Div(row){\n                            Div(col-sm-6){\n                                Input(Name: EndDate, Type:date)\n                            }\n                            Div(col-sm-6){\n                                Input(Name: EndTime, Type:time, Value: \"00:00\")\n                            }\n                        }\n                    }\n                }\n\n                Div(row mb){\n                    Div(col-sm-3 text-right){\n                        Label(For: Estimated){\n                            $@1cf_estimated_amount$\n                        }\n                    }\n                    Div(col-sm-9){\n                        Input(Name: Estimated, Type:money)\n                    }\n                }\n                Div(row mb){\n                    Div(col-sm-3 text-right){\n                        Label(For: Minimal){\n                            $@1cf_minimal_investment$\n                        }\n                    }\n                    Div(col-sm-9){\n                        Input(Name: Minimal, Type:money)\n                    }\n                }\n            }\n            Div(panel-footer text-right){\n                Button(Body: $@1back$, Class: btn btn-default, Page: #back_page#)\n                Button(Body: $@1send$, Class: btn btn-primary, Page: #back_page#, Contract: @1CFStartup, Params: \"WalletEscrow=#AddressMemberId#\")\n            }\n        }\n    }\n}.Style(\n    .buttons {\n        border: 1px solid #dde6e9;\n        padding: 6px 16px;\n    }\n)",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "cf_startups",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "DBFind(@1applications).Columns(\"name,id\").Where({ecosystem:1, name:\"Crowdfunding\"}).Vars(application)\nSetVar(this_page, @1cf_startups).(this_table, @1cf_startups).(pager_limit,10)\nInclude(@1pager_header)\n\nIf(GetVar(StartDate)!=\"\"){\n    SetVar(where_started, \"{date_started:{$gte:#StartDate#}},\")\n}.Else{\n    SetVar(where_started,).(StartDate,)\n}\nIf(GetVar(EndDate)!=\"\"){\n    SetVar(where_finished, \"{date_finished:{$lte:#EndDate#}},\")\n}.Else{\n    SetVar(where_finished,).(EndDate,)\n}\nIf(GetVar(Minimal)!=\"\"){\n    SetVar(where_min, \"{minimal_investment:{$lte:#Minimal#}},\")\n}.Else{\n    SetVar(where_min,).(Minimal,)\n}\nIf(GetVar(Estimated)!=\"\"){\n    SetVar(where_est, \"{estimated_amount:{$lte:#Estimated#}},\")\n}.Else{\n    SetVar(where_est,).(Estimated,)\n}\n\nSetVar(isAdmin,0)\nSetVar(catalogAdmin, AppParam(App:#application_id#, Name:cf_catalog_admin, Ecosystem:1))\nIf(#role_id#>0){\n    If(#catalogAdmin#==#role_id#){\n        SetVar(isAdmin,1)\n    }\n}\nIf(#isAdmin#==1){\n    SetVar(where, {published_at:{$gte:0}, #where_started# #where_finished# #where_min# #where_est#}).(order,{published_at: 1})\n}.Else{\n    SetVar(where, {published_at:{$gt:0}, #where_started# #where_finished# #where_min# #where_est#}).(order,{id: -1})\n}\nSetTitle($@1cf_startups$)\nDiv(mr-lg text-right){\n    Button(Page: @1cf_startup_filter, Class: btn bg-gray-lighter mr-sm, PageParams: \"StartDate=#StartDate#,EndDate=#EndDate#,Minimal=#Minimal#,Estimated=#Estimated#\", Body: Em(Class: fa fa-filter) $@1filter$).Popup(Header: $@1filter$, Width: \"50\")\n}\n\n\nDBFind(#this_table#, src).Where(#where#).Order(#order#).Limit(#pager_limit#).Offset(#pager_offset#).Count(count).Custom(_name){\n    LinkPage(Page: @1cf_company, PageParams: \"Id=#id#\", Body: #name#)\n}.Custom(_started){\n    DateTime(#started_at#, Format: YYYY-MM-DD HH:MI:SS)\n}.Custom(_finished){\n    DateTime(#finished_at#, Format: YYYY-MM-DD HH:MI:SS)\n}.Custom(_minimal){\n    Money(#minimal_investment#)\n}.Custom(_estimated){\n    Money(#estimated_amount#)\n}.Custom(_current){\n    Money(#current_investment#)\n}.Custom(_actions){\n    SetVar(isOwner,0).(startupAdminRole_id,0).(startupAdmin_id,0)\n    DBFind(@1parameters).Where({name:\"role_admin\", ecosystem:#ecosystem#}).Columns(\"id,value\").Vars(ecoAdminRole)\n    If(#startupAdminRole_id#>0){\n        DBFind(@1roles_participants).Where({\"role->id\":#startupAdminRole_value#, \"member->member_id\": #key_id#, ecosystem:#ecosystem#}).Vars(startupAdmin)\n    }\n    If(#isAdmin#==1){\n        If(#published_at#==0){\n            Button(Body:$@1cf_accept$, Page:@1cf_startups_admin, Contract: CFAdmin, Params: \"Id=#id#,Action=accept\", Class:btn btn-success)\n            Button(Body:$@1cf_reject$, Page:@1cf_startups_admin, Contract: CFAdmin, Params: \"Id=#id#,Action=reject\", Class:btn btn-danger)\n        }\n        If(#published_at#>0){\n            Button(Body:$@1cf_stop$, Page:@1cf_startups_admin, Contract: CFAdmin, Params: \"Id=#id#,Action=stop\", Class:btn btn-default)\n        }\n        TODO:удаление кампании возможно админом площадки до начала кампании\n    }.Else{\n        If(#startupAdmin_id#>0){\n            TODO:удаление кампании возможно админом э/с до начала кампании\n        }.Else{\n            Button(Body:$@1cf_invest$, Page:@1cf_investment_form, PageParams: \"Id=#id#\", Class:btn btn-default).Popup(50, $@1cf_invest$)\n        }\n    }\n\n}\nDiv(fullscreen){\n    AddToolButton(Title:$@1cf_add_company$, Page: @1cf_startup_form, Icon: icon-plus)\n    Div(table-responsive ml-lg mr-lg){\n        Div(list-group-item){\n            If(#count# > 0){\n                Table(src, \"$@1name$=_name,$@1date_start$=_started,$@1date_end$=_finished,$@1minimum_amount$=_minimal,$@1estimated_amount$=_estimated,$@1current_amount$=_current\")\n            }.Else{\n                Div(text-center h4 text-muted){\n                    $@1cf_startups$ $@1not_founded$\n                }\n            }\n        }\n    }\n}.Style(\n    tbody > tr:nth-of-type(odd) {\n        background-color: #f8f9fc;\n    }\n)\nDiv(mt-sm ml-lg mr-sm mb-sm){\n    Include(@1pager)\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "AppRolesSettings",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract AppRolesSettings{\n    data {\n        RolesParam string\n        AppIds array\n        Ids array\n        AppId int\n    }\n\n    conditions{\n        ContractConditions(\"AdminCondition\")\n    }\n    func trimPrefix(s string) string{\n        var d array  i int canBreak bool\n        d = [\"@\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"0\"]\n        \n        while true{\n            canBreak = true\n            while i < 11{\n                if HasPrefix(s, d[i]){\n                    s = Substr(s, 1, Size(s))\n                    canBreak = false\n                }\n                i = i + 1\n            }\n            if canBreak {\n                break\n            }\n        }\n        return s\n    }\n\n    action {\n        var i i_param lenIds paramId int rolesParam array\n        lenIds = Len($Ids)\n        rolesParam = Split(AppParam($AppId, $RolesParam, $ecosystem_id), \",\")\n        while i < lenIds{\n            var name string roleId int\n            i_param = Int($AppIds[i])\n            name = trimPrefix(rolesParam[i_param - 1])\n            roleId = $Ids[i]\n            if roleId > 0{\n                paramId = Int(DBFind(\"@1app_params\").Where({app_id:$AppId, ecosystem:$ecosystem_id, name:{$end:name}}).One(\"id\"))\n                @1EditAppParam(\"Id,Value\", paramId, roleId)\n            }\n            i = i + 1\n        }\n    }\n}",
            "Type": "contracts"
        },
        {
            "Name": "CFAdmin",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract CFAdmin {\n    data {\n        Id int\n        Action string\n    }\n    conditions{\n        $startup = DBFind(\"@1startups\").WhereId($Id).Row()\n        if !$startup{\n            warning \"Startup not found\"\n        }\n\n        // проверка прав на администрирование (role_id == cf_catalog_admin) или\n        // если Action==finish проверить что я админ стартапа или владелец кошелька для инвестиций\n        var appId int\n        appId = Int(DBFind(\"@1applications\").Where({ecosystem:1, name:\"Crowdfunding\"}).One(\"id\"))\n        if $Action == \"finish\"{\n            var adminRoleId int admin map\n            adminRoleId = Int(DBFind(\"@1parameters\").Where({name:\"role_admin\", ecosystem:$Ecosystem}).One(\"value\"))\n            if adminRoleId == 0{\n                warning \"Admin role not defined in target ecosystem\"\n            }\n            admin = DBFind(\"@1roles_participants\").Where({\"role->id\":adminRoleId, \"member->member_id\": $key_id, ecosystem:$Ecosystem}).Row()\n            if !admin{\n                if $startup[\"wallet\"] != IdToAddress($key_id){\n                    warning \"You must be Admin in target ecosystem or owner of wallet investments\"\n                }\n            }\n        }else{\n            var adminRoleId int\n            adminRoleId = AppParam(appId, \"cf_catalog_admin\", 1)\n            if !RoleAccess(adminRoleId){\n                warning \"This action allowed only for startup catalog admin role\"\n            }\n        }\n        $CREATED = 1\n        $PUBLISHED = 2\n        $STARTED = 3\n        $FINISHED = 4\n        $FAILED = 5\n        $STOPPED = 6\n        $REJECTED = 7\n    }\n\n    action {\n        if $Action == \"stop\"{\n            $startup[\"stopped_at\"] = $block_time\n            $startup[\"status\"] = $STOPPED\n\n        }elif $Action == \"accept\"{\n            $startup[\"published_at\"] = $block_time\n            $startup[\"status\"] = $PUBLISHED\n\n        }elif $Action == \"reject\"{\n            $startup[\"published_at\"] = -1\n            $startup[\"status\"] = $REJECTED\n\n        }elif $Action == \"delete\"{\n            $startup[\"deleted_at\"] = $block_time\n            $startup[\"status\"] = $STOPPED\n\n        }elif $Action == \"finish\"{\n            // TODO: если не набрана сумма - возврат токинов (алгоритм надо будет уточнить)\n            // TODO: если набрана - переводится комиссия площадки\n            $startup[\"finished_at\"] = $block_time\n            $startup[\"status\"] = $FINISHED\n        }\n        DBUpdate(\"@1startups\", $Id, $startup)\n    }\n}",
            "Type": "contracts"
        },
        {
            "Name": "CFInvestment",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract CFInvestment {\n    data {\n        Id int\n        Amount money\n    }\n\n    conditions{\n        $startup = DBFind(\"@1cf_startups\").WhereId($Id).Row()\n        if !$startup{\n            warning \"Startup not found\"\n        }\n        if $Amount < $startup[\"minimal_investment\"]{\n            warning \"Too small amount\"\n        }\n        $recipient = AddressToId($startup[\"wallet\"])\n        if $recipient == 0{\n            warning \"Startup wallet not found\"\n        }\n    }\n\n    action {\n        var m map\n        m[\"startup_id\"] = $Id\n        m[\"investment_wallet\"] = $key_id\n        m[\"amount\"] = $Amount\n        m[\"created_at\"] = $block_time\n        DBInsert(\"@1cf_investments\", m)\n\n        var comment string ecosystem int\n        comment = \"startup investment\"\n        ecosystem = Int($startup[\"ecosystem\"])\n        @1TokensTransfer(\"Amount,SenderId,RecipientId,Comment,Ecosystem\", $Amount, $key_id, $recipient, comment, ecosystem)\n    }\n}",
            "Type": "contracts"
        },
        {
            "Name": "CFInvestmentAdmin",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract CFInvestmentAdmin {\n    data {\n        Action string\n        NotificId int\n    }\n\n    conditions{\n        var appId int\n        appId = Int(DBFind(\"@1applications\").Where({ecosystem:1, name:\"Crowdfunding\"}).One(\"id\"))\n        if appId == 0{\n            warning \"Application not found\"\n        }\n        // получить стартап из оповещения\n        $note = DBFind(\"@1notifications\").Where({ecosystem:$ecosystem_id, id:$NotificId}).Columns(\"id,page_params->startup_id,page_params->investor,page_params->amount\").Row()\n        if !$note{\n            warning \"Notification not found\"\n        }\n        var startupId int\n        startupId = Int($note[\"page_params.startup_id\"])\n        $startup = DBFind(\"@1cf_startups\").WhereId(startupId).Row()\n        if !$startup{\n            warning \"Startup not found\"\n        }\n        // проверить права доступа - админ экосистемы стартапа\n        var ecoAdmin eco int\n        eco = Int($startup[\"ecosystem\"])\n        ecoAdmin = Int(EcosysParam(\"role_admin\"))\n        if !RoleAccess(ecoAdmin){\n            warning \"This action allowed only for ecosystem admin role\"\n        }\n\n    }\n\n    action {\n        @1NotificationsClose(\"notific_id\", $NotificId)\n\n        var params m map\n        params[\"startup_id\"] = $startup[\"id\"]\n        params[\"investor\"] = $note[\"page_params.investor\"]\n        m[\"params_map\"] = JSONEncode(params)\n        m[\"member_id\"] = Int($note[\"page_params.investor\"])\n        m[\"closure_type\"] = 1\n        m[\"sender\"] = 1\n        m[\"eco_id\"] = 1\n        m[\"popup\"] = \"true\"\n        m[\"text_body\"] = Sprintf(\"Startup #%v, amount: %v\", $startup[\"id\"], $startup[\"amount\"])\n\n        if $Action == \"accept\"{\n            // TODO: создать кошелек в целевой экосистиеме (если нет)\n\n            m[\"page_name\"] = \"@1cf_invest_notification\"\n            m[\"text_header\"] = \"Accept investment offer\"\n\n        }elif $Action == \"reject\"{\n            m[\"page_name\"] = \"@1notifications_show\"\n            m[\"text_header\"] = \"Reject investment offer\"\n        }\n        CallContract(\"@1NotificationsSend\", m)\n    }\n}",
            "Type": "contracts"
        },
        {
            "Name": "CFInvestmentOffer",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Value": "contract CFInvestmentOffer {\n    data {\n        Id int\n        Amount money\n    }\n\n    conditions{\n        $startup = DBFind(\"@1startups\").WhereId($Id).Row()\n        if !$startup{\n            warning \"Startup not found\"\n        }\n        if $Amount < $startup[\"minimal_investment\"]{\n            warning \"Too small amount\"\n        }\n        var eco int\n        eco = Int($startup[\"ecosystem\"])\n        $rid = Int(DBFind(\"@1parameters\").Where({name:\"role_admin\", ecosystem:eco}).Columns(\"value\").One(\"value\"))\n        if $rid == 0{\n            warning \"Admin role in Ecosystem of startup not assigned\"\n        }\n    }\n\n    action {\n        // оповещение админу целевой экосистемы\n        var closure sender int header body page params eco popup string m map\n        closure = 1\n        sender = 1\n        header = \"Investment offer\"\n        body = Sprintf(\"Startup #%v, amount: %v\", $Id, $Amount)\n        page = \"@1cf_admin_notification\"\n        m[\"startup_id\"] = $Id\n        m[\"amount\"] = $Amount\n        m[\"investor\"] = $key_id\n        params = JSONEncode(m)\n        eco = $startup[\"ecosystem\"]\n        popup = \"true\"\n\n        @1NotificationsSend(\"rid,closure_type,sender,text_header,text_body,page_name,params_map,eco_id,popup\", $rid, closure, sender, header, body, page, params, eco, popup)\n    }\n}",
            "Type": "contracts"
        },
        {
            "Name": "CFStartup",
            "Conditions": "ContractConditions(\"@1DeveloperCondition\")",
            "Value": "contract CFStartup {\n    data {\n        Id int \"optional\"\n        Ecosystem int\n        Name string\n        Description string\n        Wallet string\n        WalletEscrow string\n        WebAddress string\n        StartDate string\n        StartTime string\n        EndDate string\n        EndTime string\n        Estimated money\n        Minimal money\n    }\n    func dateAddTime(d, t string) string {\n        var dt string\n        if Contains(d, \"T00:00:00Z\") {\n            d = Replace(d, \"T00:00:00Z\", \"\")\n        }\n        if Size(t) == 5 {\n            dt = Sprintf(\"%v %v:00\", d, t)\n        }\n        return dt\n    }\n    conditions{\n        $CREATED = 1\n        $PUBLISHED = 2\n        $STARTED = 3\n        $FINISHED = 4\n        $FAILED = 5\n        $STOPPED = 6\n        $REJECTED = 7\n\n        if $Id > 0 {\n            $startup = DBFind(\"@1cf_startups\").WhereId($Id).Row()\n            if !$startup{\n                warning \"Startup not found\"\n            }\n            if Int($startup[\"status\"]) == $PUBLISHED{\n                warning \"Editing a published company is not available\"\n            }\n        }\n\n        // $key_id - админ $Ecosystem\n        var adminRoleId int admin map\n        adminRoleId = Int(DBFind(\"@1parameters\").Where({name:\"role_admin\", ecosystem:$Ecosystem}).One(\"value\"))\n        if adminRoleId == 0{\n            warning \"Admin role not defined in target ecosystem\"\n        }\n        admin = DBFind(\"@1roles_participants\").Where({\"role->id\":adminRoleId, \"member->member_id\": $key_id, ecosystem:$Ecosystem}).Row()\n        if !admin{\n            warning \"You must be Admin in target ecosystem\"\n        }\n        \n        $Wallet = AddressToId($Wallet)\n        if DBFind(\"@1keys\").Where({ecosystem:$Ecosystem, id:$Wallet, multi:0}).Row(){\n            // $Wallet - кошелек с мультиподписями\n            warning \"Wallet for investment in target ecosystem  must be multisigned\"\n        }\n        $Wallet = IdToAddress($Wallet)\n        $WalletEscrow = IdToAddress(AddressToId($WalletEscrow))\n\n        var eco token map\n        eco = DBFind(\"@1ecosystems\").WhereId($Ecosystem).Row()\n        // токен $Ecosystem - без дополнительной эмиссии и без сжигания\n        if eco[\"type_withdraw\"] != 1 {\n            warning \"Ecosystem token must be with out withdraw\"\n        }\n        if eco[\"type_emission\"] != 1 {\n            warning \"Ecosystem additional emission must be blocked\"\n        }\n\n        token[\"token_title\"] = eco[\"token_title\"]\n        token[\"emission_amount\"] = eco[\"emission_amount\"]\n        // TODO: наличие токена на бирже\n        $token = token\n\n        $dateStartString = dateAddTime($StartDate, $StartTime)\n        $dateStart = UnixDateTime($dateStartString)\n        if $dateStart == 0 {\n            warning \"Invalid starting date\"\n        }\n        $dateEndString = dateAddTime($EndDate, $EndTime)\n        $dateEnd = UnixDateTime($dateEndString)\n        if $dateEnd == 0 {\n            warning \"Invalid ending date\"\n        }\n    }\n\n    action {\n        var escrowName string\n        escrowName = DBFind(\"@1members\").Where({ecosystem:$Ecosystem}).Columns(\"member_name\").One(\"member_name\")\n        if !escrowName{\n            escrowName = $WalletEscrow\n        }\n        var m map\n        m[\"ecosystem\"] = $Ecosystem\n        m[\"name\"] = $Name\n        m[\"description\"] = $Description\n        m[\"wallet\"] = $Wallet\n        m[\"escrow_wallet\"] = $WalletEscrow\n        m[\"escrow_name\"] = escrowName\n        m[\"web_address\"] = $WebAddress\n        m[\"registered_at\"] = $block_time\n        m[\"started_at\"] = $dateStart\n        m[\"finished_at\"] = $dateEnd\n        m[\"estimated_amount\"] = $Estimated\n        m[\"minimal_investment\"] = $Minimal\n        m[\"token_info\"] = $token\n        m[\"date_started\"] = $dateStartString\n        m[\"date_finished\"] = $dateEndString\n\n        if $Id > 0{\n            DBUpdate(\"@1cf_startups\", $Id, m)\n        }else{\n            m[\"status\"] = $CREATED\n            DBInsert(\"@1cf_startups\", m)\n        }\n    }\n}",
            "Type": "contracts"
        }
    ]
}