{
    "name": "Land registry",
    "conditions": "ContractConditions(\"AdminCondition\")",
    "data": [
        {
            "Name": "lr_check_rights",
            "Conditions": "ContractConditions(\"AdminCondition\")",
            "Value": "DBFind(\"@1applications\").Where({ecosystem: #ecosystem_id#, name: \"Land registry\"}).Vars(\"app\")\r\nSetVar(admin, 0).(bank, 0).(depart2, 0).(depart3, 0)\r\n\r\nIf(#role_id# == AppParam(App: #app_id#, Name: lr_admin_role)){\r\n    SetVar(admin, 1)\r\n}\r\nIf(#role_id# == AppParam(App: #app_id#, Name: lr_bank_role)){\r\n    SetVar(bank, 1)\r\n}\r\nIf(#role_id# == AppParam(App: #app_id#, Name: lr_depart2_role)){\r\n    SetVar(depart2, 1)\r\n}\r\nIf(#role_id# == AppParam(App: #app_id#, Name: lr_depart3_role)){\r\n    SetVar(depart3, 1)\r\n}",
            "Type": "blocks"
        },
        {
            "Name": "admin_menu",
            "Conditions": "ContractConditions(\"AdminCondition\")",
            "Value": "MenuItem(Title: \"$lr_settings$\", Page: lr_settings, Icon: \"icon-wrench\")",
            "Type": "menu"
        },
        {
            "Name": "default_menu",
            "Conditions": "ContractConditions(\"AdminCondition\")",
            "Value": "MenuItem(Title: \"$lr_land_registry$\", Page: lr_list, Icon: \"icon-home\")",
            "Type": "menu"
        },
        {
            "Name": "lr_additional_request",
            "Trans": "{\"en\":\"Additional request\",\"ru\":\"Дополнительный запрос\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_admin_role_name",
            "Trans": "{\"en\":\"Administrator\",\"ru\":\"Администратор\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_all_objects",
            "Trans": "{\"en\":\"All objects\",\"ru\":\"Все объекты\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_all_roles_needed",
            "Trans": "{\"en\":\"All application roles must be set before using this application\",\"ru\":\"Необходимо установить все роли этого приложения перед его использованием\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_area_size",
            "Trans": "{\"en\":\"Area size\",\"ru\":\"Размер территории\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_attention_required",
            "Trans": "{\"en\":\"Attention required\",\"ru\":\"Требует внимания\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_available_for_purchase",
            "Trans": "{\"en\":\"Available for the purchase\",\"ru\":\"Доступно для приобретения\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_awaiting_bank_transfer",
            "Trans": "{\"en\":\"Waiting for the bank transfer\",\"ru\":\"Ожидание перевода от банка\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_awaiting_buyer_deposit",
            "Trans": "{\"en\":\"Waiting for the buyer deposit\",\"ru\":\"Ожидание внесения средств от покупателя\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_awaiting_depart_checks",
            "Trans": "{\"en\":\"Waiting for the departments checks\",\"ru\":\"Ожидание окончания проверок департаментов\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_awaiting_owner_accept",
            "Trans": "{\"en\":\"Waiting for the owner acceptance\",\"ru\":\"Ожидание одобрения от владельца\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_bank_account_not_found",
            "Trans": "{\"en\":\"Land bank account was not found\",\"ru\":\"Счёт земельного банка не найден\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_bank_role_name",
            "Trans": "{\"ru\":\"Земельный банк\",\"en\":\"Land Bank\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_buildings_class",
            "Trans": "{\"en\":\"Buildings use class\",\"ru\":\"Класс используемых зданий\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_buyer",
            "Trans": "{\"en\":\"Buyer\",\"ru\":\"Покупатель\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_buyer_cancelled_purchase",
            "Trans": "{\"en\":\"The buyer cancelled the purchase\",\"ru\":\"Покупатель отказался от приобретения\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_buyer_made_deposit",
            "Trans": "{\"en\":\"The buyer made a deposit\",\"ru\":\"Покупатель внёс депозит\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_checks_successfull",
            "Trans": "{\"en\":\"All department checks completed successfully\",\"ru\":\"Все проверки департаментов успешно завершены\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_deal_cancelled_by_bank",
            "Trans": "{\"en\":\"The deal was cancelled by the Land bank\",\"ru\":\"Сделка отменена земельным банком\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_deal_status",
            "Trans": "{\"en\":\"Deal status\",\"ru\":\"Статус сделки\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_deal_successful",
            "Trans": "{\"en\":\"Deal completed successfully\",\"ru\":\"Сделка успешно завершена\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_decision_made",
            "Trans": "{\"en\":\"Decision was made\",\"ru\":\"Решение было принято\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_depart2_role_name",
            "Trans": "{\"en\":\"Department of Legal Affairs\",\"ru\":\"Департамент по правовым вопросам\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_depart3_role_name",
            "Trans": "{\"en\":\"Department of Revenue\",\"ru\":\"Департамент налогов и сборов\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_deposit_money",
            "Trans": "{\"en\":\"Deposit money\",\"ru\":\"Внести деньги на депозит\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_encumbrance_certificate",
            "Trans": "{\"en\":\"Encumbrance certificate\",\"ru\":\"Сертификат обременения\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_finalize_deal",
            "Trans": "{\"en\":\"Finalize deal\",\"ru\":\"Завершить сделку\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_government_price",
            "Trans": "{\"en\":\"Government value\",\"ru\":\"Государственная стоимость\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_land_authority",
            "Trans": "{\"en\":\"Land authority\",\"ru\":\"Местный орган\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_land_registry",
            "Trans": "{\"en\":\"Land Registry\",\"ru\":\"Земельный реестр\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_land_use",
            "Trans": "{\"en\":\"Land use\",\"ru\":\"Землепользование\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_legal_status",
            "Trans": "{\"en\":\"Legal status\",\"ru\":\"Правовой статус\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_list_desc",
            "Trans": "{\"en\":\"Complete list of all Land registry objects\",\"ru\":\"Полный список всех объектов земельного реестра\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_location",
            "Trans": "{\"en\":\"Location\",\"ru\":\"Местоположение\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_market_price",
            "Trans": "{\"en\":\"Market value\",\"ru\":\"Рыночная стоимость\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_modification_date",
            "Trans": "{\"en\":\"Modification date\",\"ru\":\"Дата изменения\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_need_processing",
            "Trans": "{\"en\":\"Need your processing\",\"ru\":\"Нужна ваша обработка\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_new_object",
            "Trans": "{\"en\":\"New object\",\"ru\":\"Новый объект\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_new_offer",
            "Trans": "{\"en\":\"New purchase offer\",\"ru\":\"Новое предложение о покупке\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_no_address_found",
            "Trans": "{\"en\":\"No address found\",\"ru\":\"Адрес не найден\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_no_issues",
            "Trans": "{\"en\":\"No issues\",\"ru\":\"Проблем нет\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_no_objects_found",
            "Trans": "{\"en\":\"Objects not found\",\"ru\":\"Объекты не найдены\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_no_rights_to_change",
            "Trans": "{\"en\":\"You have no rights to change this property\",\"ru\":\"У вас нет прав на редактирование этого свойства\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_object_create",
            "Trans": "{\"en\":\"Create object\",\"ru\":\"Создать объект\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_object_edit",
            "Trans": "{\"en\":\"Object edit\",\"ru\":\"Редактирование объекта\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_object_status",
            "Trans": "{\"en\":\"Object status\",\"ru\":\"Статус объекта\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_object_view",
            "Trans": "{\"en\":\"Object view\",\"ru\":\"Просмотр объекта\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_owner",
            "Trans": "{\"en\":\"Owner\",\"ru\":\"Владелец\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_owner_cancelled_purchase",
            "Trans": "{\"en\":\"The owner cancelled the selling\",\"ru\":\"Владелец отказался от продажи\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_owner_rejected_purchase",
            "Trans": "{\"en\":\"The owner rejected the purchase\",\"ru\":\"Владелец отклонил покупку\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_price",
            "Trans": "{\"en\":\"Price\",\"ru\":\"Цена\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_purchase",
            "Trans": "{\"en\":\"Purchase object\",\"ru\":\"Приобрести объект\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_purchase_accepted",
            "Trans": "{\"en\":\"Your purchase request was accepted\",\"ru\":\"Ваша заявка на покупку принята\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_purchase_rejected",
            "Trans": "{\"en\":\"Your purchase request was rejected\",\"ru\":\"Ваша заявка на покупку отклонена\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_registration_date",
            "Trans": "{\"en\":\"Registration date\",\"ru\":\"Дата регистрации\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_requests_limit_reached",
            "Trans": "{\"en\":\"Only one additional request to the department allowed\",\"ru\":\"Разрешён только один дополнительный запрос в департамент\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_sales",
            "Trans": "{\"en\":\"Land Registry sales\",\"ru\":\"Продажа объектов Земельного реестра\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_sales_desc",
            "Trans": "{\"en\":\"List of Land registry objects available for purchase\",\"ru\":\"Cписок объектов земельного реестра доступных для приобретения\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_save_results",
            "Trans": "{\"en\": \"Save results\", \"ru\": \"Сохранить результаты\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_settings",
            "Trans": "{\"en\":\"Land registry settings\",\"ru\":\"Настройки земельного реестра\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_settings_description",
            "Trans": "{\"en\": \"Correspondence between Land registry application roles and the ecosystem roles\", \"ru\": \"Соответствие ролей приложения Земельный реестр ролям экосистемы\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_taxes_and_bills",
            "Trans": "{\"en\":\"Taxes and bills\",\"ru\":\"Налоги и счета\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_tokens_needed",
            "Trans": "{\"en\": \"You must emit tokens for this ecosystem or install Land registry to the platform ecosystem before using it\", \"ru\": \"Вы должны выпустить токены для этой экосистемы или установить Земельный реестр в платформенной экосистеме для его использования\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_undefined",
            "Trans": "{\"en\":\"Undefined\",\"ru\":\"Не определено\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_want_accept_purchase",
            "Trans": "{\"en\":\"Do you want to accept the purchase offer?\",\"ru\":\"Вы хотите принять предложение о покупке?\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_want_cancel_deal",
            "Trans": "{\"en\":\"Do you really want to cancel the deal?\",\"ru\":\"Вы действительно хотите отменить сделку?\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_want_delete_object",
            "Trans": "{\"en\":\"Do you really want to delete this object?\",\"ru\":\"Вы действительно хотите удалить этот объект?\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_want_finalize_deal",
            "Trans": "{\"en\":\"Do you really want to finalize the deal?\",\"ru\":\"Вы действительно хотите завершить сделку?\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_want_initiate_purchase",
            "Trans": "{\"en\":\"Do you want to initiate the purchase?\",\"ru\":\"Вы хотите начать процесс покупки?\"}",
            "Type": "languages"
        },
        {
            "Name": "lr_want_reject_purchase",
            "Trans": "{\"en\":\"Do you want to reject the purchase offer?\",\"ru\":\"Вы хотите отклонить предложение о покупке?\"}",
            "Type": "languages"
        },
        {
            "Name": "land_registry",
            "Columns": "[\r\n    {\r\n        \"name\": \"buyer_id\",\r\n        \"conditions\": \"{\\\"update\\\":\\\"ContractAccess(\\\\\\\"LrPurchaseSteps\\\\\\\")\\\",\\\"read\\\":\\\"true\\\"}\",\r\n        \"type\": \"number\"\r\n    },\r\n    {\r\n        \"name\": \"date_created\",\r\n        \"conditions\": \"{\\\"update\\\":\\\"false\\\",\\\"read\\\":\\\"true\\\"}\",\r\n        \"type\": \"number\"\r\n    },\r\n    {\r\n        \"name\": \"deleted\",\r\n        \"conditions\": \"{\\\"update\\\":\\\"ContractAccess(\\\\\\\"LrEdit\\\\\\\")\\\",\\\"read\\\":\\\"true\\\"}\",\r\n        \"type\": \"number\"\r\n    },\r\n    {\r\n        \"name\": \"government_price\",\r\n        \"conditions\": \"{\\\"update\\\":\\\"ContractAccess(\\\\\\\"LrDepartChecks\\\\\\\")\\\",\\\"read\\\":\\\"true\\\"}\",\r\n        \"type\": \"money\"\r\n    },\r\n    {\r\n        \"name\": \"market_price\",\r\n        \"conditions\": \"{\\\"update\\\":\\\"ContractAccess(\\\\\\\"LrDepartChecks\\\\\\\")\\\",\\\"read\\\":\\\"true\\\"}\",\r\n        \"type\": \"money\"\r\n    },\r\n    {\r\n        \"name\": \"modification_date\",\r\n        \"conditions\": \"{\\\"update\\\":\\\"ContractAccess(\\\\\\\"LrDepartChecks\\\\\\\")\\\",\\\"read\\\":\\\"true\\\"}\",\r\n        \"type\": \"number\"\r\n    },\r\n    {\r\n        \"name\": \"owner_id\",\r\n        \"conditions\": \"{\\\"update\\\":\\\"ContractAccess(\\\\\\\"LrPurchaseSteps\\\\\\\")\\\",\\\"read\\\":\\\"true\\\"}\",\r\n        \"type\": \"number\"\r\n    },\r\n    {\r\n        \"name\": \"price\",\r\n        \"conditions\": \"{\\\"update\\\":\\\"ContractAccess(\\\\\\\"LrEdit\\\\\\\")\\\",\\\"read\\\":\\\"true\\\"}\",\r\n        \"type\": \"money\"\r\n    },\r\n    {\r\n        \"name\": \"registration_date\",\r\n        \"conditions\": \"{\\\"update\\\":\\\"ContractAccess(\\\\\\\"LrEdit\\\\\\\")\\\",\\\"read\\\":\\\"true\\\"}\",\r\n        \"type\": \"number\"\r\n    },\r\n    {\r\n        \"name\": \"specifications\",\r\n        \"conditions\": \"{\\\"update\\\":\\\"ContractAccess(\\\\\\\"LrEdit\\\\\\\")\\\",\\\"read\\\":\\\"true\\\"}\",\r\n        \"type\": \"json\"\r\n    },\r\n    {\r\n        \"name\": \"status\",\r\n        \"conditions\": \"{\\\"update\\\":\\\"ContractAccess(\\\\\\\"LrDepartChecks\\\\\\\",\\\\\\\"LrPurchaseSteps\\\\\\\")\\\",\\\"read\\\":\\\"true\\\"}\",\r\n        \"type\": \"json\"\r\n    },\r\n    {\r\n        \"name\": \"step\",\r\n        \"conditions\": \"{\\\"update\\\":\\\"ContractAccess(\\\\\\\"LrPurchaseSteps\\\\\\\")\\\",\\\"read\\\":\\\"true\\\"}\",\r\n        \"type\": \"number\"\r\n    }\r\n]",
            "Permissions": "{\"read\": \"true\", \"insert\": \"ContractAccess(\\\"LrAdd\\\")\", \"update\": \"ContractAccess(\\\"LrDepartChecks\\\",\\\"LrEdit\\\",\\\"LrPurchaseSteps\\\")\", \"new_column\": \"ContractConditions(\\\"@1AdminCondition\\\")\"}",
            "Type": "tables"
        },
        {
            "Name": "land_registry_history",
            "Columns": "[\r\n    {\r\n        \"name\": \"attribute_name\",\r\n        \"conditions\": \"{\\\"update\\\":\\\"false\\\",\\\"read\\\":\\\"true\\\"}\",\r\n        \"type\": \"varchar\"\r\n    },\r\n    {\r\n        \"name\": \"date\",\r\n        \"conditions\": \"{\\\"update\\\":\\\"false\\\",\\\"read\\\":\\\"true\\\"}\",\r\n        \"type\": \"number\"\r\n    },\r\n    {\r\n        \"name\": \"member_id\",\r\n        \"conditions\": \"{\\\"update\\\":\\\"false\\\",\\\"read\\\":\\\"true\\\"}\",\r\n        \"type\": \"number\"\r\n    },\r\n    {\r\n        \"name\": \"new_value\",\r\n        \"conditions\": \"{\\\"update\\\":\\\"false\\\",\\\"read\\\":\\\"true\\\"}\",\r\n        \"type\": \"text\"\r\n    },\r\n    {\r\n        \"name\": \"object_id\",\r\n        \"conditions\": \"{\\\"update\\\":\\\"false\\\",\\\"read\\\":\\\"true\\\"}\",\r\n        \"type\": \"number\"\r\n    },\r\n    {\r\n        \"name\": \"old_value\",\r\n        \"conditions\": \"{\\\"update\\\":\\\"false\\\",\\\"read\\\":\\\"true\\\"}\",\r\n        \"type\": \"text\"\r\n    }\r\n]",
            "Permissions": "{\"read\": \"true\", \"insert\": \"ContractAccess(\\\"LrEdit\\\")\", \"update\": \"false\", \"new_column\": \"ContractConditions(\\\"@1AdminCondition\\\")\"}",
            "Type": "tables"
        },
        {
            "Name": "lr_admin_role",
            "Conditions": "ContractConditions(\"AdminCondition\")",
            "Value": "0",
            "Type": "app_params"
        },
        {
            "Name": "lr_bank_role",
            "Conditions": "ContractConditions(\"AdminCondition\")",
            "Value": "0",
            "Type": "app_params"
        },
        {
            "Name": "lr_buildings_class",
            "Conditions": "ContractConditions(\"AdminCondition\")",
            "Value": "Shops,Financial and professional services,Restaurants and cafes,Drinking establishments,Hot food takeaways,Drinking establishments with expanded food provision,Business,General industrial,Storage or distribution,Hotels,Residential institutions,Secure Residential Institution,Dwellinghouses,Houses in multiple occupation,Non-residential institutions,Assembly and leisure",
            "Type": "app_params"
        },
        {
            "Name": "lr_depart2_role",
            "Conditions": "ContractConditions(\"AdminCondition\")",
            "Value": "0",
            "Type": "app_params"
        },
        {
            "Name": "lr_depart3_role",
            "Conditions": "ContractConditions(\"AdminCondition\")",
            "Value": "0",
            "Type": "app_params"
        },
        {
            "Name": "lr_issues",
            "Conditions": "ContractConditions(\"AdminCondition\")",
            "Value": "lr_no_issues,lr_attention_required",
            "Type": "app_params"
        },
        {
            "Name": "lr_land_authority",
            "Conditions": "ContractConditions(\"AdminCondition\")",
            "Value": "Municipal,Regional,Federal",
            "Type": "app_params"
        },
        {
            "Name": "lr_land_type",
            "Conditions": "ContractConditions(\"AdminCondition\")",
            "Value": "Inheritance,Partition,Gift,Settlement,Grant,Release",
            "Type": "app_params"
        },
        {
            "Name": "lr_land_use",
            "Conditions": "ContractConditions(\"AdminCondition\")",
            "Value": "Agriculture,Business,Community services,Construction,Energy production,Fishing,Forestry,Heavy environmental impact,Industry and manufacturing,Mining and quarrying,Recreation / leisure / sport,Residential,Services and residential,Total Land Use,Transport / communication networks / storage,Protective works,Unused and abandoned area",
            "Type": "app_params"
        },
        {
            "Name": "lr_legal_status",
            "Conditions": "ContractConditions(\"AdminCondition\")",
            "Value": "No Issues,Title Not Clear,Multiple Owner Claims",
            "Type": "app_params"
        },
        {
            "Name": "lr_add",
            "Conditions": "ContractConditions(\"AdminCondition\")",
            "Value": "DBFind(\"@1applications\").Where({ecosystem: #ecosystem_id#, name: \"Land registry\"}).Columns(\"name,id\").Vars(app)\r\nSetVar(row,\"row mt-sm\").(col_left,\"col-sm-3 text-right mt-sm\").(col_right,\"col-sm-9 text-left\")\r\nSetVar(custom_token_title, \"APLA\")\r\nIf(#ecosystem_id#>1){\r\n    DBFind(\"@1ecosystems\").Where({\"id\": #ecosystem_id#}).Vars(\"custom\")\r\n}\r\n\r\nDiv(content-wrapper){\r\n    Div(row){\r\n        Div(col-lg-6 col-lg-offset-3 col-md-8 col-md-offset-2 col-sm-10 col-sm-offset-1){\r\n            Form(panel panel-primary){\r\n                Div(panel-body){\r\n                    Div(text-center text-bold h4 m0){\r\n                        LangRes(lr_new_object)\r\n                    }\r\n                    Div(row mt-lg){\r\n                        Div(#col_left#){\r\n                            Label(){\r\n                                LangRes(lr_location)\r\n                            }\r\n                        }\r\n                        Div(#col_right#){\r\n                            InputMap(Name: Coords, Type: polygon, MapType: streets, Value: `{\"zoom\":18, \"center\":{\"lng\":40.777045,\"lat\":-73.963719}}`)\r\n                        }\r\n                    }\r\n                    Div(#row#){\r\n                        Div(#col_left#){\r\n                            Label(){\r\n                                LangRes(@1type)\r\n                            }\r\n                        }\r\n                        Div(#col_right#){\r\n                            AppParam(App: #app_id#, Name: lr_land_type, Source: lr_land_type)\r\n                            Select(Name: LandType, Source: lr_land_type, ValueColumn: id, NameColumn: name)\r\n                        }\r\n                    }\r\n                    Div(#row#){\r\n                        Div(#col_left#){\r\n                            Label(){\r\n                                LangRes(lr_land_use)\r\n                            }\r\n                        }\r\n                        Div(#col_right#){\r\n                            AppParam(App: #app_id#, Name: lr_land_use, Source: src_land_use)\r\n                            Select(Name: LandUse, Source: src_land_use, ValueColumn: id, NameColumn: name)\r\n                        }\r\n                    }\r\n                    Div(#row#){\r\n                        Div(#col_left#){\r\n                            Label(){\r\n                                LangRes(lr_buildings_class)\r\n                            }\r\n                        }\r\n                        Div(#col_right#){\r\n                            AppParam(App: #app_id#, Name: lr_buildings_class, Source: src_buildings_class)\r\n                            Select(Name: BuildingsUseClass, Source: src_buildings_class, ValueColumn: id, NameColumn: name)\r\n                        }\r\n                    }\r\n                    Div(#row#){\r\n                        Div(#col_left#){\r\n                            Label(){\r\n                                LangRes(lr_land_authority)\r\n                            }\r\n                        }\r\n                        Div(#col_right#){\r\n                            AppParam(App: #app_id#, Name: lr_land_authority, Source: src_land_authority)\r\n                            Select(Name: LandAuthority, Source: src_land_authority, ValueColumn: id, NameColumn: name)\r\n                        }\r\n                    }\r\n                    Div(#row#){\r\n                        Div(#col_left#){\r\n                            Label(){\r\n                                LangRes(lr_registration_date)\r\n                            }\r\n                        }\r\n                        Div(#col_right#){\r\n                            If(#edit_price#>0){\r\n                                SetVar(edit_price,Money(#edit_price#))\r\n                            }\r\n                            Input(Name: RegistrationDate, Type: date)\r\n                        }\r\n                    }\r\n                    Div(#row#){\r\n                        Div(#col_left#){\r\n                            Label(){\r\n                                LangRes(lr_price) (#custom_token_title#)\r\n                            }\r\n                        }\r\n                        Div(#col_right#){\r\n                            If(#edit_price#>0){\r\n                                SetVar(edit_price,Money(#edit_price#))\r\n                            }\r\n                            Input(Name: Price)\r\n                        }\r\n                    }\r\n                }\r\n                Div(panel-footer text-right){\r\n                    Button(Page: #back_page#, PageParams: \"sales_list=#sales_list#\", Body: LangRes(@1back), Class: btn btn-default)\r\n                    Button(Contract: LrAdd, Page: #back_page#, PageParams: \"sales_list=0\", Body: $lr_object_create$, Class: btn btn-primary)\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "lr_edit",
            "Conditions": "ContractConditions(\"AdminCondition\")",
            "Value": "If(#object_id#>0){\r\n    Include(lr_check_rights)\r\n    DBFind(\"@1applications\").Where({ecosystem: #ecosystem_id#, name: \"Land registry\"}).Columns(\"name,id\").Vars(app)\r\n    SetVar(row,\"row mt-sm\").(col_left,\"col-md-3 mt-sm text-right\").(col_right,\"col-md-9 text-left\")\r\n\r\n    If(GetVar(edit_specifications_land_type)==\"\"){\r\n        SetVar(edit_specifications_land_type,1)\r\n    }\r\n    If(GetVar(edit_specifications_land_use)==\"\"){\r\n        SetVar(edit_specifications_land_use,1)\r\n    }\r\n    If(GetVar(edit_specifications_buildings_class)==\"\"){\r\n        SetVar(edit_specifications_buildings_class,1)\r\n    }\r\n    If(GetVar(edit_specifications_land_authority)==\"\"){\r\n        SetVar(edit_specifications_land_authority,1)\r\n    }\r\n    If(GetVar(edit_registration_date)==\"\"){\r\n        SetVar(edit_registration_date,)\r\n    }\r\n    If(GetVar(edit_price)==\"\"){\r\n        SetVar(edit_price,)\r\n    }\r\n    SetVar(custom_token_title, \"APLA\")\r\n    If(#ecosystem_id#>1){\r\n        DBFind(\"@1ecosystems\").Where({\"id\": #ecosystem_id#}).Vars(\"custom\")\r\n    }\r\n\r\n    DBFind(land_registry, src).WhereId(#object_id#).Columns(\"id,owner_id,specifications->map_coords,specifications->address,specifications->land_type,specifications->land_use,specifications->buildings_class,specifications->land_authority,registration_date,price\").Vars(edit)\r\n\r\n    Form(){\r\n        Div(){\r\n            Map(MapType: streets, Hmap: 250, Value: #edit_specifications_map_coords#)\r\n        }\r\n        Div(row mt){\r\n            Div(#col_left#){\r\n                Label(){\r\n                    LangRes(lr_location)\r\n                }\r\n            }\r\n            Div(#col_right#){\r\n                Input(Value: #edit_specifications_address#, Disabled: true)\r\n            }\r\n        }\r\n        Div(#row#){\r\n            Div(#col_left#){\r\n                Label(){\r\n                    LangRes(@1type)\r\n                }\r\n            }\r\n            Div(#col_right#){\r\n                If(#admin#==1){\r\n                    AppParam(App: #app_id#, Name: lr_land_type, Source: lr_land_type)\r\n                    Select(Name: LandType, Source: lr_land_type, ValueColumn: id, NameColumn: name, Value: #edit_specifications_land_type#)\r\n                }.Else{\r\n                    SetVar(edit_specifications_land_type, AppParam(App: #app_id#, Name: lr_land_type, Index: #edit_specifications_land_type#))\r\n                    Input(Value: #edit_specifications_land_type#, Disabled: true)\r\n                }\r\n            }\r\n        }\r\n        Div(#row#){\r\n            Div(#col_left#){\r\n                Label(){\r\n                    LangRes(lr_land_use)\r\n                }\r\n            }\r\n            Div(#col_right#){\r\n                If(#admin#==1){\r\n                    AppParam(App: #app_id#, Name: lr_land_use, Source: src_land_use)\r\n                    Select(Name: LandUse, Source: src_land_use, ValueColumn: id, NameColumn: name, Value: #edit_specifications_land_use#)\r\n                }.Else{\r\n                    SetVar(edit_specifications_land_use, AppParam(App: #app_id#, Name: lr_land_use, Index: #edit_specifications_land_use#))\r\n                    Input(Value: #edit_specifications_land_use#, Disabled: true)\r\n                }\r\n            }\r\n        }\r\n        Div(#row#){\r\n            Div(#col_left#){\r\n                Label(){\r\n                    LangRes(lr_buildings_class)\r\n                }\r\n            }\r\n            Div(#col_right#){\r\n                If(#admin#==1){\r\n                    AppParam(App: #app_id#, Name: lr_buildings_class, Source: src_buildings_class)\r\n                    Select(Name: BuildingsUseClass, Source: src_buildings_class, ValueColumn: id, NameColumn: name, Value: #edit_specifications_buildings_class#)\r\n                }.Else{\r\n                    SetVar(edit_specifications_buildings_class, AppParam(App: #app_id#, Name: lr_buildings_class, Index: #edit_specifications_buildings_class#))\r\n                    Input(Value: #edit_specifications_buildings_class#, Disabled: true)\r\n                }\r\n            }\r\n        }\r\n        Div(#row#){\r\n            Div(#col_left#){\r\n                Label(){\r\n                    LangRes(lr_land_authority)\r\n                }\r\n            }\r\n            Div(#col_right#){\r\n                If(#admin#==1){\r\n                    AppParam(App: #app_id#, Name: lr_land_authority, Source: src_land_authority)\r\n                    Select(Name: LandAuthority, Source: src_land_authority, ValueColumn: id, NameColumn: name, Value: #edit_specifications_land_authority#)\r\n                }.Else{\r\n                    SetVar(edit_specifications_land_authority, AppParam(App: #app_id#, Name: lr_land_authority, Index: #edit_specifications_land_authority#))\r\n                    Input(Value: #edit_specifications_land_authority#, Disabled: true)\r\n                }\r\n            }\r\n        }\r\n        Div(#row#){\r\n            Div(#col_left#){\r\n                Label(){\r\n                    LangRes(lr_registration_date)\r\n                }\r\n            }\r\n            Div(#col_right#){\r\n                If(#edit_registration_date#>0){\r\n                    SetVar(edit_registration_date, DateTime(#edit_registration_date#, \"YYYY-MM-DD\"))\r\n                }\r\n                If(#admin#==1){\r\n                    Input(Name: RegistrationDate, Type: date, Value: #edit_registration_date#)\r\n                }.Else{\r\n                    Input(Value: #edit_registration_date#, Disabled: true)\r\n                }\r\n            }\r\n        }\r\n        Div(#row#){\r\n            Div(#col_left#){\r\n                Label(){\r\n                    LangRes(lr_price) (#custom_token_title#)\r\n                }\r\n            }\r\n            Div(#col_right#){\r\n                If(#edit_price#>0){\r\n                    SetVar(edit_price, Money(#edit_price#))\r\n                }\r\n                If(#edit_owner_id#==#key_id#){\r\n                    Input(Name: Price, Value: #edit_price#)\r\n                }.Else{\r\n                    Input(Value: #edit_price#, Disabled: true)\r\n                }\r\n            }\r\n        }\r\n        Button(Body: LangRes(@1save), Class: btn btn-primary pull-right mt, Contract: LrEdit, Params: \"ObjectId=#edit_id#,RoleId=#role_id#\", Page: #back_page#, PageParams: \"sales_list=#sales_list#\")\r\n        Button(Body: LangRes(@1back), Class: btn btn-default pull-right mt, Page: #back_page#, PageParams: \"sales_list=#sales_list#\")\r\n    }\r\n}.Else{\r\n    Form(){\r\n        Div(alert alert-danger text-center){\r\n            LangRes(@1attention)\r\n        }\r\n        Button(Body: LangRes(@1back), Class: btn btn-default pull-right, Page: lr_list)\r\n    }\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "lr_list",
            "Conditions": "ContractConditions(\"AdminCondition\")",
            "Value": "SetVar(this_page, lr_list).(this_table, land_registry)\r\nInclude(@1pager_header)\r\nInclude(lr_check_rights)\r\n\r\nSetVar(custom_token_title, \"APLA\")\r\nIf(#ecosystem_id#>1){\r\n    DBFind(\"@1ecosystems\").Where({\"id\": #ecosystem_id#}).Vars(\"custom\")\r\n}\r\n\r\nIf(And(#sales_list#==\"\",#admin#!=1,#bank#!=1,#depart2#!=1,#depart3#!=1)){\r\n    SetVar(sales_list, 1)\r\n}\r\n\r\nIf(#sales_list#==1){\r\n    SetVar(title, $lr_sales$)\r\n    Span(Class: text-muted h5 m0 mb ml-lg, Body: Span(Class: ml-sm, Body: \"$lr_sales_desc$\"))\r\n    SetVar(filters, {\"price\": {$gt: 0}, \"government_price\": {$gt: 0}, \"market_price\": {$gt: 0}, \"status->legal_status\": 1, \"status->encumbrance_certificate\": 1, \"status->tax_receipt_and_bills\": 1, \"deleted\": 0})\r\n}.Else{\r\n    SetVar(sales_list, 0)\r\n    SetVar(title, $lr_land_registry$)\r\n    Span(Class: text-muted h5 m0 mb ml-lg, Body: Span(Class: ml-sm, Body: \"$lr_list_desc$\"))\r\n    \r\n    If(And(#admin#!=1,#bank#!=1,#depart2#!=1,#depart3#!=1)){\r\n        SetVar(filters, {$or: [{\"owner_id\": #key_id#, \"deleted\": 0}, {\"price\": {$gt: 0}, \"government_price\": {$gt: 0}, \"market_price\": {$gt: 0}, \"status->legal_status\": 1, \"status->encumbrance_certificate\": 1, \"status->tax_receipt_and_bills\": 1, \"deleted\": 0}]})\r\n    }.Else{\r\n        SetVar(filters, {\"deleted\": 0})\r\n    }\r\n}\r\n\r\nIf(#admin# == 1){\r\n    SetTitle(#title# ($lr_admin_role_name$))\r\n}.ElseIf(#bank# == 1){\r\n    SetTitle(#title# ($lr_bank_role_name$))\r\n}.ElseIf(#depart2# == 1){\r\n    SetTitle(#title# ($lr_depart2_role_name$))\r\n}.ElseIf(#depart3# == 1){\r\n    SetTitle(#title# ($lr_depart3_role_name$))\r\n}.Else{\r\n    SetTitle(#title#)\r\n}\r\n\r\nAddToolButton(Title: $@1add$, Page: lr_add, PageParams: \"back_page=#this_page#,sales_list=#sales_list#\", Icon: icon-plus)\r\n\r\nDiv(btn-group ml-lg){\r\n    If(#sales_list#==0){\r\n        Button(Body: Em(Class: fa fa-list) $lr_all_objects$, Page: #this_page#, PageParams: \"sales_list=0\", Class: btn bg-gray-lighter ml-sm)\r\n    }.Else{\r\n        Button(Body: Em(Class: fa fa-list) $lr_all_objects$, Page: #this_page#, PageParams: \"sales_list=0\", Class: btn bg-gray ml-sm)\r\n    }\r\n    If(#sales_list#==1){\r\n        Button(Body: Em(Class: fa fa-credit-card) $@1sales$, Page: #this_page#, PageParams: \"sales_list=1\", Class: btn bg-gray-lighter ml-sm)\r\n    }.Else{\r\n        Button(Body: Em(Class: fa fa-credit-card) $@1sales$, Page: #this_page#, PageParams: \"sales_list=1\", Class: btn bg-gray ml-sm)\r\n    }\r\n}\r\n\r\nIf(GetVar(search)!=\"\"){\r\n    SetVar(where, {GetVar(filters), \"specifications->address\": {$ilike: #search#}})\r\n}.Else{\r\n    SetVar(where, GetVar(filters)).(search,)\r\n}\r\n\r\nDiv(list-group-item ml-lg mr-lg pt-lg){\r\n    SetVar(search_name, LangRes(lr_location))\r\n    Include(@1search)\r\n}\r\n\r\nDBFind(#this_table#, src).Where(#where#).Order({\"id\": -1}).Limit(#pager_limit#).Offset(#pager_offset#).Columns(\"owner_id,buyer_id,specifications->address,specifications->land_use,specifications->buildings_class,specifications->area,price,status->legal_status,status->encumbrance_certificate,status->tax_receipt_and_bills,step\").Custom(location){\r\n    If(#specifications.address#){\r\n        SetVar(location_name, #specifications.address#)\r\n    }.Else{\r\n        SetVar(location_name, $lr_no_address_found$)\r\n    }\r\n    Button(Page: lr_view, PageParams: \"object_id=#id#,back_page=#this_page#,sales_list=#sales_list#\", Body: #location_name#, Class: btn-link).Popup(50, $lr_object_view$)\r\n}.Custom(owner_price){\r\n    If(GetVar(price)){\r\n        Money(#price#) #custom_token_title#\r\n    }.Else{\r\n        Em(Class: fa fa-question-circle text-muted)\r\n    }\r\n}.Custom(owner){\r\n    SetVar(m_id, 0)\r\n    DBFind(\"@1members\").Where({\"id\": #owner_id#, \"ecosystem\": #ecosystem_id#}).Vars(m)\r\n    If(Or(#m_id#>0,#m_id#<0)){\r\n        SetVar(owner_image_id, #m_image_id#)\r\n        SetVar(owner_member_name, #m_member_name#)\r\n    }.Else{\r\n        SetVar(owner_image_id, 0)\r\n        SetVar(owner_member_name, Address(#owner_id#))\r\n    }\r\n    LinkPage(Page: @1profile_view, PageParams: \"v_key_id=#owner_id#\"){\r\n        If(#owner_image_id#>0){\r\n            Image(Src: Binary().ById(#owner_image_id#), Class: img-circle).Style(height: 30px; width: 30px; border: 1px solid #5A5D63;)\r\n            Span(Class: ml-sm text-bold, Body: #owner_member_name#)\r\n        }.Else{\r\n            Div(){\r\n                Span(Em(Class: fa icon-user fa-2x))\r\n                Span(Class: ml-sm text-bold, Body: #owner_member_name#)\r\n            }.Style(display:flex; align-items:center;)\r\n        }\r\n    }\r\n}.Custom(buyer){\r\n    If(#owner_id#!=#buyer_id#){\r\n        SetVar(n_id, 0)\r\n        DBFind(\"@1members\").Where({\"id\": #buyer_id#, \"ecosystem\": #ecosystem_id#}).Vars(n)\r\n        If(Or(#n_id#>0,#n_id#<0)){\r\n            SetVar(buyer_image_id, #n_image_id#)\r\n            SetVar(buyer_member_name, #n_member_name#)\r\n        }.Else{\r\n            SetVar(buyer_image_id, 0)\r\n            SetVar(buyer_member_name, Address(#buyer_id#))\r\n        }\r\n        LinkPage(Page: @1profile_view, PageParams: \"v_key_id=#buyer_id#\"){\r\n            If(#buyer_image_id#>0){\r\n                Image(Src: Binary().ById(#buyer_image_id#), Class: img-circle).Style(height: 30px; width: 30px; border: 1px solid #5A5D63;)\r\n                Span(Class: ml-sm text-bold, Body: #buyer_member_name#)\r\n            }.Else{\r\n                Div(){\r\n                    Span(Em(Class: fa icon-user fa-2x))\r\n                    Span(Class: ml-sm text-bold, Body: #buyer_member_name#)\r\n                }.Style(display:flex; align-items:center;)\r\n            }\r\n        }\r\n    }\r\n}.Custom(deal_status){\r\n    If(#step#==-1){\r\n        Em(Class: fa fa-fw fa-check-circle text-success) $lr_available_for_purchase$\r\n    }.ElseIf(#step#==0){\r\n        Em(Class: fa fa-fw fa-hourglass-1 text-primary) $lr_awaiting_owner_accept$\r\n    }.ElseIf(#step#==1){\r\n        Em(Class: fa fa-fw fa-hourglass-2 text-primary) $lr_awaiting_buyer_deposit$\r\n    }.ElseIf(#step#==2){\r\n        Em(Class: fa fa-fw fa-hourglass-3 text-primary) $lr_awaiting_bank_transfer$\r\n    }\r\n}.Custom(legal_status){\r\n    If(#status.legal_status#==1){\r\n        Em(Class: fa fa-check-circle text-success)\r\n    }.ElseIf(#status.legal_status#==2){\r\n        Em(Class: fa fa-exclamation-circle text-danger)\r\n    }.Else{\r\n        Em(Class: fa fa-question-circle text-muted)\r\n    }\r\n}.Custom(encumbrance_certificate){\r\n    If(#status.encumbrance_certificate#==1){\r\n        Em(Class: fa fa-check-circle text-success)\r\n    }.ElseIf(#status.encumbrance_certificate#==2){\r\n        Em(Class: fa fa-exclamation-circle text-danger)\r\n    }.Else{\r\n        Em(Class: fa fa-question-circle text-muted)\r\n    }\r\n}.Custom(tax_receipt_and_bills){\r\n    If(#status.tax_receipt_and_bills#==1){\r\n        Em(Class: fa fa-check-circle text-success)\r\n    }.ElseIf(#status.tax_receipt_and_bills#==2){\r\n        Em(Class: fa fa-exclamation-circle text-danger)\r\n    }.Else{\r\n        Em(Class: fa fa-question-circle text-muted)\r\n    }\r\n}.Custom(actions){\r\n    If(And(Or(#owner_id#==#key_id#,#admin#==1),#step#<2)){\r\n        Button(Page: #this_page#, PageParams: \"sales_list=#sales_list#\", Contract: LrEdit, Params: \"ObjectId=#id#,RoleId=#role_id#,DeleteObject=1\", Class: btn bg-gray-lighter pull-right ml-sm, Body: Em(Class: text-danger fa fa-trash)).Alert($lr_want_delete_object$, $@1confirm_button$, $@1cancel$)\r\n        Button(Page: lr_edit, PageParams: \"object_id=#id#,back_page=#this_page#,sales_list=#sales_list#\", Class: btn bg-gray-lighter pull-right, Body: Em(Class: fa fa-edit)).Popup(50, $lr_object_edit$)\r\n    }\r\n}.Count(count)\r\n\r\nDiv(fullscreen){\r\n    Div(table-responsive ml-lg mr-lg){\r\n        Div(list-group-item){\r\n            If(#count# > 0){\r\n                If(#sales_list#==1){\r\n                    Table(src, \"$lr_location$=location,$lr_price$=owner_price,$lr_owner$=owner,$lr_buyer$=buyer,$@1status$=deal_status,=actions\")\r\n                }.Else{\r\n                    Table(src, \"$lr_location$=location,$lr_price$=owner_price,$lr_owner$=owner,$lr_legal_status$=legal_status,$lr_encumbrance_certificate$=encumbrance_certificate,$lr_taxes_and_bills$=tax_receipt_and_bills,=actions\")\r\n                }\r\n            }.Else{\r\n                Div(Class: text-center h4 text-muted, Body: \"$lr_no_objects_found$\")\r\n            }\r\n        }.Style(\r\n            margin-top:-15px;\r\n            tbody > tr:nth-of-type(odd) {\r\n                background-color: #f8f9fc;\r\n            }\r\n        )\r\n    }\r\n}\r\nDiv(mt-sm ml-lg mr-sm mb-sm){\r\n    Include(@1pager)\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "lr_settings",
            "Conditions": "ContractConditions(\"AdminCondition\")",
            "Value": "DBFind(\"@1applications\").Where({ecosystem: #ecosystem_id#, name: \"Land registry\"}).Columns(\"name,id\").Vars(app)\r\n\r\nSetVar(this_page, lr_settings).(admin_role,0).(bank_role,0).(depart2_role,0).(depart3_role,0)\r\nSetVar(admin_role, AppParam(App: #app_id#, Name: lr_admin_role))\r\nSetVar(bank_role, AppParam(App: #app_id#, Name: lr_bank_role))\r\nSetVar(depart2_role, AppParam(App: #app_id#, Name: lr_depart2_role))\r\nSetVar(depart3_role, AppParam(App: #app_id#, Name: lr_depart3_role))\r\n\r\nDBFind(@1roles,src_roles).Where({ecosystem: #ecosystem_id#, deleted: 0}).Columns(\"role_name,id\").Limit(100)\r\n\r\nSetVar(row,\"row mt-sm\").(col_left,\"col-sm-4 text-right mt-sm\").(col_right,\"col-sm-8 text-left\")\r\n\r\nIf(#ecosystem_id#>1){\r\n    DBFind(\"@1ecosystems\").Where({\"id\": #ecosystem_id#}).Vars(\"custom\")\r\n}.Else{\r\n    SetVar(custom_token_title, \"APLA\")\r\n}\r\n\r\nDiv(content-wrapper){\r\n    Div(row){\r\n        Div(col-lg-6 col-lg-offset-3 col-md-8 col-md-offset-2 col-sm-10 col-sm-offset-1){\r\n            Form(panel panel-primary){\r\n                If(#custom_token_title# != \"\"){\r\n                    Div(panel-body){\r\n                        Div(text-center text-bold h4 m0){\r\n                            LangRes(lr_settings)\r\n                        }\r\n                        Div(text-center text-muted){\r\n                            $lr_settings_description$\r\n                        }\r\n                        Div(row mt-lg){\r\n                            Div(#col_left#){\r\n                                Label(){\r\n                                    LangRes(lr_admin_role_name)\r\n                                }\r\n                            }\r\n                            Div(#col_right#){\r\n                                Select(Name: RoleAdmin, Source: src_roles, NameColumn: role_name, ValueColumn: id, Value: #admin_role#)\r\n                            }\r\n                        }\r\n                        Div(#row#){\r\n                            Div(#col_left#){\r\n                                Label(){\r\n                                    LangRes(lr_bank_role_name)\r\n                                }\r\n                            }\r\n                            Div(#col_right#){\r\n                                Select(Name: RoleBank, Source: src_roles, NameColumn: role_name, ValueColumn: id, Value: #bank_role#)\r\n                            }\r\n                        }\r\n                        Div(#row#){\r\n                            Div(#col_left#){\r\n                                Label(){\r\n                                    LangRes(lr_depart2_role_name)\r\n                                }\r\n                            }\r\n                            Div(#col_right#){\r\n                                Select(Name: RoleDepart2, Source: src_roles, NameColumn: role_name, ValueColumn: id, Value: #depart2_role#)\r\n                            }\r\n                        }\r\n                        Div(#row#){\r\n                            Div(#col_left#){\r\n                                Label(){\r\n                                    LangRes(lr_depart3_role_name)\r\n                                }\r\n                            }\r\n                            Div(#col_right#){\r\n                                Select(Name: RoleDepart3, Source: src_roles, NameColumn: role_name, ValueColumn: id, Value: #depart3_role#)\r\n                            }\r\n                        }\r\n                    }\r\n                    Div(panel-footer text-right){\r\n                        Button(Body: $@1apply_settings$, Class: btn btn-primary, Page: #this_page#, Contract: LrSettings)\r\n                    }\r\n                }.Else{\r\n                    Div(panel-body){\r\n                        Div(text-center text-bold h4 m0){\r\n                            LangRes(lr_settings)\r\n                        }\r\n                        Div(text-center text-muted){\r\n                            LangRes(lr_tokens_needed)\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Menu": "admin_menu",
            "Type": "pages"
        },
        {
            "Name": "lr_view",
            "Conditions": "ContractConditions(\"AdminCondition\")",
            "Value": "If(#notific_id#>0){\r\n    DBFind(\"@1notifications\").Where({\"id\": #notific_id#, \"ecosystem\": #ecosystem_id#}).Columns(\"notification->body,recipient->member_id,page_params->object_id,page_params->info_message,page_params->info_status,closed\").Vars(notific)\r\n    SetVar(object_id, #notific_page_params_object_id#)\r\n    SetVar(back_page,@1notifications_list)\r\n}\r\n\r\nIf(#object_id#>0){\r\n    Include(lr_check_rights)\r\n    DBFind(\"@1applications\").Where({ecosystem: #ecosystem_id#, name: \"Land registry\"}).Columns(\"name,id\").Vars(app)\r\n    AppParam(App: #app_id#, Name: lr_issues, Source: src_issues)\r\n    SetVar(col_left,\"col-md-4 text-right\").(col_right,\"col-md-8 text-left\")\r\n    DBFind(\"land_registry\", src).WhereId(#object_id#).Columns(\"id,owner_id,buyer_id,step,specifications->map_coords,specifications->address,specifications->area,specifications->land_type,specifications->land_use,specifications->buildings_class,specifications->land_authority,registration_date,date_created,modification_date,status->legal_status,status->encumbrance_certificate,status->tax_receipt_and_bills,price,market_price,government_price\").Vars(view)\r\n    SetVar(custom_token_title, \"APLA\")\r\n    If(#ecosystem_id#>1){\r\n        DBFind(\"@1ecosystems\").Where({\"id\": #ecosystem_id#}).Vars(\"custom\")\r\n    }\r\n\r\n    If(#view_owner_id#==#key_id#){\r\n        SetVar(owner,1)\r\n        DBFind(\"@1notifications\").Where({\"page_params->object_id\": #view_id#, \"page_params->depart2_requests\": 2, \"ecosystem\": #ecosystem_id#}).Columns(\"id\").Vars(depart2)\r\n        DBFind(\"@1notifications\").Where({\"page_params->object_id\": #view_id#, \"page_params->depart3_requests\": 2, \"ecosystem\": #ecosystem_id#}).Columns(\"id\").Vars(depart3)\r\n        If(#depart2_id#>0){\r\n            SetVar(depart2_requests,2)\r\n        }.Else{\r\n            SetVar(depart2_requests,1)\r\n        }\r\n        If(#depart3_id#>0){\r\n            SetVar(depart3_requests,2)\r\n        }.Else{\r\n            SetVar(depart3_requests,1)\r\n        }\r\n    }\r\n    If(#view_buyer_id#==#key_id#){\r\n        SetVar(buyer,1)\r\n    }\r\n    If(And(#view_status_legal_status#==1,#view_status_encumbrance_certificate#==1,#view_status_tax_receipt_and_bills#==1,#view_government_price#>0,#view_market_price#>0)){\r\n        SetVar(depart_checks,1)\r\n        If(And(#depart_checks#==1,#view_step#==-1,#view_price#>0)){\r\n            SetVar(available_for_sale,1)\r\n        }\r\n    }\r\n\r\n    Form(){\r\n        Div(){\r\n            Map(MapType: streets, Hmap: 250, Value: #view_specifications_map_coords#)\r\n        }\r\n        Div(row mt){\r\n            Div(#col_left# mt-sm){\r\n                Label(){\r\n                    LangRes(lr_owner)\r\n                }\r\n            }\r\n            Div(#col_right#){\r\n                SetVar(m_id, 0)\r\n                DBFind(\"@1members\").Where({\"id\": #view_owner_id#, \"ecosystem\": #ecosystem_id#}).Vars(m)\r\n                If(Or(#m_id#>0,#m_id#<0)){\r\n                    SetVar(image_id, #m_image_id#)\r\n                    SetVar(member_name, #m_member_name#)\r\n                }.Else{\r\n                    SetVar(image_id, 0)\r\n                    SetVar(member_name, Address(#view_owner_id#))\r\n                }\r\n                LinkPage(Page: @1profile_view, PageParams: \"v_key_id=#view_owner_id#\"){\r\n                    If(#image_id#>0){\r\n                        Image(Src: Binary().ById(#image_id#), Class: img-circle).Style(height: 30px; width: 30px; border: 1px solid #5A5D63;)\r\n                        Span(Class: ml-sm text-bold, Body: #member_name#)\r\n                    }.Else{\r\n                        Div(){\r\n                            Span(Em(Class: fa icon-user fa-2x))\r\n                            Span(Class: ml-sm text-bold, Body: #member_name#)\r\n                        }.Style(display:flex; align-items:center;)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        Div(row mt-sm){\r\n            Div(#col_left#){\r\n                Label(){\r\n                    LangRes(lr_location)\r\n                }\r\n            }\r\n            Div(#col_right#){\r\n                If(#view_specifications_address#){\r\n                    Span(#view_specifications_address#)\r\n                }.Else{\r\n                    Span($lr_no_address_found$)\r\n                }\r\n            }\r\n        }\r\n        Div(row){\r\n            Div(#col_left#){\r\n                Label(){\r\n                    LangRes(lr_area_size)\r\n                }\r\n            }\r\n            Div(#col_right#){\r\n                Span(#view_specifications_area#)\r\n            }\r\n        }\r\n        Div(row){\r\n            Div(#col_left#){\r\n                Label(){\r\n                    LangRes(@1date_created)\r\n                }\r\n            }\r\n            Div(#col_right#){\r\n                If(#view_date_created#>0){\r\n                    SetVar(view_date_created, DateTime(#view_date_created#, \"YYYY-MM-DD\"))\r\n                    Span(#view_date_created#)\r\n                }\r\n            }\r\n        }\r\n        Div(row){\r\n            Div(#col_left#){\r\n                Label(){\r\n                    LangRes(lr_registration_date)\r\n                }\r\n            }\r\n            Div(#col_right#){\r\n                If(#view_registration_date#>0){\r\n                    SetVar(view_registration_date, DateTime(#view_registration_date#, \"YYYY-MM-DD\"))\r\n                    Span(#view_registration_date#)\r\n                }\r\n            }\r\n        }\r\n        Div(row){\r\n            Div(#col_left#){\r\n                Label(){\r\n                    LangRes(lr_modification_date)\r\n                }\r\n            }\r\n            Div(#col_right#){\r\n                If(#view_modification_date#>0){\r\n                    SetVar(view_modification_date, DateTime(#view_modification_date#, \"YYYY-MM-DD\"))\r\n                    Span(#view_modification_date#)\r\n                }\r\n            }\r\n        }\r\n        Div(row){\r\n            Div(#col_left#){\r\n                Label(){\r\n                    LangRes(@1type)\r\n                }\r\n            }\r\n            Div(#col_right#){\r\n                SetVar(view_specifications_land_type, AppParam(App: #app_id#, Name: lr_land_type, Index: #view_specifications_land_type#))\r\n                Span(#view_specifications_land_type#)\r\n            }\r\n        }\r\n        Div(row){\r\n            Div(#col_left#){\r\n                Label(){\r\n                    LangRes(lr_land_use)\r\n                }\r\n            }\r\n            Div(#col_right#){\r\n                SetVar(view_specifications_land_use, AppParam(App: #app_id#, Name: lr_land_use, Index: #view_specifications_land_use#))\r\n                Span(#view_specifications_land_use#)\r\n            }\r\n        }\r\n        Div(row){\r\n            Div(#col_left#){\r\n                Label(){\r\n                    LangRes(lr_buildings_class)\r\n                }\r\n            }\r\n            Div(#col_right#){\r\n                SetVar(view_specifications_buildings_class, AppParam(App: #app_id#, Name: lr_buildings_class, Index: #view_specifications_buildings_class#))\r\n                Span(#view_specifications_buildings_class#)\r\n            }\r\n        }\r\n        Div(row){\r\n            Div(#col_left#){\r\n                Label(){\r\n                    LangRes(lr_land_authority)\r\n                }\r\n            }\r\n            Div(#col_right#){\r\n                SetVar(view_specifications_land_authority, AppParam(App: #app_id#, Name: lr_land_authority, Index: #view_specifications_land_authority#))\r\n                Span(#view_specifications_land_authority#)\r\n            }\r\n        }\r\n        Div(row){\r\n            Div(#col_left#){\r\n                Label(){\r\n                    LangRes(lr_price)\r\n                }\r\n            }\r\n            Div(#col_right#){\r\n                If(#view_price#>0){\r\n                    SetVar(view_price, Money(#view_price#))\r\n                    Span(#view_price# #custom_token_title#)\r\n                }.Else{\r\n                    Em(Class: fa fa-question-circle text-muted)\r\n                }\r\n            }\r\n        }\r\n        If(And(#depart3#==1,#depart_checks#!=1,#notific_recipient_member_id#==\"\")){\r\n            Div(list-group-item){\r\n                Div(row mt-sm){\r\n                    Div(#col_left# mt-sm){\r\n                        Label(){\r\n                            LangRes(lr_market_price)\r\n                        }\r\n                    }\r\n                    Div(#col_right#){\r\n                        If(#view_market_price#>0){\r\n                            SetVar(view_market_price, Money(#view_market_price#))\r\n                            Input(Name: MarketPrice, Value: #view_market_price#)\r\n                        }.Else{\r\n                            Input(Name: MarketPrice)\r\n                        }\r\n                    }\r\n                }\r\n                Div(row mt-sm){\r\n                    Div(#col_left# mt-sm){\r\n                        Label(){\r\n                            LangRes(lr_government_price)\r\n                        }\r\n                    }\r\n                    Div(#col_right#){\r\n                        If(#view_government_price#>0){\r\n                            SetVar(view_government_price, Money(#view_government_price#))\r\n                            Input(Name: GovernmentPrice, Value: #view_government_price#)\r\n                        }.Else{\r\n                            Input(Name: GovernmentPrice)\r\n                        }\r\n                    }\r\n                }\r\n                Div(row mt-sm){\r\n                    Div(#col_left#){\r\n                        Label(){\r\n                            LangRes(lr_taxes_and_bills)\r\n                        }\r\n                    }\r\n                    Div(#col_right#){\r\n                        Div(form-inline){\r\n                            If(#view_status_tax_receipt_and_bills#>0){\r\n                                RadioGroup(Name: TaxReceiptAndBills, Value: #view_status_tax_receipt_and_bills#, Source: src_issues, ValueColumn: id, NameColumn: name)\r\n                            }.Else{\r\n                                RadioGroup(Name: TaxReceiptAndBills, Value: 0, Source: src_issues, ValueColumn: id, NameColumn: name)\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }.Else{\r\n            Div(row){\r\n                Div(#col_left#){\r\n                    Label(){\r\n                        LangRes(lr_market_price)\r\n                    }\r\n                }\r\n                Div(#col_right#){\r\n                    If(#view_market_price#>0){\r\n                        SetVar(view_market_price, Money(#view_market_price#))\r\n                        Span(#view_market_price# #custom_token_title#)\r\n                    }.Else{\r\n                        Em(Class: fa fa-question-circle text-muted)\r\n                        If(And(#owner#==1,#depart3_requests#==1)){\r\n                            Button(Body: ($lr_additional_request$), Class: btn-link p0 ml-sm, Contract: LrDepartRequest, Params: \"ObjectId=#view_id#,DepartNumber=3\", Page: #back_page#, PageParams: \"sales_list=#sales_list#\")\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            Div(row){\r\n                Div(#col_left#){\r\n                    Label(){\r\n                        LangRes(lr_government_price)\r\n                    }\r\n                }\r\n                Div(#col_right#){\r\n                    If(#view_government_price#>0){\r\n                        SetVar(view_government_price, Money(#view_government_price#))\r\n                        Span(#view_government_price# #custom_token_title#)\r\n                    }.Else{\r\n                        Em(Class: fa fa-question-circle text-muted)\r\n                        If(And(#owner#==1,#depart3_requests#==1)){\r\n                            Button(Body: ($lr_additional_request$), Class: btn-link p0 ml-sm, Contract: LrDepartRequest, Params: \"ObjectId=#view_id#,DepartNumber=3\", Page: #back_page#, PageParams: \"sales_list=#sales_list#\")\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            Div(row){\r\n                Div(#col_left#){\r\n                    Label(){\r\n                        LangRes(lr_taxes_and_bills)\r\n                    }\r\n                }\r\n                Div(#col_right#){\r\n                    If(#view_status_tax_receipt_and_bills#==1){\r\n                        Em(Class: fa fa-check-circle text-success)\r\n                    }.ElseIf(#view_status_tax_receipt_and_bills#==2){\r\n                        Em(Class: fa fa-exclamation-circle text-danger)\r\n                    }.Else{\r\n                        Em(Class: fa fa-question-circle text-muted)\r\n                        If(And(#owner#==1,#depart3_requests#==1)){\r\n                            Button(Body: ($lr_additional_request$), Class: btn-link p0 ml-sm, Contract: LrDepartRequest, Params: \"ObjectId=#view_id#,DepartNumber=3\", Page: #back_page#, PageParams: \"sales_list=#sales_list#\")\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        If(And(#depart2#==1,#depart_checks#!=1,#notific_recipient_member_id#==\"\")){\r\n            Div(list-group-item){\r\n                Div(row mt-sm){\r\n                    Div(#col_left#){\r\n                        Label(){\r\n                            LangRes(lr_legal_status)\r\n                        }\r\n                    }\r\n                    Div(#col_right#){\r\n                        Div(form-inline){\r\n                            If(#view_status_legal_status#>0){\r\n                                RadioGroup(Name: LegalStatus, Value: #view_status_legal_status#, Source: src_issues, ValueColumn: id, NameColumn: name)\r\n                            }.Else{\r\n                                RadioGroup(Name: LegalStatus, Value: 0, Source: src_issues, ValueColumn: id, NameColumn: name)\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                Div(row mt-sm){\r\n                    Div(#col_left#){\r\n                        Label(){\r\n                            LangRes(lr_encumbrance_certificate)\r\n                        }\r\n                    }\r\n                    Div(#col_right#){\r\n                        Div(form-inline){\r\n                            If(#view_status_encumbrance_certificate#>0){\r\n                                RadioGroup(Name: EncumbranceCertificate, Value: #view_status_encumbrance_certificate#, Source: src_issues, ValueColumn: id, NameColumn: name)\r\n                            }.Else{\r\n                                RadioGroup(Name: EncumbranceCertificate, Value: 0, Source: src_issues, ValueColumn: id, NameColumn: name)\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }.Else{\r\n            Div(row){\r\n                Div(#col_left#){\r\n                    Label(){\r\n                        LangRes(lr_legal_status)\r\n                    }\r\n                }\r\n                Div(#col_right#){\r\n                    If(#view_status_legal_status#==1){\r\n                        Em(Class: fa fa-check-circle text-success)\r\n                    }.ElseIf(#view_status_legal_status#==2){\r\n                        Em(Class: fa fa-exclamation-circle text-danger)\r\n                    }.Else{\r\n                        Em(Class: fa fa-question-circle text-muted)\r\n                        If(And(#owner#==1,#depart2_requests#==1)){\r\n                            Button(Body: ($lr_additional_request$), Class: btn-link p0 ml-sm, Contract: LrDepartRequest, Params: \"ObjectId=#view_id#,DepartNumber=2\", Page: #back_page#, PageParams: \"sales_list=#sales_list#\")\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            Div(row){\r\n                Div(#col_left#){\r\n                    Label(){\r\n                        LangRes(lr_encumbrance_certificate)\r\n                    }\r\n                }\r\n                Div(#col_right#){\r\n                    If(#view_status_encumbrance_certificate#==1){\r\n                        Em(Class: fa fa-check-circle text-success)\r\n                    }.ElseIf(#view_status_encumbrance_certificate#==2){\r\n                        Em(Class: fa fa-exclamation-circle text-danger)\r\n                    }.Else{\r\n                        Em(Class: fa fa-question-circle text-muted)\r\n                        If(And(#owner#==1,#depart2_requests#==1)){\r\n                            Button(Body: ($lr_additional_request$), Class: btn-link p0 ml-sm, Contract: LrDepartRequest, Params: \"ObjectId=#view_id#,DepartNumber=2\", Page: #back_page#, PageParams: \"sales_list=#sales_list#\")\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        Div(list-group-item){\r\n            Div(row){\r\n                If(And(#notific_closed#==1,And(Or(#depart2#==1,#depart3#==1),#depart_checks#!=1,#view_step#==-1,#notific_recipient_member_id#==\"\")!=1)){\r\n                    Div(col-md-8 col-md-offset-2 text-center){\r\n                        Div(Class: h4, Body: Em(Class: fa fa-fw fa-check-circle text-muted) $lr_decision_made$)\r\n                    }\r\n                }.Else{\r\n                    Div(col-md-2 text-center){\r\n                        If(#view_step#>=0){\r\n                            SetVar(o_id, 0)\r\n                            DBFind(\"@1members\").Where({\"id\": #view_owner_id#, \"ecosystem\": #ecosystem_id#}).Vars(o)\r\n                            If(Or(#o_id#>0,#o_id#<0)){\r\n                                SetVar(owner_image_id, #o_image_id#)\r\n                                SetVar(owner_member_name, #o_member_name#)\r\n                            }.Else{\r\n                                SetVar(owner_image_id, 0)\r\n                                SetVar(owner_member_name, Address(#view_owner_id#))\r\n                            }\r\n                            LinkPage(Page: @1profile_view, PageParams: \"v_key_id=#view_owner_id#\"){\r\n                                If(#owner_image_id#>0){\r\n                                    Image(Src: Binary().ById(#owner_image_id#), Class: img-circle).Style(height: 30px; width: 30px; border: 1px solid #5A5D63;)\r\n                                }.Else{\r\n                                    Span(Em(Class: fa icon-user fa-2x))\r\n                                }\r\n                                Div(Class: short-name text-bold, Body: #owner_member_name#)\r\n                            }\r\n                            Div(Class: text-muted m0, Body: ($lr_owner$))\r\n                        }\r\n                    }\r\n                    Div(col-md-8 text-center){\r\n                        If(And(#notific_page_params_info_message#==1,And(Or(#depart2#==1,#depart3#==1),#depart_checks#!=1,#view_step#==-1,#notific_recipient_member_id#==\"\")!=1)){\r\n                            If(#notific_page_params_info_status#==\"success\"){\r\n                                Div(Class: h4, Body: Em(Class: fa fa-fw fa-check-circle text-success) #notific_notification_body#)\r\n                            }.Else{\r\n                                Div(Class: h4, Body: Em(Class: fa fa-fw fa-times text-danger) #notific_notification_body#)\r\n                            }\r\n                            If(#notific_closed#==0){\r\n                                Button(Body: LangRes(@1understood), Class: btn btn-primary mb, Contract: @1NotificationsClose, Params: \"notific_id=#notific_id#\", Page: #back_page#)\r\n                            }\r\n                        }.ElseIf(And(#view_step#==-1,#available_for_sale#!=1)){\r\n                            Div(Class: h4, Body: Em(Class: fa fa-fw fa-hourglass-o text-primary) $lr_awaiting_depart_checks$)\r\n                            If(Or(#depart2#==1,#depart3#==1)){\r\n                                Button(Body: LangRes(lr_save_results), Class: btn btn-primary mb, Contract: LrDepartChecks, Params: \"ObjectId=#view_id#,RoleId=#role_id#\", Page: #back_page#, PageParams: \"sales_list=#sales_list#\")\r\n                            }\r\n                        }.ElseIf(And(#view_step#==-1,#available_for_sale#==1)){\r\n                            Div(Class: h4, Body: Em(Class: fa fa-fw fa-check-circle text-success) $lr_available_for_purchase$)\r\n                            If(#owner#!=1){\r\n                                Button(Body: LangRes(lr_purchase), Class: btn btn-success mb, Contract: LrPurchaseSteps, Params: \"ObjectId=#view_id#,Step=#view_step#\", Page: #back_page#, PageParams: \"sales_list=#sales_list#\").Alert($lr_want_initiate_purchase$, $@1confirm_button$, $@1cancel$)\r\n                            }\r\n                        }.ElseIf(#view_step#==0){\r\n                            Div(Class: h4, Body: Em(Class: fa fa-fw fa-hourglass-1 text-primary) $lr_awaiting_owner_accept$)\r\n                            If(#owner#==1){\r\n                                Button(Body: LangRes(@1reject), Class: btn btn-danger mb, Contract: LrPurchaseSteps, Params: \"ObjectId=#view_id#,Step=#view_step#,Decision=reject\", Page: #back_page#, PageParams: \"sales_list=#sales_list#\").Alert($lr_want_reject_purchase$, $@1confirm_button$, $@1cancel$)\r\n                                Button(Body: LangRes(@1accept), Class: btn btn-success mb, Contract: LrPurchaseSteps, Params: \"ObjectId=#view_id#,Step=#view_step#,Decision=accept\", Page: #back_page#, PageParams: \"sales_list=#sales_list#\").Alert($lr_want_accept_purchase$, $@1confirm_button$, $@1cancel$)\r\n                            }\r\n                        }.ElseIf(#view_step#==1){\r\n                            Div(Class: h4, Body: Em(Class: fa fa-fw fa-hourglass-2 text-primary) $lr_awaiting_buyer_deposit$)\r\n                            If(Or(#owner#==1,#buyer#==1)){\r\n                                Button(Body: LangRes(@1cancel), Class: btn btn-danger mb, Contract: LrPurchaseSteps, Params: \"ObjectId=#view_id#,Step=#view_step#,Decision=cancel\", Page: #back_page#, PageParams: \"sales_list=#sales_list#\").Alert($lr_want_cancel_deal$, $@1confirm_button$, $@1cancel$)\r\n                            }\r\n                            If(#buyer#==1){\r\n                                SetVar(bank_role_id, AppParam(App: #app_id#, Name: lr_bank_role))\r\n                                DBFind(\"@1roles_participants\").Where({\"role->id\": #bank_role_id#, \"deleted\": 0, \"ecosystem\": #ecosystem_id#}).Columns(\"id,member->member_id\").Vars(bank)\r\n                                SetVar(bank_account,Address(#bank_member_member_id#))\r\n                                If(#bank_id#>0){\r\n                                    Button(Body: LangRes(lr_deposit_money), Class: btn btn-success mb, Contract: LrPurchaseSteps, Params: \"ObjectId=#view_id#,Step=#view_step#,Decision=deposit\", Page: #back_page#, PageParams: \"sales_list=#sales_list#\").CompositeContract(@1TokensSend, [{\"Amount\": #view_price#, \"Recipient\": \"#bank_account#\"}])\r\n                                }\r\n                            }\r\n                        }.ElseIf(#view_step#==2){\r\n                            Div(Class: h4, Body: Em(Class: fa fa-fw fa-hourglass-3 text-primary) $lr_awaiting_bank_transfer$)\r\n                            If(#bank#==1){\r\n                                Button(Body: LangRes(@1cancel), Class: btn btn-danger mb, Contract: LrPurchaseSteps, Params: \"ObjectId=#view_id#,RoleId=#role_id#,Step=#view_step#,Decision=cancel\", Page: #back_page#, PageParams: \"sales_list=#sales_list#\").Alert($lr_want_cancel_deal$, $@1confirm_button$, $@1cancel$)\r\n                                Button(Body: LangRes(lr_finalize_deal), Class: btn btn-success mb, Contract: LrPurchaseSteps, Params: \"ObjectId=#view_id#,RoleId=#role_id#,Step=#view_step#,Decision=finalize\", Page: #back_page#, PageParams: \"sales_list=#sales_list#\").CompositeContract(@1TokensSend, [{\"Amount\": #view_price#, \"Recipient\": \"#view_owner_id#\"}])\r\n                            }\r\n                        }\r\n                    }\r\n                    Div(col-md-2 text-center){\r\n                        If(#view_step#>=0){\r\n                            SetVar(b_id, 0)\r\n                            DBFind(\"@1members\").Where({\"id\": #view_buyer_id#, \"ecosystem\": #ecosystem_id#}).Vars(b)\r\n                            If(Or(#b_id#>0,#b_id#<0)){\r\n                                SetVar(buyer_image_id, #b_image_id#)\r\n                                SetVar(buyer_member_name, #b_member_name#)\r\n                            }.Else{\r\n                                SetVar(buyer_, 0)\r\n                                SetVar(buyer_member_name, Address(#view_buyer_id#))\r\n                            }\r\n                            LinkPage(Page: @1profile_view, PageParams: \"v_key_id=#view_buyer_id#\"){\r\n                                If(#buyer_image_id#>0){\r\n                                    Image(Src: Binary().ById(#buyer_image_id#), Class: img-circle).Style(height: 30px; width: 30px; border: 1px solid #5A5D63;)\r\n                                }.Else{\r\n                                    Span(Em(Class: fa icon-user fa-2x))\r\n                                }\r\n                                Div(Class: short-name text-bold, Body: #buyer_member_name#)\r\n                            }\r\n                            Div(Class: text-muted m0, Body: ($lr_owner$))\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        Button(Body: LangRes(@1back), Class: btn btn-default pull-right mt, Page: #back_page#, PageParams: \"sales_list=#sales_list#\")\r\n    }.Style(\r\n        .short-name {\r\n        text-overflow: ellipsis;\r\n        overflow: hidden;\r\n        white-space: nowrap;\r\n        }\r\n    )\r\n}.Else{\r\n    Form(){\r\n        Div(alert alert-danger text-center){\r\n            LangRes(@1attention)\r\n        }\r\n        Button(Body: LangRes(@1back), Class: btn btn-default pull-right, Page: lr_list)\r\n    }\r\n}",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Name": "LrAdd",
            "Conditions": "ContractConditions(\"AdminCondition\")",
            "Value": "contract LrAdd {\r\n    data {\r\n        Coords string\r\n        LandUse int\r\n        LandType int\r\n        LandAuthority int\r\n        BuildingsUseClass int\r\n        RegistrationDate string\r\n        Price money\r\n    }\r\n    \r\n    conditions {\r\n        $app_id = DBFind(\"@1applications\").Where({ecosystem: $ecosystem_id, name: \"Land registry\"}).One(\"id\")\r\n        if $app_id > 0 {\r\n            if AppParam(Int($app_id), \"lr_depart2_role\", $ecosystem_id) == 0 || AppParam(Int($app_id), \"lr_depart3_role\", $ecosystem_id) == 0 || AppParam(Int($app_id), \"lr_bank_role\", $ecosystem_id) == 0 || AppParam(Int($app_id), \"lr_admin_role\", $ecosystem_id) == 0 {\r\n                info LangRes(\"lr_all_roles_needed\", \"en\")\r\n            }\r\n        } else {\r\n            warning LangRes(\"@1app_not_found\", \"en\")\r\n        }\r\n    }\r\n    \r\n    action {\r\n        var coords map coordsAddress, area string unixRegDate int\r\n        coords = JSONToMap($Coords)\r\n        coordsAddress = coords[\"address\"]\r\n        area = Sprintf(\"%.0f\", coords[\"area\"])\r\n        unixRegDate = UnixDateTime(Sprintf(\"%s %s\", $RegistrationDate, \"00:00:00\"))\r\n\r\n        var m specifications map objectId int\r\n        specifications[\"address\"] = coordsAddress\r\n        specifications[\"area\"] = area\r\n        specifications[\"buildings_class\"] = $BuildingsUseClass\r\n        specifications[\"map_coords\"] = $Coords\r\n        specifications[\"land_use\"] = $LandUse\r\n        specifications[\"land_type\"] = $LandType\r\n        specifications[\"land_authority\"] = $LandAuthority\r\n\r\n        m[\"owner_id\"] = $key_id\r\n        m[\"deleted\"] = 0\r\n        m[\"date_created\"] = $block_time\r\n        m[\"registration_date\"] = unixRegDate\r\n        m[\"modification_date\"] = $block_time\r\n        m[\"price\"] = $Price\r\n        m[\"specifications\"] = specifications\r\n        m[\"buyer_id\"] = $key_id\r\n        m[\"step\"] = \"-1\"\r\n\r\n        objectId = DBInsert(\"land_registry\", m)\r\n\r\n        // notifications to all departments\r\n        var depart_map depart2_params depart3_params map\r\n        depart2_params[\"object_id\"] = objectId\r\n        depart2_params[\"depart2_requests\"] = 1\r\n\r\n        depart_map[\"sender\"] = 1\r\n        depart_map[\"rid\"] = Int(AppParam(Int($app_id), \"lr_depart2_role\", $ecosystem_id))\r\n        depart_map[\"page_name\"] = \"lr_view\"\r\n        depart_map[\"text_header\"] = LangRes(\"lr_new_object\", \"en\")\r\n        depart_map[\"text_body\"] = LangRes(\"lr_need_processing\", \"en\")\r\n        depart_map[\"icon_name\"] = \"fa fa-bell-o\"\r\n        depart_map[\"closure_type\"] = 1\r\n        depart_map[\"popup\"] = \"true\"\r\n        depart_map[\"params_map\"] = depart2_params\r\n\r\n        CallContract(\"@1NotificationsSend\", depart_map)\r\n\r\n        depart3_params[\"object_id\"] = objectId\r\n        depart3_params[\"depart3_requests\"] = 1\r\n\r\n        depart_map[\"rid\"] = Int(AppParam(Int($app_id), \"lr_depart3_role\", $ecosystem_id))\r\n        depart_map[\"params_map\"] = depart3_params\r\n        \r\n        CallContract(\"@1NotificationsSend\", depart_map)\r\n    }\r\n}",
            "Type": "contracts"
        },
        {
            "Name": "LrDepartChecks",
            "Conditions": "ContractConditions(\"AdminCondition\")",
            "Value": "contract LrDepartChecks {\r\n    data {\r\n        ObjectId int\r\n        LegalStatus int \"optional\"\r\n        EncumbranceCertificate int \"optional\"\r\n        TaxReceiptAndBills int \"optional\"\r\n        GovernmentPrice money \"optional\"\r\n        MarketPrice money \"optional\"\r\n        RoleId int\r\n    }\r\n\r\n    conditions {\r\n        $app_id = DBFind(\"@1applications\").Where({\"ecosystem\": $ecosystem_id, \"name\": \"Land registry\"}).One(\"id\")\r\n        $depart2_role = Int(AppParam(Int($app_id), \"lr_depart2_role\", $ecosystem_id))\r\n        $depart3_role = Int(AppParam(Int($app_id), \"lr_depart3_role\", $ecosystem_id))\r\n\r\n        if $app_id > 0 {\r\n            if $depart2_role == 0 || $depart3_role == 0 || AppParam(Int($app_id), \"lr_admin_role\", $ecosystem_id) == 0 || AppParam(Int($app_id), \"lr_bank_role\", $ecosystem_id) == 0 {\r\n                info LangRes(\"lr_all_roles_needed\", \"en\")\r\n            }\r\n        } else {\r\n            warning LangRes(\"@1app_not_found\", \"en\")\r\n        }\r\n    }\r\n    \r\n    action {\r\n        var object status m map\r\n\r\n        if $RoleId == $depart2_role {\r\n            object = DBFind(\"land_registry\").WhereId($ObjectId).Row()\r\n            if object[\"status\"] {\r\n                var depart3_status map\r\n                depart3_status = JSONDecode(object[\"status\"])\r\n                if depart3_status[\"tax_receipt_and_bills\"] {\r\n                    status[\"tax_receipt_and_bills\"] = depart3_status[\"tax_receipt_and_bills\"]\r\n                }\r\n            }\r\n            status[\"legal_status\"] = $LegalStatus\r\n            status[\"encumbrance_certificate\"] = $EncumbranceCertificate\r\n            m[\"modification_date\"] = $block_time\r\n            m[\"status\"] = status\r\n            DBUpdate(\"land_registry\", $ObjectId, m)\r\n            \r\n            // closing all opened role notifications\r\n            var opened map i int\r\n            opened = DBFind(\"@1notifications\").Where({\"recipient->role_id\": $depart2_role, \"page_params->object_id\": $ObjectId, \"closed\": 0, \"ecosystem\": $ecosystem_id})\r\n\r\n            while i < Len(opened){\r\n                var current map current_id int\r\n                current = opened[i]\r\n                current_id = Int(current[\"id\"])\r\n                @1NotificationsProcess(\"notific_id\", current_id)\r\n                @1NotificationsClose(\"notific_id\", current_id)\r\n                i = i + 1\r\n            }\r\n        }\r\n        if $RoleId == $depart3_role {\r\n            object = DBFind(\"land_registry\").WhereId($ObjectId).Row()\r\n            if object[\"status\"] {\r\n                var depart2_status map\r\n                depart2_status = JSONDecode(object[\"status\"])\r\n                if depart2_status[\"legal_status\"] {\r\n                    status[\"legal_status\"] = depart2_status[\"legal_status\"]\r\n                }\r\n                if depart2_status[\"encumbrance_certificate\"] {\r\n                    status[\"encumbrance_certificate\"] = depart2_status[\"encumbrance_certificate\"]\r\n                }\r\n            }\r\n\r\n            status[\"tax_receipt_and_bills\"] = $TaxReceiptAndBills\r\n            m[\"government_price\"] = $GovernmentPrice\r\n            m[\"market_price\"] = $MarketPrice\r\n            m[\"modification_date\"] = $block_time\r\n            m[\"status\"] = status\r\n            DBUpdate(\"land_registry\", $ObjectId, m)\r\n                        \r\n            // closing all opened role notifications\r\n            var opened map i int\r\n            opened = DBFind(\"@1notifications\").Where({\"recipient->role_id\": $depart3_role, \"page_params->object_id\": $ObjectId, \"closed\": 0, \"ecosystem\": $ecosystem_id})\r\n\r\n            while i < Len(opened){\r\n                var current map current_id int\r\n                current = opened[i]\r\n                current_id = Int(current[\"id\"])\r\n                @1NotificationsProcess(\"notific_id\", current_id)\r\n                @1NotificationsClose(\"notific_id\", current_id)\r\n                i = i + 1\r\n            }\r\n        }\r\n\r\n        // checking if the object is ready for sale\r\n        object = DBFind(\"land_registry\").WhereId($ObjectId).Row()\r\n        if Money(object[\"price\"]) > 0 && Money(object[\"market_price\"]) > 0 && Money(object[\"government_price\"]) > 0 && object[\"deleted\"] != 1 {\r\n            var status_map map\r\n            status_map = JSONDecode(object[\"status\"])\r\n            if status_map[\"legal_status\"] == 1 && status_map[\"encumbrance_certificate\"] == 1 && status_map[\"tax_receipt_and_bills\"] == 1 {\r\n                \r\n                // notification to the object owner\r\n                var n params map\r\n                n[\"sender\"] = 1\r\n                n[\"page_name\"] = \"lr_view\"\r\n                n[\"icon_name\"] = \"fa fa-bell-o\"\r\n                n[\"popup\"] = \"true\"\r\n                n[\"member_id\"] = object[\"owner_id\"]\r\n                n[\"text_header\"] = LangRes(\"lr_object_status\", \"en\")\r\n                n[\"text_body\"] = LangRes(\"lr_checks_successfull\", \"en\")\r\n                params[\"object_id\"] = $ObjectId\r\n                params[\"info_message\"] = 1\r\n                params[\"info_status\"] = \"success\"\r\n                n[\"params_map\"] = params\r\n                CallContract(\"@1NotificationsSend\", n)\r\n            }\r\n        }\r\n    }\r\n}",
            "Type": "contracts"
        },
        {
            "Name": "LrDepartRequest",
            "Conditions": "ContractConditions(\"AdminCondition\")",
            "Value": "contract LrDepartRequest {\r\n    data {\r\n        ObjectId int\r\n        DepartNumber int\r\n    }\r\n\r\n    conditions {\r\n        $app_id = DBFind(\"@1applications\").Where({ecosystem: $ecosystem_id, name: \"Land registry\"}).One(\"id\")\r\n        var requests_flag int\r\n        if $DepartNumber == 2 {\r\n            requests_flag = DBFind(\"@1notifications\").Where({\"ecosystem\": $ecosystem_id, \"page_params->object_id\": $ObjectId, \"page_params->depart2_requests\": 2}).One(\"id\")\r\n            if requests_flag {\r\n                warning LangRes(\"lr_requests_limit_reached\", \"en\")\r\n            }\r\n        } elif $DepartNumber == 3 {\r\n            requests_flag = DBFind(\"@1notifications\").Where({\"ecosystem\": $ecosystem_id, \"page_params->object_id\": $ObjectId, \"page_params->depart3_requests\": 2}).One(\"id\")\r\n            if requests_flag {\r\n                warning LangRes(\"lr_requests_limit_reached\", \"en\")\r\n            }\r\n        }\r\n    }\r\n    \r\n    action {\r\n        var request params map\r\n        request[\"sender\"] = 1\r\n        request[\"page_name\"] = \"lr_view\"\r\n        request[\"text_header\"] = LangRes(\"lr_additional_request\", \"en\")\r\n        request[\"text_body\"] = LangRes(\"lr_need_processing\", \"en\")\r\n        request[\"icon_name\"] = \"fa fa-bell-o\"\r\n        request[\"closure_type\"] = 1\r\n        request[\"popup\"] = \"true\"\r\n        params[\"object_id\"] = $ObjectId\r\n        \r\n        if $DepartNumber == 2 {\r\n            request[\"rid\"] = Int(AppParam(Int($app_id), \"lr_depart2_role\", $ecosystem_id))\r\n            params[\"depart2_requests\"] = 2\r\n            request[\"params_map\"] = params\r\n        } elif $DepartNumber == 3 {\r\n            request[\"rid\"] = Int(AppParam(Int($app_id), \"lr_depart3_role\", $ecosystem_id))\r\n            params[\"depart3_requests\"] = 2\r\n            request[\"params_map\"] = params\r\n        }\r\n\r\n        CallContract(\"@1NotificationsSend\", request)\r\n    }\r\n}",
            "Type": "contracts"
        },
        {
            "Name": "LrEdit",
            "Conditions": "ContractConditions(\"AdminCondition\")",
            "Value": "contract LrEdit {\r\n    data {\r\n        ObjectId int\r\n        LandUse int \"optional\"\r\n        LandType int \"optional\"\r\n        LandAuthority int \"optional\"\r\n        BuildingsUseClass int \"optional\"\r\n        RegistrationDate string \"optional\"\r\n        Price money \"optional\"\r\n        DeleteObject int \"optional\"\r\n        RoleId int\r\n    }\r\n\r\n    func log(property, value string) {\r\n        var history map\r\n        if property == \"land_use\" || property ==  \"land_type\" || property ==  \"land_authority\" || property ==  \"buildings_class\" {\r\n            if Int(value) != Int($old_specifications[property]) {\r\n                history[\"old_value\"] = Int($old_specifications[property])\r\n                history[\"object_id\"] = $ObjectId\r\n                history[\"attribute_name\"] = property\r\n                history[\"new_value\"] = value\r\n                history[\"member_id\"] = $key_id\r\n                history[\"date\"] = $block_time\r\n                DBInsert(\"land_registry_history\", history)\r\n            }\r\n        } elif value != $object[property] {\r\n            history[\"old_value\"] = Str($object[property])\r\n            history[\"object_id\"] = $ObjectId\r\n            history[\"attribute_name\"] = property\r\n            history[\"new_value\"] = value\r\n            history[\"member_id\"] = $key_id\r\n            history[\"date\"] = $block_time\r\n            DBInsert(\"land_registry_history\", history)\r\n        }\r\n    }\r\n\r\n    conditions {\r\n        $app_id = DBFind(\"@1applications\").Where({ecosystem: $ecosystem_id, name: \"Land registry\"}).One(\"id\")\r\n        $object = DBFind(\"land_registry\").WhereId($ObjectId).Row()\r\n        $admin_role = Int(AppParam(Int($app_id), \"lr_admin_role\", $ecosystem_id))\r\n\r\n        if $app_id > 0 {\r\n            if $admin_role == 0 || AppParam(Int($app_id), \"lr_bank_role\", $ecosystem_id) == 0 || AppParam(Int($app_id), \"lr_depart2_role\", $ecosystem_id) == 0 || AppParam(Int($app_id), \"lr_depart3_role\", $ecosystem_id) == 0 {\r\n                info LangRes(\"lr_all_roles_needed\", \"en\")\r\n            }\r\n        } else {\r\n            warning LangRes(\"@1app_not_found\", \"en\")\r\n        }\r\n    }\r\n    \r\n    action {\r\n        if $DeleteObject != 1 {\r\n            if $RoleId == $admin_role {\r\n                var specifications m map unixRegDate int\r\n                unixRegDate = UnixDateTime(Sprintf(\"%s %s\", $RegistrationDate, \"00:00:00\"))\r\n                $old_specifications = JSONDecode($object[\"specifications\"])\r\n\r\n                specifications[\"address\"] = $old_specifications[\"address\"]\r\n                specifications[\"area\"] = $old_specifications[\"area\"]\r\n                specifications[\"map_coords\"] = $old_specifications[\"map_coords\"]\r\n                specifications[\"land_use\"] = $LandUse\r\n                specifications[\"land_type\"] = $LandType\r\n                specifications[\"land_authority\"] = $LandAuthority\r\n                specifications[\"buildings_class\"] = $BuildingsUseClass\r\n\r\n                m[\"registration_date\"] = unixRegDate\r\n                m[\"specifications\"] = specifications\r\n                DBUpdate(\"land_registry\", $ObjectId, m)\r\n\r\n                log(\"land_use\", Str($LandUse))\r\n                log(\"land_type\", Str($LandType))\r\n                log(\"land_authority\", Str($LandAuthority))\r\n                log(\"buildings_class\", Str($BuildingsUseClass))\r\n                log(\"registration_date\", Str(unixRegDate))\r\n            }\r\n            if $object[\"owner_id\"] == $key_id {\r\n                DBUpdate(\"land_registry\", $ObjectId, {\"price\": $Price})\r\n                log(\"price\", Str($Price))\r\n            }\r\n        } else {\r\n            if $object[\"owner_id\"] == $key_id || $RoleId == $admin_role {\r\n                DBUpdate(\"land_registry\", $ObjectId, {\"deleted\": 1})\r\n                log(\"deleted\", Str($DeleteObject))\r\n            }\r\n        }\r\n    }\r\n}",
            "Type": "contracts"
        },
        {
            "Name": "LrPurchaseSteps",
            "Conditions": "ContractConditions(\"AdminCondition\")",
            "Value": "contract LrPurchaseSteps {\r\n    data {\r\n        ObjectId int\r\n        Step int\r\n        Decision string \"optional\"\r\n        RoleId int \"optional\"\r\n    }\r\n\r\n    conditions {\r\n        $app_id = DBFind(\"@1applications\").Where({\"ecosystem\": $ecosystem_id, \"name\": \"Land registry\"}).One(\"id\")\r\n        $object = DBFind(\"land_registry\").WhereId($ObjectId).Row()\r\n        $bank_role = Int(AppParam(Int($app_id), \"lr_bank_role\", $ecosystem_id))\r\n        \r\n        var bank_id int\r\n        bank_id = DBFind(\"@1roles_participants\").Where({\"role->id\": $bank_role, \"deleted\": 0, \"ecosystem\": $ecosystem_id}).One(\"member->member_id\")\r\n        if !bank_id {\r\n            warning LangRes(\"lr_bank_account_not_found\", \"en\")\r\n        }\r\n    }\r\n\r\n    action {\r\n        var owner buyer int\r\n        owner = $object[\"owner_id\"]\r\n        buyer = $object[\"buyer_id\"]\r\n\r\n        var m params map\r\n        m[\"sender\"] = 1\r\n        m[\"text_header\"] = LangRes(\"lr_deal_status\", \"en\")\r\n        m[\"text_body\"] = LangRes(\"lr_need_processing\", \"en\")\r\n        m[\"page_name\"] = \"lr_view\"\r\n        m[\"icon_name\"] = \"fa fa-bell-o\"\r\n        m[\"popup\"] = \"true\"\r\n        params[\"object_id\"] = $ObjectId\r\n\r\n        if $Step == -1 {\r\n            DBUpdate(\"land_registry\", $ObjectId, {\"buyer_id\": $key_id, \"step\": 0})\r\n            \r\n            // notification to the object owner\r\n            m[\"member_id\"] = owner\r\n            m[\"text_header\"] = LangRes(\"lr_new_offer\", \"en\")\r\n            m[\"params_map\"] = params\r\n            CallContract(\"@1NotificationsSend\", m)\r\n\r\n        } elif $Step == 0 && $key_id == Int(owner) {\r\n            if $Decision == \"accept\" {\r\n                DBUpdate(\"land_registry\", $ObjectId, {\"step\": 1})\r\n                m[\"text_body\"] = LangRes(\"lr_purchase_accepted\", \"en\")\r\n            } elif $Decision == \"reject\" {\r\n                DBUpdate(\"land_registry\", $ObjectId, {\"buyer_id\": owner, \"step\": \"-1\"})\r\n                m[\"text_body\"] = LangRes(\"lr_purchase_rejected\", \"en\")\r\n                params[\"info_message\"] = 1\r\n                params[\"info_status\"] = \"fail\"\r\n            }\r\n            \r\n            // notification to the object buyer\r\n            m[\"member_id\"] = buyer\r\n            m[\"params_map\"] = params\r\n            CallContract(\"@1NotificationsSend\", m)\r\n\r\n        } elif $Step == 1 && $key_id == Int(buyer) {\r\n            if $Decision == \"deposit\" {\r\n                DBUpdate(\"land_registry\", $ObjectId, {\"step\": 2})\r\n\r\n                // notification to the land bank\r\n                m[\"rid\"] = Int(AppParam(Int($app_id), \"lr_bank_role\", $ecosystem_id))\r\n                m[\"text_header\"] = LangRes(\"lr_new_object\", \"en\")\r\n                m[\"closure_type\"] = 1\r\n                m[\"params_map\"] = params\r\n                CallContract(\"@1NotificationsSend\", m)\r\n\r\n                // notification to the object owner\r\n                var n map\r\n                n[\"sender\"] = 1\r\n                n[\"page_name\"] = \"lr_view\"\r\n                n[\"icon_name\"] = \"fa fa-bell-o\"\r\n                n[\"popup\"] = \"true\"\r\n                n[\"member_id\"] = owner\r\n                n[\"text_header\"] = LangRes(\"lr_deal_status\", \"en\")\r\n                n[\"text_body\"] = LangRes(\"lr_buyer_made_deposit\", \"en\")\r\n                params[\"info_message\"] = 1\r\n                params[\"info_status\"] = \"success\"\r\n                n[\"params_map\"] = params\r\n                CallContract(\"@1NotificationsSend\", n)\r\n\r\n            } elif $Decision == \"cancel\" {\r\n                DBUpdate(\"land_registry\", $ObjectId, {\"buyer_id\": owner, \"step\": \"-1\"})\r\n\r\n                if $key_id == Int(owner) {\r\n                    // notification to the object buyer\r\n                    m[\"member_id\"] = buyer\r\n                    m[\"text_body\"] = LangRes(\"lr_owner_cancelled_purchase\", \"en\")\r\n                } else {\r\n                    // notification to the object owner\r\n                    m[\"member_id\"] = owner\r\n                    m[\"text_body\"] = LangRes(\"lr_buyer_cancelled_purchase\", \"en\")\r\n                }\r\n                \r\n                params[\"info_message\"] = 1\r\n                params[\"info_status\"] = \"fail\"\r\n                m[\"params_map\"] = params\r\n                CallContract(\"@1NotificationsSend\", m)\r\n            }\r\n\r\n        } elif $Step == 2 && $RoleId == $bank_role {\r\n            var n status_map map\r\n            status_map[\"legal_status\"] = 0\r\n            status_map[\"encumbrance_certificate\"] = 0\r\n            status_map[\"tax_receipt_and_bills\"] = 0\r\n\r\n            if $Decision == \"finalize\" {\r\n                DBUpdate(\"land_registry\", $ObjectId, {\"owner_id\": buyer, \"buyer_id\": buyer, \"step\": \"-1\", \"status\": status_map})\r\n                params[\"info_message\"] = 1\r\n                params[\"info_status\"] = \"success\"\r\n                m[\"text_body\"] = LangRes(\"lr_deal_successful\", \"en\")\r\n                n[\"text_body\"] = LangRes(\"lr_deal_successful\", \"en\")\r\n            } elif $Decision == \"cancel\" {\r\n                DBUpdate(\"land_registry\", $ObjectId, {\"owner_id\": owner, \"buyer_id\": owner, \"step\": \"-1\", \"status\": status_map})\r\n                params[\"info_message\"] = 1\r\n                params[\"info_status\"] = \"fail\"\r\n                m[\"text_body\"] = LangRes(\"lr_deal_cancelled_by_bank\", \"en\")\r\n                n[\"text_body\"] = LangRes(\"lr_deal_cancelled_by_bank\", \"en\")\r\n            }\r\n\r\n            // notification to the old object owner\r\n            m[\"member_id\"] = owner\r\n            m[\"params_map\"] = params\r\n            CallContract(\"@1NotificationsSend\", m)\r\n\r\n            // notification to the new object owner\r\n            n[\"sender\"] = 1\r\n            n[\"page_name\"] = \"lr_view\"\r\n            n[\"icon_name\"] = \"fa fa-bell-o\"\r\n            n[\"popup\"] = \"true\"\r\n            n[\"member_id\"] = buyer\r\n            n[\"text_header\"] = LangRes(\"lr_deal_status\", \"en\")\r\n            n[\"params_map\"] = params\r\n            CallContract(\"@1NotificationsSend\", n)\r\n        }\r\n\r\n        // closing all opened notifications\r\n        var opened map i int\r\n        if $Step == 2 && $RoleId == $bank_role {\r\n            opened = DBFind(\"@1notifications\").Where({\"recipient->role_id\": $bank_role, \"page_params->object_id\": $ObjectId, \"closed\": 0, \"ecosystem\": $ecosystem_id})\r\n        } else {\r\n            opened = DBFind(\"@1notifications\").Where({\"recipient->member_id\": $key_id, \"page_params->object_id\": $ObjectId, \"closed\": 0, \"ecosystem\": $ecosystem_id})\r\n        }\r\n\r\n        while i < Len(opened){\r\n            var current map current_id int\r\n            current = opened[i]\r\n            current_id = Int(current[\"id\"])\r\n            if $Step == 2 && $RoleId == $bank_role {\r\n                @1NotificationsProcess(\"notific_id\", current_id)\r\n            }\r\n            @1NotificationsClose(\"notific_id\", current_id)\r\n            i = i + 1\r\n        }\r\n    }\r\n}",
            "Type": "contracts"
        },
        {
            "Name": "LrSettings",
            "Conditions": "ContractConditions(\"AdminCondition\")",
            "Value": "contract LrSettings {\r\n    data {\r\n        RoleAdmin int\r\n        RoleBank int\r\n        RoleDepart2 int\r\n        RoleDepart3 int\r\n    }\r\n\r\n    conditions{\r\n        AdminCondition()\r\n    }\r\n\r\n    func updateParam(name string, id int) {\r\n        if id > 0 {\r\n            var param paramsNew map app_id int\r\n            app_id = DBFind(\"@1applications\").Where({ecosystem: $ecosystem_id, name: \"Land registry\"}).One(\"id\")\r\n            if app_id > 0 {\r\n                param = DBFind(\"@1app_params\").Where({ecosystem: $ecosystem_id, app_id: app_id, name: name}).Row()\r\n                paramsNew[\"Value\"] = Str(id)\r\n                if param {\r\n                    paramsNew[\"Id\"] = Int(param[\"id\"])\r\n                    paramsNew[\"Conditions\"] = param[\"conditions\"]\r\n                    CallContract(\"@1EditAppParam\", paramsNew)\r\n                } else {\r\n                    paramsNew[\"App\"] = Str(app_id)\r\n                    paramsNew[\"Name\"] = name\r\n                    paramsNew[\"Conditions\"] = \"ContractConditions(\\\"AdminCondition\\\")\"\r\n                    CallContract(\"@1NewAppParam\", paramsNew)\r\n                }\r\n            } else {\r\n                warning LangRes(\"@1app_not_found\", \"en\")\r\n            }\r\n        }\r\n    }\r\n\r\n    action {\r\n        updateParam(\"lr_admin_role\", $RoleAdmin)\r\n        updateParam(\"lr_bank_role\", $RoleBank)\r\n        updateParam(\"lr_depart2_role\", $RoleDepart2)\r\n        updateParam(\"lr_depart3_role\", $RoleDepart3)\r\n    }\r\n}",
            "Type": "contracts"
        }
    ]
}